<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Soundchaser.TagTools.Maui.ViewModels"
             xmlns:views="clr-namespace:Soundchaser.TagTools.Maui.Views.Panes"
             xmlns:strings="clr-namespace:Soundchaser.TagTools.Maui.Resources.Strings"
             x:Class="Soundchaser.TagTools.Maui.Views.DatabasesPage"
             Title="{x:Static strings:AppStrings.DatabasesPageTitle}">
    <ContentPage.BindingContext>
        <vm:DatabasesPageViewModel />
    </ContentPage.BindingContext>
    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Toolbar -->
        <HorizontalStackLayout Grid.Row="0" Padding="8" Spacing="8">
            <Button Text="{x:Static strings:AppStrings.ToolbarRefresh}"
                    Command="{Binding RefreshCommand}"
                    IsEnabled="{Binding IsNotBusy}" />
            <SearchBar Placeholder="{x:Static strings:AppStrings.SearchPlaceholder}"
                       Text="{Binding SearchText}"
                       IsEnabled="{Binding IsNotBusy}"
                       HorizontalOptions="FillAndExpand"
                       MinimumWidthRequest="200" />
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               VerticalOptions="Center" />
        </HorizontalStackLayout>
        <!-- Panes (horizontal scroll, column browser) -->
        <ScrollView Grid.Row="1" Orientation="Horizontal">
            <HorizontalStackLayout x:Name="PanesHost" Spacing="1" BindableLayout.ItemsSource="{Binding Panes}">
                <BindableLayout.ItemTemplate>
                    <DataTemplate>
                        <views:PaneColumnView />
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </HorizontalStackLayout>
        </ScrollView>
        <!-- Player bar -->
        <Grid Grid.Row="2" Padding="8" RowDefinitions="Auto,Auto"
              BackgroundColor="{AppThemeBinding Light={StaticResource PlayerBarLight}, Dark={StaticResource PlayerBarDark}}">
            <Label Grid.Row="0"
                   Text="{Binding PlayerBar.TrackTitle}"
                   FontAttributes="Bold"
                   HorizontalOptions="Center" />
            <ProgressBar Grid.Row="1"
                         Progress="{Binding PlayerBar.Progress}"
                         Margin="0,4,0,0" />
        </Grid>
    </Grid>
</ContentPage>
