' RegExp Find & Replace
'
' Version: 4.4.9
' Date: 2017-03-23
' Author: Zvezdan Dimitrijevic
' URL: http://solair.eunet.rs/~zvezdand/RegExpReplace.htm
'
' Description:
' This script is for use with MediaMonkey 2.x or 3.x (www.mediamonkey.com).
' It allows powerful finding and replacing of strings inside of selected/visible
' tracks in the tracklist window or the Now Playing panel. The matching criteria
' and the replacement string can be created using Regular expressions or
' VBScript expressions which provides very flexible transformations of data.
' It has a support for custom presets with 200+ already predefined, for example:
' clear field, copy conditionally full or part of one field to another, swap
' the first and the last name of Artist, ... Almost all MM fields are supported!
'
' For discussion about this script you could visit the MediaMonkey forum:
' http://www.mediamonkey.com/forum/viewtopic.php?t=28510
'
' Installation:
' - For MediaMonley 3.x or higher, double click on MMIP file.
' - For MediaMonkey 2.x, unpack VBS file to MediaMonkey's "Scripts\Auto" folder.
'
' Legal Notice:
' This add-on is donationware and may not be distributed or sold for profit.
' You are free to use it for the purpose mentioned in the Description section.
' No part of the included software may be redistributed for any purpose without
' the author's consent. Commercial use of this software is not allowed without
' written permission of the author.
'
' This add-on is developed by me, the author, in my own free time. I am not
' employed by Ventis Media, the company behind MediaMonkey, nor I've been paid
' by them for this add-on. So, if you find it useful and/or want to help its
' further development, it would be nice if you send me some small donation
' using PayPal or direct bank transfer. You could donate as much as you think
' that is appropriate, any amount would be really appreciated.
' http://solair.eunet.rs/~zvezdand/Donate.htm

' Disclaimer:
' This software is provided 'as-is', without any express or implied warranty.
' In no event will the author be held liable for any damages arising from the
' use of this software.
'
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
Option Explicit:Const ch="RegExp Find and Replace",kn="4.4.9",fk="Shift+Ctrl+F",ba="Find & replace using VBScript/Regular expressions",p5="http://solair.eunet.rs/~zvezdand/RegExpReplace.htm",eb="Expression error!",q7="Critical error!",kb="solving...",dn=5,n1="",by="Black",b1="Yellow",q9="LightGrey",ng=" border: 1px solid Silver;",ex="All Text Fields",oj="Tag Manipulation Presets",o1=500,nf=250,n6=50,pv=4,qz=2,gj=3,f2=2,b9=1:Dim m8,f,dl,mp,d8,kd,ef,hk:Set ef=New RegExp:Dim c4:Set c4=CreateObject("Scripting.Dictionary"):With c4:If SDb.veRsIoNhI>=3 Then .Add ex,"Title & "";"" & oSongData.ArtistName & "";"" & oSongData.AlbumName & "";"" & oSongData.AlbumArtistName & "";"" & oSongData.Genre & "";"" & oSongData.Author & "";"" & oSongData.Lyricist & "";"" & oSongData.Conductor & "";"" & oSongData.Grouping & "";"" & oSongData.Custom1 & "";"" & oSongData.Custom2 &  "";"" & oSongData.Custom3 & "";"" & oSongData.Custom4 &  "";"" & oSongData.Custom5 & "";"" & oSongData.OriginalArtist & "";"" & oSongData.OriginalTitle & "";"" & oSongData.Mood & "";"" & oSongData.Tempo & "";"" & oSongData.Occasion & "";"" & oSongData.Quality & "";"" & oSongData.InvolvedPeople":Else .aDD ex,"Title & "";"" & oSongData.ArtistName & "";"" & oSongData.AlbumName & "";"" & oSongData.AlbumArtistName & "";"" & oSongData.Genre & "";"" & oSongData.Author & "";"" & oSongData.Lyricist & "";"" & oSongData.Custom1 & "";"" & oSongData.Custom2 &  "";"" & oSongData.Custom3 & "";"" & oSongData.OriginalArtist & "";"" & oSongData.OriginalTitle & "";"" & oSongData.Mood & "";"" & oSongData.Tempo & "";"" & oSongData.Occasion & "";"" & oSongData.Quality & "";"" & oSongData.InvolvedPeople":End If:.ADd"Title","Title":.AdD"Artist","ArtistName":.aDd"Album","AlbumName":.adD"Album Artist","AlbumArtistName":.Add"Genre","Genre":.add"Year","Year":If sDb.vERSIONHI>=3 Then .aDd"Month","Month":.adD"Day","Day":.add"Date","oSongData.Year & IIf(oSongData.Month > 0, ""-"" & IIf(oSongData.Month <= 9, ""0"", """") & oSongData.Month & IIf(oSongData.Day > 0, ""-"" & IIf(oSongData.Day <= 9, ""0"", """") & oSongData.Day, """"), """")":End If:.AdD"Rating","Rating":If sDB.versIOnHI<3 Then .ADd"Track #","TrackOrder":Else .ADD"Track #","TrackOrderStr":.add"Disc #","DiscNumberStr":End If:.add"Composer","Author":If SDB.VersiOnhi>=3 Then .AdD"Conductor","Conductor":End If:.Add"Lyricist","Lyricist":.ADd"Involved People","InvolvedPeople":.ADd"Tempo","Tempo":.ADd"Mood","Mood":.aDd"Occasion","Occasion":.ADD"Quality","Quality":.AdD"Path","Path":.add"Folder","CreateObject(""Scripting.FileSystemObject"").GetParentFolderName(oSongData.Path)":.Add"Filename","CreateObject(""Scripting.FileSystemObject"").GetBaseName(oSongData.Path)":.Add"Extension","CreateObject(""Scripting.FileSystemObject"").GetExtensionName(oSongData.Path)":.ADD"Length","SongLength":.adD"Track Volume","Leveling":If sDb.versiONhi>=3 Then .AdD"Album Volume","LevelingAlbum":End If:.ADD"Peak Value","PeakValue":.ADd"Bitrate","Bitrate":.aDD"File Size","FileLength":.adD"Timestamp","FileModified":.aDD"Added","DateAdded":.adD"Played #","PlayCounter":.adD"Last Played","LastPlayed":.ADd"BPM","BPM":.ADd"Sample Rate","SampleRate":.ADd"Channels","Channels":.ADd"Original Artist","OriginalArtist":.AdD"Original Title","OriginalTitle":.AdD"Original Lyricist","OriginalLyricist":.ADd"Original Year","OriginalYear":If SdB.veRsiONHi>=3 Then .ADD"Original Month","OriginalMonth":.adD"Original Day","OriginalDay":.adD"Original Date","oSongData.OriginalYear & IIf(oSongData.OriginalMonth > 0, ""-"" & IIf(oSongData.OriginalMonth <= 9, ""0"", """") & oSongData.OriginalMonth & IIf(oSongData.OriginalDay > 0, ""-"" & IIf(oSongData.OriginalDay <= 9, ""0"", """") & oSongData.OriginalDay, """"), """")":End If:.aDd"Comment","Comment":.aDd"Lyrics","Lyrics":If SdB.vErsiOnhi>=3 Then .aDD"Grouping","Grouping":End If:.Add"Custom 1","Custom1":.ADd"Custom 2","Custom2":.add"Custom 3","Custom3":If SdB.veRsIONhi>=3 Then .ADd"Custom 4","Custom4":.ADD"Custom 5","Custom5":End If:.adD"Publisher","Publisher":.aDd"Copyright","Copyright":.ADd"Encoder","Encoder":.ADD"ISRC","ISRC":.add"VBR","VBR":.add"Bookmark","Bookmark":.ADd"Playback %","Round(CLng(oSongData.Bookmark) * 100 / IIf(oSongData.SongLength > 0, oSongData.SongLength, 1000000000))":If sDb.vERsIoNhi>=4 Then .aDd"Episode #","EpisodeNumber":.ADd"Season #","SeasonNumber":.AdD"Series","Series":.ADd"Director","Director":.aDD"Producer","Producer":.aDD"Actor","Actors":.add"Start Time","StartTime":.ADD"Stop Time","StopTime":.Add"Skipped #","SkipCount":.ADD"Parental Rating","ParentalRating":.adD"Type","Choose(oSongData.TrackType, Array(""Music"", ""Podcast"", ""Audiobook"", ""Classical Music"", ""Music Video"", ""Video"", ""TV"", ""Video Podcast""))":End If:End With:Sub n0(a):On Error Resume Next:CreateObject("WScript.Shell").Run(p5):On Error GoTo 0:End Sub:Sub iv():Dim mu:mu=m9+fq:If mu<=oSongList.Count Then o3.Value=mu:Else o3.Value=oSongList.Count:End If:End Sub:Function Max(gp,j0):If CLng(gp)>CLng(j0)Then Max=gp:Else Max=j0:End If:End Function:Dim ht:Set ht=CreateObject("Scripting.Dictionary"):With ht:If SDb.VErSiONhi>=3 Then .ADD"Date","oSongData.Year = IIf(Len(sAfter), Year(sAfter & IIf(InStr(sAfter, ""-""), """", ""-1"")), 0): If Len(RegExp(sAfter, ""\d{4}-\d\d?"", 0)) Then oSongData.Month = Month(sAfter): If Len(RegExp(sAfter, ""\d{4}-\d\d?-\d\d?"", 0)) Then oSongData.Day = Day(sAfter)":.ADd"Original Date","oSongData.OriginalYear = IIf(Len(sAfter), Year(sAfter & IIf(InStr(sAfter, ""-""), """", ""-1"")), 0): If Len(RegExp(sAfter, ""\d{4}-\d\d?"", 0)) Then oSongData.OriginalMonth = Month(sAfter): If Len(RegExp(sAfter, ""\d{4}-\d\d?-\d\d?"", 0)) Then oSongData.OriginalDay = Day(sAfter)":End If:.Add"Folder","oSongData.Path = sAfter & Mid(oSongData.Path, InStrRev(oSongData.Path, ""\""))":.ADD"Filename","oSongData.Path = Left(oSongData.Path, InStrRev(oSongData.Path, Chr(92))) & sAfter & IIf(InStrRev(oSongData.Path, Chr(92)) < InStrRev(oSongData.Path, Chr(46)), Mid(oSongData.Path, InStrRev(oSongData.Path, Chr(46))), Space(0))":.aDD"Extension","oSongData.Path = IIf(InStrRev(oSongData.Path, ""\"") < InStrRev(oSongData.Path, "".""), Left(oSongData.Path, InStrRev(oSongData.Path, ""."")), oSongData.Path & ""."") & sAfter":.Add"Playback %","oSongData.Bookmark = sAfter * oSongData.SongLength \ 100":If SdB.vERsIonhI>=4 Then .aDD"Type","oSongData.TrackType = IIf(IsNumeric(sAfter), sAfter, Exchange(sAfter, Array(""Music"", ""Podcast"", ""Audiobook"", ""Classical Music"", ""Music Video"", ""Video"", ""TV"", ""Video Podcast"")))":End If:End With:Sub cj(a):Dim b0:If d0<>a.TExt Then qa=d0:End If:If qa<>a.teXT Then If lr(qa,True)Then b0=a.IteMInDeX:hn a,qa,0:If b0<a.ItemCOUNt-1 Then a.ITemiNDEX=b0+1:Else a.iTEmindex=0:End If:End If:End If:End Sub:Sub h0(a):qa=d0:d0=a.teXt:oq:End Sub:Sub an(l7):Call kx(Replace(l7.CAPtIoN,"&&","&")):End Sub:Sub i3(dc,cn):Dim s,at:If b<>dc Then If b=0 Then Set s=cn.item("trRow"&dc):s.CLASSNAme="select":For at=1 To i6:Set s=cn.item("trRow"&at):If Not s Is Nothing Then If at=dc Then:Else If(at/2)=(at\2)Then s.ClAssnAmE="even":End If:End If:End If:Set s=cn.item("chk"&at):If Not s Is Nothing Then s.disabLED=True:End If:Next:Set s=cn.item("chk0"):If Not s Is Nothing Then s.dIsABlEd=True:End If:r9.coMmoN.ENaBLed=(o8 Imp Not l9):If Not o8 Then qm.COMmON.enabLEd=True:Else If sdb.ToOLs.FileSystem.filEexiSts(ok)Then dw.cOmMON.ENaBLed=True:End If:End If:Else Set s=cn.item("trRow"&dc):If Not s Is Nothing Then s.CLaSSnaME="select":End If:Set s=cn.item("trRow"&b):If Not s Is Nothing Then s.cLAssnaME="even":End If:End If:b=dc:Else For at=1 To i6:Set s=cn.item("trRow"&at):If Not s Is Nothing Then If(at/2)=(at\2)Then s.ClAssnAMe="odd":Else If at=b Then s.CLassnamE="even":End If:End If:End If:Set s=cn.item("chk"&at):If Not s Is Nothing Then s.DIsablEd=False:End If:Next:b=0:Set s=cn.item("chk0"):If Not s Is Nothing Then s.DiSaBlED=False:End If:r9.COMmON.enABLed=(ob>0 And(o8 Imp Not l9)):If Not o8 Then qm.COMMoN.ENabLEd=(ob>0):Else If SDB.tOolS.FileSystem.fileeXIstS(ok)Then dw.COMmoN.EnABlEd=(ob>0):End If:End If:End If:If b>0 And i6>1 And(o8 Imp Not l9)Then b2.COmmOn.EnABLed=(b>1):bk.COmmoN.enaBLeD=(b<i6):Else b2.cOMmON.eNaBlED=False:bk.commOn.EnabLED=False:End If:End Sub:Sub f7(ek,mn,el):If mn>=0 And mn<i1 And el>=0 And el<jw And ek=16 Then g1=True:Else g1=False:End If:End Sub:Sub gu(a):lp.Item(a.comMoN.CONtRolnaME)=a.Value:End Sub:Function DateTimeISO(e9):DateTimeISO=Year(e9)&"-"&Right("0"&Month(e9),2)&"-"&Right("0"&Day(e9),2)&" "&Right("0"&Hour(e9),2)&":"&Right("0"&Minute(e9),2)&":"&Right("0"&Second(e9),2):End Function:Sub it():If fh Then nu.coMmON.eNABlED=False:m5.comMoN.ENABLed=True:Else nu.COmmon.ENABlED=True:m5.cOmmON.eNaBLeD=False:End If:End Sub:Sub p9(kl,gh,pk,ph,fj,gi):Dim l7,dq,h9,ov:dq="ZD"&Now:h9=pk&"\"&ph:ov=kl&"\"&gh:With SDB.OBJeCTS("mnuRegExpPreset"&gi):If fj Then Set l7=.Item(h9):Set .Item(h9)=.Item(ov):Set .Item(ov)=l7:Else .KEY(h9)=dq:.KEy(ov)=h9:.KeY(dq)=ov:End If:End With:End Sub:Sub cz(a):oi=a8.ChEckeD:oq:End Sub:Function ci():If(nb<>hi Or pq<>ij Or CStr(pa)<>CStr(o2)Or p1<>j2 Or cl<>bq Or ns<>a0 Or gd<>qo Or bi<>fh Or o6<>ka Or k8<>d0 Or lq<>mx Or cp<>jv Or pb<>pn Or lt<>oi)Then ci=True:Else ci=False:End If:End Function:Function p3(ol):Dim u:u=Mid(ol,8):If UCase(Left(ol,7))="CUSTOM "And u>="1"And u<=IIf(SDb.VERSIonhi<3,"3","5")Then p3=Int(u):Else p3=0:End If:End Function:Sub a3():Dim v,od:If Len(f)Then v="<html><head>"&dl&"<style type='text/css'>":Else v="<html><head><style type='text/css'>table {font-size: 11px; font-family: Tahoma, Arial, sans-serif;} thead {color: black; background-color: silver;} td.head {border-bottom: 1px solid black} tr.even {color: black; background-color: white;} tr.odd {color: black; background-color: Gainsboro;} tr.select {color: white; background-color: DarkGray;} .itemname {font-weight: bold; color: Brown;} .hlnumber {color: black; background-color: Gray;} ":End If:v=v&"body.tbl {margin: 0; overflow: auto;} td {padding: 0px 3px 0px 3px":If Not eg Then v=v&"; white-space: nowrap":End If:v=v&"} div.tableContainer {overflow: auto; width: offsetParent.offsetWidth; height: offsetParent.offsetHeight;} thead tr {position:relative; top: expression(offsetParent.scrollTop);":v=v&"}</style></head>":v=v&"<script language='VBScript'><!-- "&vbNewLine&"Sub NumOver(lIndex)"&vbNewLine:If Not o8 Then v=v&"  Document.getElementById(""tdNumber"" & lIndex).className = ""hlnumber"""&vbNewLine:Else If Not l9 Then v=v&"  If lIndex = 0 Then Document.getElementById(""tdNumber0"").className = ""hlnumber"""&vbNewLine:End If:End If:v=v&"End Sub"&vbNewLine&"Sub NumOut(lIndex)"&vbNewLine&"Dim sClass"&vbNewLine&"  If lIndex = 0 Then sClass = ""head"""&vbNewLine&"  Document.getElementById(""tdNumber"" & lIndex).className = sClass"&vbNewLine&"End Sub"&vbNewLine&" --></script>":v=v&"<body class='tbl'><div class='tableContainer'><table cellspacing='0'><thead><tr><td width='4%' class='head'>":v=v&"<input type='checkbox' name='chk0' checked":od=Sdb.INIfiLE.BoOLvaLue("Appearance","ShowToolTips"):If od Then v=v&" title='Select or deselect all presets'":End If:v=v&"/>":v=v&"</td><td width='4%' class='head'>#</td><td class='head' id='tdNumber0'":If Not o8 Or Not l9 Then v=v&" OnMouseOver='NumOver(0)' OnMouseOut='NumOut(0)' style='cursor: default'":If od Then v=v&" title='Sort presets alphabetically'":End If:End If:v=v&">Presets from ":If Not o8 Then v=v&"MediaMonkey.ini":Else v=v&ok:If l9 Then v=v&" (read-only)":End If:End If:j8=v&"</td></tr></thead><tbody>":c5.SethtMLDOCument j8&"</tbody></table></div></body></html>":End Sub:Sub io(a):Dim ff,s,a5,op:If CLng(o3.Value)>oSongList.Count Then o3.Value=oSongList.Count:Else If oSongList.Count=0 Then o3.Value=0:pm=1:az=0:Else If CLng(o3.Value)<1 Then o3.Value=1:End If:End If:End If:ff=nt:If(m9-1)\fq=(o3.Value-1)\fq Then nt=True:Else pm=((o3.Value-1)\fq)*fq+1:az=pm+fq-1:If az>oSongList.Count Then az=oSongList.Count:End If:End If:If lSongIndex<o3.Value Then a5=True:Else a5=False:End If:lSongIndex=o3.Value:m9=lSongIndex:Set oSongData=oSongList.Item(lSongIndex-1):oq:If nt And Not ff Then With jb.iNtERF.document:Set s=.ALl.item("trRow"&lSongIndex):If Not s Is Nothing Then If a5 Then If s.ofFSEtTop+s.ofFsEtHeight>.BoDY.SCROLlTOP+.bOdy.OFFSethEIgHT Then s.ScRoLLINToVieW False:End If:Else op=.aLl.TAgS("thead").item(0).oFFsEtheIgHt:If s.OFfSeTTOp-op<.BoDY.scrolltOp Then s.sCrollINtOvIEW True:.BoDY.SCrolLTOP=s.offsetTOp-op:End If:End If:End If:End With:End If:lj:nt=ff:End Sub:Sub il():Dim s,op:If b<2 Then Exit Sub:End If:If o8 And l9 Then Exit Sub:End If:ei b:With c5.INtErF.document:Set s=.ALl.item("trRow"&b):If Not s Is Nothing Then s.clAsSnAme="even":End If:b=b-1:Set s=.alL.item("trRow"&b):If Not s Is Nothing Then s.clAssNAME="select":op=.ALL.tAGS("thead").item(0).OFFsEtheIGht:If s.OffseTTop-op<.body.scroLLTOP Then s.ScroLLiNtOViEw True:.BoDy.ScrOLltOP=.boDY.sCRoLltOP-op:End If:End If:End With:If b=i6-1 Then bk.CoMmon.eNABLEd=True:End If:End Sub:Sub OnStartUp():Dim m2,o7,nq,ey,m4,my,bo,l7,qc,n7,gk,h,hl,w,x,m,z,e,q,c,o,p,q5,eh,a2,jo,aj,at,r0:If SDb.oBjECtS("RegExpObject")Is Nothing Then Set SDB.objEcTs("RegExpObject")=CreateObject("Scripting.Dictionary"):With sDB.ObJECts("RegExpObject"):.Add"OptionSheet",sdb.UI.AddoPtioNShEeT("RegExp Find and Replace",scriPt.sCRIPtpATh,"iz","b3",-1):End With:End If:Set w=New RegExp:w.IgnoreCase=True:w.Pattern="^Preset(\d+) ?= ?(""?(?:""""|[^""])*?"", ?(?:""(?:""""|[^""])*?"", ?){10}""[^""]*?""?)$":Set m=sdb.IniFile.kEyS("RegExpPresets"):For at=m.Count-1 To 0 Step-1:e=m.Item(at):If w.Test(e)Then Set x=w.Execute(e):q=Int(x.Item(0).SubMatches.Item(0)):If q>0 Then m.Item(at)=Right("00000"&q,6)&"="&x.Item(0).SubMatches.Item(1):Else m.DELEte at:End If:Else m.deLetE at:End If:Next:If m.Count Then m.soRt:If sDb.mESSAgEBoX("You have "&m.Count&" preset"&IIf(m.Count>1,"s","")&" from the old version of the RegExp script."&vbCr&vbCr&"Do you want to convert them to the new format?",mtconfirMAtIon,Array(MbyES,MBNO))=MrYES Then SDB.iniFile.DELeteSECTIOn"RegExpPresets":For at=0 To m.Count-1:e=m.Item(at):c=Mid(e,InStr(e,"=")+1):If Left(c,1)<>Chr(34)And Right(c,1)<>Chr(34)Then c=Chr(34)&c&Chr(34):End If:ae at+1,"Name: "&l(c,0)&", Description: "&l(c,1)&", Shortcut: "&l(c,2)&", FindWhat: "&l(c,3)&", FindInto: "&l(c,4)&", FindRegExp: "&pj(l(c,5))&", WholeWord: "&pj(l(c,6))&", ReplaceWith: "&l(c,7)&", ReplaceFrom: "&l(c,8)&", ReplaceRegExp: "&pj(l(c,9))&", ReplaceVBScr: "&pj(l(c,10))&", MatchCase: "&pj(l(c,11)):Next:End If:End If:gk=Left(scRiPt.ScrIpTpaTh,InStrRev(sCriPt.ScriPTPAtH,"\"))&"RegExpReplace.ini":If sDB.tOOLS.FileSystem.fILeEXisTS(gk)Then Set h=sdB.tOoLs.inIfiLEbYpaTh(gk):If Not h Is Nothing Then Set n7=CreateObject("Scripting.FileSystemObject"):hl=CStr(be(n7.getFILe(gk).dATElAStMOdifiEd)):If SdB.INifile.StriNgVALuE("RegExpOptions","IniDate")<>hl Then Set m=h.KeYS("RegExpPresets"):If m.Count>0 Then Call ha(h,False,True):sdb.iNiFiLe.sTringvALue("RegExpOptions","IniDate")=hl:End If:End If:End If:End If:w.Pattern="^Preset(\d+) ?=.*Name: ?""((?:""""|[^""])*)""":Set m=SDB.InIfIle.KeYs("RegExpPresets"):If m.Count>0 Then Set q5=CreateObject("Scripting.Dictionary"):at=m.Count:On Error Resume Next:For z=m.Count-1 To 0 Step-1:e=m.Item(z):If w.Test(e)Then c="="&LTrim(Mid(e,InStr(e,"=")+1)):Set x=w.Execute(e):q=Int(x.Item(0).SubMatches.Item(0)):o=Replace(x.Item(0).SubMatches.Item(1),Chr(34)&Chr(34),Chr(34)):If Not q5.exISts(o)Then m.Item(z)=Right("00000"&q,6)&c:If q>0 Then q5.ADD o,q:If at<q Then qc=True:End If:at=q:End If:Else If q=0 Then m.Item(z)="000000"&c:Else qc=True:m.DELETe z:End If:End If:Else qc=True:m.dEletE z:End If:Next:On Error GoTo 0:If m.Count Then m.SorT:If Left(m.Item(0),6)="000000"Then at=0:Else at=1:End If:If qc Or Int(Left(m.Item(m.Count-1),6))<>m.Count-1+at Then If sDb.MESSAgeBOX("You have empty, duplicated or unsorted RegExp preset(s)."&vbCr&"Such presets could cause malfunctioning of the RegExp add-on."&vbCr&vbCr&"Do you want to clean/sort the problematic presets?",mtConFiRmATioN,Array(mbYes,mbnO))=mryES Then SDB.INifIlE.deLEtESeCTiON"RegExpPresets":For z=0 To m.Count-1:e=m.Item(z):c=Mid(e,InStr(e,"=")+1):ae z+at,c:Next:End If:End If:End If:End If:Dim e1:e1=Now:Set h=sDB.INifILE:With h:If Len(.sTrInGVALUe("RegExpOptions","ConfirmPresetUpdate"))=0 Then .BoOlvaLUe("RegExpOptions","ConfirmPresetUpdate")=True:End If:If Len(.strINgVAlUE("RegExpOptions","ConfirmPresetExecute"))=0 Then .BoOLValUE("RegExpOptions","ConfirmPresetExecute")=True:End If:If Len(.sTRiNgvALUE("RegExpOptions","ShowPresetAdjustDialog"))=0 Then .bOOLvALuE("RegExpOptions","ShowPresetAdjustDialog")=True:End If:If Len(.stRiNGVAlUe("RegExpOptions","DeleteEmptiedFolders"))=0 Then .bOOLvALUe("RegExpOptions","DeleteEmptiedFolders")=.boOlVALue("Auto-organize","DeleteEmptiedFolders"):End If:If Len(.StRIngVAlue("RegExpOptions","MaxTableRowNumber"))=0 Then .iNtvaluE("RegExpOptions","MaxTableRowNumber")=25:End If:If Len(.sTrINgvALuE("RegExpOptions","TrimToolbarCaption"))=0 Then .iNTvaLUe("RegExpOptions","TrimToolbarCaption")=15:End If:If Len(.STRingvalUe("RegExpOptions","ShowFindReplaceButton"))=0 Then .BOOLVALuE("RegExpOptions","ShowFindReplaceButton")=True:End If:If Len(.StringValuE("RegExpOptions","ShowPresetsButton"))=0 Then .BOoLVaLue("RegExpOptions","ShowPresetsButton")=True:End If:If Len(.sTRingvaluE("RegExpOptions","ShowLastPresetButton"))=0 Then .BOoLVAluE("RegExpOptions","ShowLastPresetButton")=True:End If:If Len(.stRiNGVaLuE("RegExpOptions","LastPresetOnStartup"))=0 Then .boOLvalue("RegExpOptions","LastPresetOnStartup")=False:End If:If Len(.stRingvaLUe("RegExpOptions","ShowToolbarButtons"))=0 Then .bOolvAlUE("RegExpOptions","ShowToolbarButtons")=True:End If:If Len(.sTrINgVAlUE("RegExpOptions","ModelessWindow"))=0 Then .BoolValUe("RegExpOptions","ModelessWindow")=True:End If:If Len(.sTringVAlUe("RegExpOptions","SynchronizedTracks"))=0 Then .BOoLvaLue("RegExpOptions","SynchronizedTracks")=True:End If:End With:Set SDB.OBjeCTs("mnuRegExpGroupToolbar")=CreateObject("Scripting.Dictionary"):Set sdB.oBJEcTs("mnuRegExpGroupMainMenu")=CreateObject("Scripting.Dictionary"):Set sDB.OBJeCts("mnuRegExpGroupTracklist")=CreateObject("Scripting.Dictionary"):Set Sdb.OBjectS("mnuRegExpGroupNowPlaying")=CreateObject("Scripting.Dictionary"):If SdB.versiOnHi>=3 Then Set SDb.oBjeCTs("mnuRegExpGroupTracklistNP")=CreateObject("Scripting.Dictionary"):End If:Set SDb.ObJeCTs("mnuRegExpPresetToolbar")=CreateObject("Scripting.Dictionary"):Set SDB.ObjecTs("mnuRegExpPresetMainMenu")=CreateObject("Scripting.Dictionary"):Set sdB.obJecTS("mnuRegExpPresetTracklist")=CreateObject("Scripting.Dictionary"):Set sdB.oBjECtS("mnuRegExpPresetNowPlaying")=CreateObject("Scripting.Dictionary"):If SDB.VeRSIONhI>=3 Then Set sdB.OBJECtS("mnuRegExpPresetTracklistNP")=CreateObject("Scripting.Dictionary"):End If:If SDB.objEcTS("RegExpToolbar")Is Nothing Then If sdb.VERSIONhI<4 Then Set m2=sDB.Ui.MEnU_tbseaRCH:Else If SDb.VErSIonbuIld<1378 Then Set m2=sdB.UI.MENu_TbSEaRch:Else Set m2=SdB.ui.ADdtOoLBAR("RegExp Find and Replace"):End If:End If:Set sDb.oBJeCTs("RegExpToolbar")=m2:Else Set m2=sDb.oBJECTS("RegExpToolbar"):End If:If Sdb.oBJEcTS("tbrRegExpReplaceDialog")Is Nothing Then SdB.ui.aDdMENUiTEmSep m2,0,0:Set nq=sdb.ui.aDdMenUiTEM(m2,0,0):With nq:.caPTion=SDb.loCaLIZE(ch):.HInT=ba:.IcONiNdEX=19:.USescriPT=sCript.SCrIPtPatH:.ONCLICkFuNc="hj":End With:SDb.OBjeCtS("tbrRegExpReplaceDialog")=nq:End If:eh=h.BooLvAlue("RegExpOptions","ShowFindReplaceButton"):sDb.objectS("tbrRegExpReplaceDialog").visIBle=eh:If SdB.OBjeCts("mnuRegExpToolbar")Is Nothing Then Set o7=SdB.UI.aDdMEnuItEmsuB(m2,0,0):With o7:.cApTION=sdb.LOcAliZe("RegExp Tagging Presets"):.iCONINDeX=44:End With:Else Set o7=sDb.objeCTs("mnuRegExpToolbar"):End If:If sdb.ObjECtS("tbrRegExpExecuted")Is Nothing Then Set nq=Sdb.uI.adDmenUiTem(m2,0,0):With nq:.cAPtIoN="":.USeScriPt=ScRiPt.sCriptPAth:.ONCLICKFUNc="jl":End With:Sdb.ObJEcTs("tbrRegExpExecuted")=nq:End If:SDB.OBjECTs("tbrRegExpExecuted").ViSIBlE=False:If Sdb.OBJectS("mnuRegExpMainMenu")Is Nothing Then SDB.ui.AdDMeNUiteMsep sdb.ui.MENU_EdIT,0,0:Set ey=sDb.uI.ADDmenUitEMsUb(sDB.Ui.mENu_EdiT,5,0):With ey:.cAptION=Sdb.LOCalIze(ch):.hINt=ba:.IcONIndex=19:End With:Else Set ey=sDB.OBjEcts("mnuRegExpMainMenu"):ey.ViSIBle=True:End If:If SdB.ObjECts("mnuRegExpTracklist")Is Nothing Then sDb.Ui.addmENuiTeMSeP SDb.uI.menU_POP_tracklISt,-2,0:Set m4=sDB.Ui.aDDMENuITeMSUB(SDb.UI.menU_poP_TrACkLiST,-2,0):With m4:.CAPtION=sdb.LOcaLIze(ch):.icoNiNdex=19:End With:Else Set m4=SDB.obJECts("mnuRegExpTracklist"):m4.vISibLe=True:End If:If sDb.ObjeCTs("mnuRegExpNowPlaying")Is Nothing Then SdB.uI.ADDMENUitEMSeP SdB.UI.menU_pOP_Np,-3,0:Set my=sdB.uI.AdDMenuITemsUB(SdB.Ui.mENU_poP_NP,-3,0):With my:.cAptiOn=Sdb.loCALIZe(ch):.iCONiNdEx=19:End With:Else Set my=sDb.oBJecTS("mnuRegExpNowPlaying"):my.VisiblE=True:End If:If SDB.vERsIONhi>=3 Then If SDb.oBJEctS("mnuRegExpTracklistNP")Is Nothing Then sdB.Ui.aDdmenuItemSeP SDb.Ui.MENu_Pop_Np_maINWInDow,-2,0:Set bo=sdB.Ui.AddMeNUiTEmSub(SdB.ui.meNU_POp_Np_MainWiNdow,-2,0):With bo:.cAptIoN=sdb.lOCALiZE(ch):.iconinDex=19:End With:Else Set bo=SDB.ObjeCtS("mnuRegExpTracklistNP"):bo.ViSIBlE=True:End If:End If:jo=sDb.LOCalIZe("Preset Settings..."):aj="Find and replace tags or edit RegExp presets":If sDB.ObJecTs("mnuRegExpToolbar")Is Nothing Or SDB.ObJecTS("mnuRegExpFindRplcToolbar")Is Nothing Then Set nq=sDB.UI.aDDmeNUitEm(o7,0,0):With nq:.CapTION=jo:.HInt=aj:.IcONinDEX=19:.USeSCrIPT=SCrIPT.SCriptpAth:.oncLiCKfunC="hj":End With:sDB.oBjeCTS("mnuRegExpFindRplcToolbar")=nq:End If:sDB.oBjects("mnuRegExpFindRplcToolbar").vISiBLE=Not eh:If sDB.OBjEcTS("mnuRegExpMainMenu")Is Nothing Or Sdb.obJects("mnuRegExpFindRplcMainMenu")Is Nothing Then Set l7=sdB.Ui.ADDmenUItem(ey,0,0):With l7:.CAPtiON=jo:.hINt=aj:.iCONiNDEX=12:.shORTcUT=fk:.uSEScRipt=scRipt.ScRIptpatH:.onCLIckfUnC="hj":End With:sdB.obJEcts("mnuRegExpFindRplcMainMenu")=l7:End If:If sDB.oBjEcts("mnuRegExpTracklist")Is Nothing Or SDb.OBJects("mnuRegExpFindRplcTracklist")Is Nothing Then Set l7=Sdb.Ui.aDDMENuITEM(m4,0,0):With l7:.CAptIoN=jo:.HINT=aj:.IConINDex=12:.SHORTCut=fk:.UsEsCRIPT=sCrIpT.SCriPTPAtH:.ONClicKFuNC="hj":End With:sDb.OBjeCts("mnuRegExpFindRplcTracklist")=l7:End If:If sdB.objECTS("mnuRegExpNowPlaying")Is Nothing Or SDB.OBjECtS("mnuRegExpFindRplcNowPlaying")Is Nothing Then Set l7=SDb.uI.aDdMenUItem(my,0,0):With l7:.CaptiON=jo:.Hint=aj:.iCoNiNDex=12:.ShOrTCUT=fk:.USesCrIpT=ScriPt.SCRipTPaTH:.OnClICkfuNc="hj":End With:SDB.ObJecTs("mnuRegExpFindRplcNowPlaying")=l7:End If:If SDb.VersiONhI>=3 Then If sDB.OBJECTS("mnuRegExpTracklistNP")Is Nothing Or sDB.oBjEctS("mnuRegExpFindRplcTracklistNP")Is Nothing Then Set l7=SdB.ui.ADDmeNuiteM(bo,0,0):With l7:.CapTiOn=jo:.HInt=aj:.ICONINDEX=12:.SHORtCUt=fk:.usEscRIpt=ScrIpT.ScrIpTPATh:.ONCLIcKFUnc="hj":End With:sDB.obJeCTs("mnuRegExpFindRplcTracklistNP")=l7:End If:End If:If sDb.OBjeCts("mnuRegExpToolbar")Is Nothing Then sdb.OBjects("mnuRegExpToolbar")=o7:q4"Toolbar":End If:sDB.ObjECts("mnuRegExpToolbar").Visible=h.boOLVaLUe("RegExpOptions","ShowPresetsButton"):If SdB.oBjecTs("mnuRegExpMainMenu")Is Nothing Then Sdb.OBJecTS("mnuRegExpMainMenu")=ey:q4"MainMenu":Else sDB.oBJECtS("mnuRegExpMainMenu").ViSiblE=True:End If:If Sdb.ObJECts("mnuRegExpTracklist")Is Nothing Then sDB.ObjECts("mnuRegExpTracklist")=m4:q4"Tracklist":Else SDB.objeCTS("mnuRegExpTracklist").VISiBlE=True:End If:If sdB.ObJeCTs("mnuRegExpNowPlaying")Is Nothing Then SDB.oBjEcTS("mnuRegExpNowPlaying")=my:q4"NowPlaying":Else Sdb.objects("mnuRegExpNowPlaying").VisIbLe=True:End If:If Sdb.VerSIOnhi>=3 Then If SDb.OBjECTs("mnuRegExpTracklistNP")Is Nothing Then SdB.OBJECtS("mnuRegExpTracklistNP")=bo:q4"TracklistNP":Else SDB.objECTS("mnuRegExpTracklistNP").vISIbLE=True:End If:End If:kd=h.BoolvAluE("RegExpOptions","ShowPresetAdjustDialog"):a2=h.iNTvALUE("RegExpOptions","LastExecutedPreset"):Set m=h.keYS("RegExpPresets"):For z=0 To m.Count-1:e=m.Item(z):If w.Test(e)Then Set x=w.Execute(e):q=Int(x.Item(0).SubMatches.Item(0)):If q>0 Then c=Mid(e,InStr(e,"=")+1):p=l(c,"Menu"):ja c,p:If q=a2 Then kg c:pl True,h.BOOLVALUE("RegExpOptions","ShowLastPresetButton"):If Not h.bOOlvalue("RegExpOptions","LastPresetOnStartup")Then Sdb.ObjecTs("tbrRegExpExecuted").VisiblE=False:End If:End If:End If:End If:Next:ho:If sdb.verSiOnhI>=3 Then On Error Resume Next:If SdB.vErsIonBuILd<1218 Then mp="Artist;Album;Album Artist;Title;Genre;Composer;Lyricist;Conductor;Grouping;Custom 1;Custom 2;Custom 3;Custom 4;Custom 5;Original Artist;Original Title;Mood;Tempo;Occasion;Quality;Involved People":Else If SDB.vErSIONHi<4 Then Set SdB.ObjeCTS("RFROptionsTimer")=SdB.cREAtEtImEr(200):SCrIPT.REGISTeREvent SDB.oBjeCTS("RFROptionsTimer"),"OnTimer","em":SdB.ObjECtS("RFROptionsTimer").EnAbLEd=True:End If:ScrIPT.rEGisTEReveNT SdB,"OnOptionsChange","le":End If:On Error GoTo 0:Else mp="Artist;Album;Album Artist;Title;Genre;Composer;Lyricist;Custom 1;Custom 2;Custom 3;Original Artist;Original Title;Mood;Tempo;Occasion;Quality;Involved People":End If:e1=DateDiff("s",e1,Now):If e1<10 Then:Else If Len(sDb.inIFile.STringValUE("RegExpOptions","SlowStartupInfo"))=0 Or sdb.INIfIle.BoOlvaLUE("RegExpOptions","SlowStartupInfo")=False Then Dim i2,a,ds:Set i2=Sdb.uI.NewFOrM:With i2:.bORdERStyle=2:With .cOMMON:at=.WidTH-.clIENtWIDtH:r0=.hEighT-.ClIENthEIGHt:.seTreCT 100,100,465+at,335+r0:.mINwidth=320:.minHeIGHT=240:End With:.foRMpOSItiON=4:.cAPTiOn="RegExp Find and Replace":End With:Set a=Sdb.Ui.nEwActiVEx(i2,"Shell.Explorer"):With a:With .comMoN:.ANchOrS=1+2+4+8:.sEtrECt 0,0,465,295:End With:.SETHtmlDOCUmeNt"<html><head><style type='text/css'>body {margin: 10px 10px; overflow: auto; border: none} </style></head><body>Please read carefully, this info will be shown only this time!<br /><br />RegExp Find & Replace add-on had very slow startup ("&e1&" seconds).<br />It is most probably caused by Windows Defender and its Real-Time Protection, which is already reported to <a href=""https://answers.microsoft.com/en-us/protect/forum/protect_defender-protect_scanning-windows_10/last-update-of-windows-defender-causes-terribly/c71cc133-5c5f-447e-95fb-e2641085836d?tm=1527000700529&lc=1033"">Microsoft</a>.<br />Until it fix this problem, you could do any of the next things:<br /><ul><li>turn off Windows Defender Real-Time Protection and use some another anti-malware; or<br /><li>remove all RFR presets that you don't need since this slow down is related to the number of installed presets; or<br /><li>donate to the author of RegExp Find & Replace and you will receive the <a href=""http://solair.eunet.rs/~zvezdand/RegExpReplaceNew.htm"">enhanced version</a> of the add-on which has implemented a workaround for this problem.</ul></body></html>":End With:Set ds=SDB.uI.newbuTTon(i2):With ds:With .cOMMon:.ancHORs=4+8:.SetreCt 380,303,75,24:End With:.cAptioN="&OK":.Default=True:.moDaLResULt=1:End With:i2.SHoWMoDaL:SdB.iniFIle.bOoLVAlue("RegExpOptions","SlowStartupInfo")=True:End If:End If:End Sub:Sub df(p,o,d5,bs,lf,gi):Dim en,qf,fc:en="mnuRegExpGroup"&gi:qf="mnuRegExpPreset"&gi:fc=p&"\"&o:If Not sDb.obJecTs(qf).EXIsTs(fc)Then If Not sDb.OBjectS(en).ExIStS(p)Then SDB.ObjeCTS(en).ADD p,sdB.uI.aDdMENuITEMsUB(sDB.oBJects("mnuRegExp"&gi),0,0):sDB.OBJeCtS(en).Item(p).CAPtioN=Replace(p,"&","&&"):Else sDb.ObjECts(en).Item(p).vISIBLE=True:End If:SDB.ObJEctS(qf).ADd fc,sdb.UI.ADdmenuITem(sDB.Objects(en).Item(p),0,0):With SdB.oBjeCTs(qf).Item(fc):.UsESCript=SCripT.SCRIptPATH:.ONClIckfUnc="nd":End With:End If:With sdb.oBjEcTs(qf).Item(fc):.CaPTIOn=Replace(o,"&","&&"):.HiNT=d5:.iconINDex=bs:.sHorTcUt=lf:.visIBlE=True:End With:End Sub:Sub id(dk):q3.CommOn.enABLed=dk:pe.coMmon.ENaBLed=dk:End Sub:Sub ig():If Not p8 And Not l5 Then dy:If b=i6 Then bk.cOmmon.enaBLEd=False:End If:End If:End Sub:Sub h3():With ma:If Len(i4)>0 And Len(a0)>0 Then If ci Then If Not oy Then If iq<>i4 Then .CApTioN="Add":Else .capTiON=" Update":End If:End If:.CommoN.ENabLED=True:Else If iq<>i4 Then If Not oy Then .CaPtiOn=" Rename":End If:.COMMON.ENabLED=True:Else .COmmoN.ENABlEd=False:End If:End If:Else .CoMmON.ENABLED=False:End If:End With:If IsObject(qk)Then With qk.COmMon:If y>-1 Then .eNAbLEd=True:Else .EnablEd=False:End If:End With:End If:End Sub:Sub lg():With sDB.cOmMONdiAlOG:.deFaulTEXT="ico":.Filter="Icon file (*.ico)|*.ico":.FLAgs=cdLOFnHIDEREadONLy:If Len(o2)=0 Or IsNumeric(o2)Then .iniTDiR=Left(ScriPt.ScRIpTpAth,InStrRev(SCriPT.sCrIPTPATh,"\")):End If:.tiTle="Select an icon file":.SHowOpen:If .Ok And o2<>.FIlENAME Then If mg.iTEmiNDEx>0 Then mg.ITEmINDEX=0:End If:o2=.FiLeNamE:g2.INTERf.document.bODY.innerhTmL="<img src="""& o2&""">":h3:End If:End With:End Sub:Sub mb():Dim e6,qn,kp,s,cn,h,q:Set qn=c5.Interf.document.AcTiveeleMeNt:Set cn=c5.iNtErf.document.ALL:If Not qn Is Nothing Then If Len(qn.gETAttrIbUtE("Name"))Then If qn.name="chk0"Then jk=qn.cheCkeD:Set e6=CreateObject("Scripting.Dictionary"):For q=1 To i6:e6.Add q,jk:Set s=cn.item("chk"&q):If Not s Is Nothing Then s.CHEckED=jk:End If:Next:Set sDb.objectS("PrstChkColl")=e6:If jk Then ob=i6:Else ob=0:End If:kp=True:Else If Left(qn.NAmE,3)="chk"Then q=CLng(Mid(qn.naMe,4)):If sdB.OBJEcTS("PrstChkColl").Item(q)And Not qn.CHeCKeD Then ob=ob-1:Else If Not sDB.oBJeCTS("PrstChkColl").Item(q)And qn.CheCkEd Then ob=ob+1:End If:End If:SDB.ObjectS("PrstChkColl").Item(q)=qn.ChEcKED:kp=True:End If:End If:If kp Then r9.cOMMOn.enABled=(ob>0 And(o8 Imp Not l9)):If Not o8 Then qm.COmmoN.ENaBlED=(ob>0):Else If sDB.toOLS.FileSystem.filEexiSTs(ok)Then dw.coMMoN.enABleD=(ob>0):End If:End If:End If:Else If Left(qn.Id,8)="tdNumber"Then q=CLng(Mid(qn.Id,9)):If q>0 And Not o8 Then kz q:Else If q=0 And i6>1 Then If o8 And l9 Then Exit Sub:End If:If SDb.mESsAgEBox("Are you sure that you want to sort "&i6&vbCr&"RegExp presets from the "&IIf(Not o8,"MediaMonkey.ini","specified")&" file?",mTCoNFirmATIoN,Array(mByeS,mBNO))=mrnO Then Exit Sub:End If:If o8 Then Set h=SDB.tOoLs.INIFiLEByPAtH(ok):If h Is Nothing Then Exit Sub:End If:End If:b=0:ql h,True:fv:End If:End If:Else If Left(qn.id,8)="tdPreset"Then q=CLng(Mid(qn.iD,9)):i3 q,cn:End If:End If:End If:If b>0 Then np.CaptION="1/"&i6:Else np.cAPtiOn=ob&"/"&i6:End If:End If:End Sub:Sub px():Dim b0,s,g,sAfter,r4,hd,e0:r4=sdb.iNIfIle.bOoLvaLUe("RegExpOptions","DeleteEmptiedFolders"):hd=sdB.INIFiLe.boOlvaLue("Options","StoreID3AfterEdit"):If Not oh(hd,r4)Then SDb.mEsSAGeBox Err.Source&vbCr&vbCr&Err.Description,mterRor,Array(mBok):Else SdB.PROCeSsmessaGEs:b0=m9:Set e0=oSongData:Set oSongData=e0.getCOpY:g=cm(qo):sAfter=r2(g):Set oSongData=e0:SDb.PRocesSmESSAGeS:qw:If(m9-1)\fq=(b0-1)\fq Then cy b0,g,sAfter:End If:If lr(jz.TexT,True)Then hn jz,jz.TExT,0:End If:End If:End Sub:Sub ho():Dim w,x,m,z,e,q,c,gm,o,bs,jo,ik,hz,oo:ik=0:hz=sdb.iNIfile.boolVAlUE("RegExpOptions","ShowToolbarButtons"):oo=sDB.iNiFilE.inTvAlUE("RegExpOptions","TrimToolbarCaption"):Set w=New RegExp:w.IgnoreCase=True:w.Pattern="^Preset(\d+) ?=.*Name: ?""((?:""""|[^""])*)""":Set m=SdB.iNifiLE.kEYS("RegExpPresets"):For z=0 To m.Count-1:e=m.Item(z):If w.Test(e)Then Set x=w.Execute(e):q=Int(x.Item(0).SubMatches.Item(0)):If q>0 Then c=Mid(e,InStr(e,"=")+1):gm=l(c,"Toolbar"):If gm="1"Or LCase(gm)="true"Then ik=ik+1:If SDb.OBjEctS("tbbRegExpButton"&ik)Is Nothing Then Set sDb.OBJEcTs("tbbRegExpButton"&ik)=SdB.UI.addMENUITem(sdb.ObjECTS("RegExpToolbar"),0,0):End If:et c,o,bs:jo=Left(o,oo):If Len(o)>CLng(oo)Then jo=jo&".":End If:With sDB.oBjectS("tbbRegExpButton"&ik):.CaptioN=Replace(jo,"&","&&"):.hINt=o:.IcONinDEX=bs:.USesCRipt=sCriPT.ScrIpTpaTH:.ONcLICKFUnC="jl":.viSIBLE=hz:End With:End If:End If:End If:Next:ik=ik+1:Do While Not SDB.OBJecTs("tbbRegExpButton"&ik)Is Nothing:With SdB.oBjeCtS("tbbRegExpButton"&ik):.CaptIOn="":.HInt="":.IcOniNdeX=-1:.ViSIBle=False:End With:ik=ik+1:Loop:End Sub:Function IfNull(qh,fo):If Not IsNull(qh)Then IfNull=qh:Else IfNull=fo:End If:End Function:Function eu():Dim ay,av,dm,d6,g3,kv,qd,l8,ou,at:On Error Resume Next:at=sDB.VERSiONbuILD:If Err=0 And at>=1210 Then at=SDb.ui.MAinWiNdowfoCUs:If Err=0 Then If at=4 Then eu=True:Else eu=False:End If:Exit Function:End If:End If:On Error GoTo 0:If Sdb.aLlvIsIBLESongLIST.Count=0 And SdB.PlAYeR.pLaYLIsTCoUnT=0 Or SdB.plAyer.PlAYLISTcOuNT<sdb.SeLeCTEDSOnGLiSt.Count Then eu=False:Exit Function:Else If SDb.alLVIsibLESONgLISt.Count<Sdb.SElEctEDSONglIsT.Count Then eu=True:Exit Function:End If:End If:Set qd=CreateObject("WScript.Shell"):g3=0:Set dm=sdb.PLAyER.CurrentSOnGLiSt:If sDb.seLEctEDsongliST.Count>0 Then Set ay=sDb.SELECTeDsONGLISt:Set av=ay.Item(0):For at=0 To dm.Count-1:Set d6=dm.Item(at):If d6.id=av.Id Then g3=g3+1:If g3=1 Then kv=at:End If:If g3<ay.Count Then Set av=ay.Item(g3):Else Exit For:End If:Else If dm.Count-at<=ay.Count-g3 Then eu=False:Exit Function:End If:End If:Next:l8=False:Else If sDb.VErsionHI<3 Then eu=False:Exit Function:Else qd.SENdkeYS"^{PGUP}":SdB.PRoCesSmeSsAGES:Set ay=sDb.SElEcTeDSoNgLISt:If ay.Count=0 Then If sdb.ALlViSIBlESonGLisT.Count>0 And dm.Count=0 Then eu=True:Else eu=False:End If:Exit Function:Else If dm.Count>0 Then Set av=ay.Item(0):For at=0 To dm.Count-1:Set d6=dm.Item(at):If d6.id=av.ID Then g3=g3+1:If g3=1 Then kv=at:End If:If g3<ay.Count Then Set av=ay.Item(g3):Else Exit For:End If:Else Exit For:End If:Next:If g3=ay.Count Then g3=0:Else:End If:Else g3=-1:End If:End If:l8=True:End If:End If:If eu Then:Else If g3<>ay.Count Then eu=False:Else Set ou=sdB.DATabAse.quERySoNgs("AND Songs.ID <> "&ay.Item(0).iD):If Not ou.EOF Then sDb.plAYER.pLaYlIStaDDTrAck ou.Item:sdB.PLaYeR.pLAyLIstMOveTRaCk sDB.PlaYeR.CurrEntsoNGlist.Count-1,kv:If ay.Item(0).ID=SdB.SelECteDSONGLIST.Item(0).ID Then eu=False:Else eu=True:End If:sdB.PlaYer.plaYlIStDElete kv:Else eu=False:End If:Set ou=Nothing:End If:End If:If l8 Then qd.sENdKeYs"^ ":SDB.ProCEsSMessagEs:ft=False:End If:End Function:Sub f9():If oSongList.Count>0 Then o3.coMMoN.ENABleD=True:Else o5 False:End If:End Sub:Function d1(au):Dim t:t=c4.KEys:If ht.Exists(t(mx))Then d1=Replace(ht.Item(t(mx)),"sAfter",au):Else d1="oSongData."&c4.Item(t(mx))&" = "&au:End If:End Function:Sub jn(a):Dim qd:bl=a.IteMindEX:dj:Set qd=CreateObject("WScript.Shell"):qd.SendKEYS"%e":End Sub:Sub qw():Dim at,r0,g,os,j6,k3,jo:If Not ft Then ft=True:c3 False:jo=f8.CAptIoN:f8.CapTiON="&Cancel":f8.coMMon.enaBLED=True:Set os=SDB.PROGResS:If ks.CHEckeD Then j6=0:k3=-1:Else j6=oSongList.Count-1:k3=1:End If:os.MAXVaLUE=oSongList.Count-1:os.Value=lSongIndex:r0=CLng(Timer*10):For at=lSongIndex-1+k3 To j6 Step k3:Set oSongData=oSongList.Item(at):g=cm(jf.iteMInDEX):If bp(g)Then c3 True:o3.Value=at+1:Exit For:End If:If CLng(Timer*10)>r0 Then SdB.ProcESSmEssaGEs:If os.TErMinATe Or Not ft Then c3 True:o3.Value=at+1:Exit For:End if:os.Value=at-1:os.tExT=SdB.locALIze("Searching for string in #"&at&" of "&oSongList.Count&" "&IIf(sDb.versIOnHI<4,"track","file")&"s..."):r0=CLng(Timer*10):End If:Next:If at>=oSongList.Count-1 Or at<=0 Then c3 True:Set oSongData=oSongList.Item(lSongIndex-1):oq:f8.COMmOn.ENABLed=False:cg=True:End If:If Not oy Then qb:End If:it:lb:lj:If lr(mt.TExt,False)Then hn mt,mt.TeXT,0:End If:f8.CAPtIoN=jo:End If:ft=False:End Sub:Function pf(cd):pf=Replace(cd,"&","&amp;"):ef.Pattern="(^|\x01|\x02|\x03)( )":pf=ef.Replace(pf,"$1&nbsp;"):pf=Replace(pf,"  "," &nbsp;"):pf=Replace(pf,"<","&lt;"):pf=Replace(pf,">","&gt;"):pf=Replace(pf,"""","&quot;"):pf=Replace(pf,vbNewLine,"<br />"):End Function:Sub ln(dk):Dim ik:Sdb.ObjeCTS("tbrRegExpReplaceDialog").eNablED=dk:SdB.OBJEcTs("mnuRegExpToolbar").enableD=dk:sDB.ObJECtS("tbrRegExpExecuted").eNAbLED=dk:sDb.obJECTS("mnuRegExpMainMenu").eNAbLed=dk:Sdb.Objects("mnuRegExpTracklist").eNABLed=dk:SDB.oBjECTs("mnuRegExpNowPlaying").enaBLeD=dk:If sDb.vERSIonHI>=3 Then Sdb.OBjECtS("mnuRegExpTracklistNP").eNabLEd=dk:End If:ik=1:Do While Not sdB.ObJECTS("tbbRegExpButton"&ik)Is Nothing:SdB.obJeCTs("tbbRegExpButton"&ik).eNABLeD=dk:ik=ik+1:Loop:End Sub:Dim d7:If sdB.VeRSIoNhi<3 Then ReDim d7(3):Else ReDim d7(5):End If:Function po(q,p):Dim w,x,m,z,e,qx,br:br=0:Set w=New RegExp:w.IgnoreCase=True:w.Pattern="^Preset(\d+) ?=.*Name: ?""((?:""""|[^""])*)""":Set m=sDb.InifILE.kEYS("RegExpPresets"):For z=0 To m.Count-1:e=m.Item(z):If w.Test(e)Then Set x=w.Execute(e):qx=Int(x.Item(0).SubMatches.Item(0)):If qx>0 Then If p=l(e,"Menu")Then br=br+1:If q=qx Then Exit For:End If:End If:End If:End If:Next:po=br:End Function:Sub mh():If ms Then If SDB.meSSagEBOX("Are you sure that you want to delete preset #"&y+1&":"&vbCr&i4&"?",MtconfIrMaTION,Array(MbYeS,MbNo))<>MRyEs Then Exit Sub:End If:End If:pi y+1,bq,i4,True:End Sub:Sub q2():With g9:.cAPTiOn=oSongList.Count:If bn Then .caPTion=.CaPtioN&" selected":Else .CApTIon=.CapTIOn&" visible":End If:.CaPTIoN=.cApTIOn&" track":If oSongList.Count>1 Then .cAption=.CAPTION&"s":End If:End With:End Sub:Sub mz(a):Dim oc,gs,ez,f4:If k Or y<0 Then Exit Sub:End If:If y>Abs(a.Value)Then oc=q8(y+1):gs=q8(y):mr y+1,oc,gs:ez=n.ITEmTEXt(y):f4=n.ItemtEXT(y-1):n.ItEmteXt(y-1)=ez:n.ITeMtExt(y)=f4:y=y-1:Else oc=q8(y+2):gs=q8(y+1):mr y+2,oc,gs:ez=n.itEmtExt(y+1):f4=n.itEmTExT(y):n.itEMtExt(y)=ez:n.itEMteXt(y+1)=f4:y=y+1:End If:dx=y:n.ItEMinDEX=y:li:End Sub:Function Exchange(mi,cx):Dim at:Exchange=0:For at=0 To UBound(cx):If mi=cx(at)Then Exchange=at:Exit For:End If:Next:End Function:Sub b3(go):Dim gz,h,w,x,m,z,e,q,c,o,p,oo,a2,eh,e8,ke,qp,ne,jr,l2,r5:Set h=SdB.iNiFiLE:Set gz=go.cOMmoN:h.BOOLvaluE("RegExpOptions","ConfirmPresetUpdate")=gz.cHilDCOntrOL("ConfirmPresetUpdate").chEcKED:h.BooLvaluE("RegExpOptions","ConfirmPresetExecute")=gz.childcOnTrOL("ConfirmPresetExecute").CHeCKED:oo=gz.chIlDCoNtroL("TrimToolbarCaption").Value:If h.IntVAluE("RegExpOptions","TrimToolbarCaption")<>oo Then h.INtvALUE("RegExpOptions","TrimToolbarCaption")=oo:r5=True:End If:a2=h.IntvALUE("RegExpOptions","LastExecutedPreset"):kd=gz.ChILDCoNtRol("ShowPresetAdjustDialog").cheCKEd:If h.boOLVaLue("RegExpOptions","ShowPresetAdjustDialog")<>kd Then h.boolVALuE("RegExpOptions","ShowPresetAdjustDialog")=kd:Set w=New RegExp:w.IgnoreCase=True:w.Pattern="^Preset(\d+) ?=.*Name: ?""((?:""""|[^""])*)""":Set m=h.kEYS("RegExpPresets"):For z=0 To m.Count-1:e=m.Item(z):If w.Test(e)Then Set x=w.Execute(e):q=Int(x.Item(0).SubMatches.Item(0)):If q>0 Then c=Mid(e,InStr(e,"=")+1):p=l(c,"Menu"):ja c,p:If q=a2 Then kg c:End If:End If:End If:Next:r5=True:End If:h.bOOLVAluE("RegExpOptions","DeleteEmptiedFolders")=gz.CHiLDContrOl("DeleteEmptiedFolders").ChECkEd:h.IntVaLuE("RegExpOptions","MaxTableRowNumber")=gz.cHILDCOnTrol("MaxTableRowNumber").Value:eh=gz.chIldCONTROL("ShowFindReplaceButton").cHECkED:If h.BooLvaLue("RegExpOptions","ShowFindReplaceButton")<>eh Then sdB.OBJeCTs("tbrRegExpReplaceDialog").viSIbLE=eh:sDB.oBJEctS("mnuRegExpFindRplcToolbar").VisibLE=Not eh:h.boolVAlue("RegExpOptions","ShowFindReplaceButton")=eh:End If:e8=gz.ChILDcoNTRol("ShowPresetsButton").cHecKed:If h.booLVAlUE("RegExpOptions","ShowPresetsButton")<>e8 Then sdB.obJeCtS("mnuRegExpToolbar").VISible=e8:h.BOolVALue("RegExpOptions","ShowPresetsButton")=e8:End If:qp=gz.chIlDCONTRol("ShowToolbarButtons").ChEcKEd:If h.BoOLvalUe("RegExpOptions","ShowToolbarButtons")<>qp Then h.bOolvALuE("RegExpOptions","ShowToolbarButtons")=qp:r5=True:End If:If r5 Then ho:End If:ke=gz.cHIldCOnTroL("ShowLastPresetButton").ChEckED:If h.BOOlValUE("RegExpOptions","ShowLastPresetButton")<>ke Then h.BOOlVaLue("RegExpOptions","ShowLastPresetButton")=ke:If a2>0 Then pl True,ke:Else pl False,False:End If:End If:h.BoolValuE("RegExpOptions","LastPresetOnStartup")=gz.cHiLDCOntRol("LastPresetOnStartup").ChECkeD:jr=gz.cHiLDcoNtROl("ModelessWindow").cheCKeD:If h.bOolVaLUE("RegExpOptions","ModelessWindow")<>jr Then h.booLvAluE("RegExpOptions","ModelessWindow")=jr:If Not jr And IsObject(SDb.obJeCTs("RegExpDialog"))Then If Not sdB.ObJeCts("RegExpDialog")Is Nothing Then n8 Nothing:End If:End If:End If:l2=go.cOMMoN.ChILdConTrOl("SynchronizedTracks").cheCked:If h.boolvALue("RegExpOptions","SynchronizedTracks")<>l2 Then h.bOOLValUE("RegExpOptions","SynchronizedTracks")=l2:If jr And IsObject(sDB.objectS("RegExpDialog"))Then If Not Sdb.objEctS("RegExpDialog")Is Nothing Then On Error Resume Next:If sDb.VERsIONBUilD<1205 Then:Else If l2 Then jm:Else ScRIpT.unRegIsTERevENTS sdB:SCRipt.RegisTEreVENt sDb,"OnOptionsChange","le":End If:SCRiPT.rEGIsTErEveNT SDb,"OnTrackProperties","g8":End If:On Error GoTo 0:End If:End If:End If:End Sub:Sub fv():Dim v,h,e6,o4,m,z,e,q,c,od,ia,gv:Set e6=CreateObject("Scripting.Dictionary"):Set o4=CreateObject("Scripting.Dictionary"):jk=True:od=sdb.iniFIle.BOoLvaLuE("Appearance","ShowToolTips"):i6=0:b=0:ia="":v="":If o8 Imp sdB.toOLS.FileSystem.fILEEXIstS(ok)Then If o8 Then Set h=sdb.toOLS.InIfILeByPAth(ok):If h Is Nothing Then Exit Sub:End If:Set m=h.KeYs("RegExpPresets"):Else Set m=sDb.iNifiLE.kEYs("RegExpPresets"):End If:e7 m,False:gv=2+Round(Timer*10):For z=1 To m.Count:e=m.Item(z-1):c=Mid(e,InStr(e,"=")+1):e6.add z,True:o4.ADD z,c:v=v&"<tr id='trRow"&z&"' class='":If(z/2)=(z\2)Then v=v&"odd":Else v=v&"even":End If:v=v&"'><td><input type='checkbox' name='chk"&z&"' checked":v=v&"/><td id='tdNumber"&z&"'":If Not o8 Then v=v&" OnMouseOver='NumOver("&z&")' OnMouseOut='NumOut("&z&")' style='cursor: pointer'":If od Then v=v&" title='Edit preset #"&z&"'":End If:End If:v=v&">"&z&"</td><td id='tdPreset"&z&"'>"&ls(c)&"</td></tr>":If Abs(gv-Round(Timer*10))>2 Then ia=ia&v:v="":gv=Round(Timer*10):End If:Next:i6=m.Count:End If:c5.sEthtMLDOcuMeNT j8&ia&v&"</tbody></table></div></body></html>":Set SDb.obJEcTs("PrstChkColl")=e6:Set sdB.oBJectS("PrstStrColl")=o4:ob=i6:r9.comMon.eNABLeD=(ob>0 And(o8 Imp Not l9)):b2.cOmmON.ENAbLed=False:bk.COmMon.eNabLed=False:np.CapTIon=ob&"/"&i6:End Sub:Function be(ck):Dim b4,fn:be=ck:On Error Resume Next:For Each b4 In GetObject("winmgmts:").insTanCESoF("Win32_ComputerSystem"):fn=b4.cURRenttImezOnE:Next:On Error GoTo 0:If fn Then be=DateAdd("n",-fn,ck):End If:End Function:Sub j7(kl,gh,pk,ph,fj):p9 kl,gh,pk,ph,fj,"Toolbar":p9 kl,gh,pk,ph,fj,"MainMenu":p9 kl,gh,pk,ph,fj,"Tracklist":p9 kl,gh,pk,ph,fj,"NowPlaying":If SDb.versiOnhi>=3 Then p9 kl,gh,pk,ph,fj,"TracklistNP":End If:End Sub:Sub a7():Dim c,s,kp:If Not sDb.ObjEcts("RegExpDialog")Is Nothing Then On Error Resume Next:If SDB.veRSionbUIld<1205 Then:Else kp=ci:If fp Then Exit Sub:Else If kp Then c=q8(y+1):If sdB.objECTS("PrstStrColl").Item(y+1)<>c Then SDB.obJeCTs("PrstStrColl").Item(y+1)=c:Set s=c5.InterF.document.aLl.item("tdPreset"&y+1):If Not s Is Nothing Then s.INnERHtml=ls(c):End If:End If:End If:End If:n8 Nothing:End If:On Error GoTo 0:End If:End Sub:Sub q0(a):Dim e6,at:If Not bn Then Set oSongList=sDb.sELECTEDSoNGLisT:bn=True:Else If j9 Then Set oSongList=sDB.plAyer.CUrReNtSoNGLISt:Else Set oSongList=Sdb.aLLViSibleSONgLiSt:End If:bn=False:End If:lSongIndex=1:m9=1:pm=1:az=pm+fq-1:If az>oSongList.Count Then az=oSongList.Count:End If:Set oSongData=oSongList.Item(0):o3.mAxvAluE=oSongList.Count:If oSongList.Count=0 Then o3.MiNVaLue=0:o3.Value=0:Else o3.MINVALuE=1:o3.Value=1:End If:Set e6=CreateObject("Scripting.Dictionary"):For at=1 To oSongList.Count:e6.AdD at,hh:Next:Set sdB.oBjeCTs("CheckedTracks")=e6:If hh Then cs=oSongList.Count:Else cs=0:End If:q2:oq:lj:f9:End Sub:Function RegExp(l3,k0,m0):Dim w,x:Set w=New RegExp:w.Global=True:w.IgnoreCase=Not oi:w.Pattern=k0:Set x=w.Execute(l3):If x.Count>m0 Then RegExp=x.Item(m0).Value:End If:End Function:Function RegSub(l3,k0,du):Dim w:Set w=New RegExp:w.Global=True:w.IgnoreCase=Not oi:w.Pattern=k0:RegSub=w.Replace(l3,du):End Function:Sub ko(a):jv=a.cHeckEd:If jv And qg.cHecKed Then qg.CHEckED=False:Else lb:oq:End If:End Sub:Function IIf(p0,jc,he):If p0 Then IIf=jc:Else IIf=he:End If:End Function:Sub qu(a):lp.Item(a.COmmON.COnTrOlNAME)=a.TEXt:End Sub:Sub q6(a):mx=a.iTEmINDeX:If IsObject(ma)Then oq:End If:End Sub:Sub bb(a):lm=a.ChEckED:End Sub:Sub f0(qv,b6):If lp.ExIsTs(fs.aCTiVecoNtROL)Then gu fs.cOmmoN.chILDcOntROL(fs.AcTivEContRol):End If:End Sub:Sub lb():If jv Or pn Then ps.itEMIndEX=mx:ps.CoMMoN.eNABLED=True:Else ps.ITEmINDEx=-1:ps.cOmmoN.ENABLeD=False:End If:gn.COmmon.ENAbLEd=jv:h2.COmmOn.visIbLe=pn:End Sub:Sub jm():Set g7=sDB.CrEAteTimEr(100):g7.enabLed=False:ScRipt.REgIsTEREVenT g7,"OnTimer","es":On Error Resume Next:If sDB.vErsIonBuILD<1218 Then:Else ScriPT.ReGistereVENt sDb,"OnTrackListFilled","mq":script.reGIsTERevEnt sdB,"OnNowPlayingModified","i8":End If:SCRIpt.regisTErEVEnT sDb,"OnChangedSelection","aw":End Sub:Sub hn(gl,ox,b0):Dim at:If b0>=gl.ITemCount Then gl.ADdITEM ox:Else gl.aDdiTem"":For at=gl.ItEmcoUNt-1 To b0+1 Step-1:gl.ItemTeXT(at)=gl.ItEmTExT(at-1):Next:gl.IteMTEXT(b0)=ox:If gl.iTeMCOunT>dn Then gl.dEleTeitEm(dn):End If:End If:End Sub:Sub h5(mj,ek,mn,el):If mj=0 Then i1=bk.comMON.WidtH:jw=bk.COmMoN.HeIghT:nm=False:g1=True:l5=False:hs.INTerVaL=o1:hs.ENablEd=True:End If:End Sub:Sub e7(m,ee):Dim w,x,z,e,q:Set w=New RegExp:w.IgnoreCase=True:w.Pattern="^Preset(\d+) ?= ?(.*Name: ?""(?:""""|[^""])*"".*)":For z=m.Count-1 To 0 Step-1:e=m.Item(z):If w.Test(e)Then Set x=w.Execute(e):q=Int(x.Item(0).SubMatches.Item(0)):If q>0 Then m.Item(z)=IIf(ee,"",Right("00000"&q,6))&"="&x.Item(0).SubMatches.Item(1):Else m.dELetE z:End If:Else m.DElEte z:End If:Next:If m.Count Then m.SOrT:End If:End Sub:Sub dh(a):n8 Nothing:End Sub:Sub q4(gi):Dim ey,l7,en:Set ey=sdb.ObjecTS("mnuRegExp"&gi):Set l7=sDb.ui.addMEnUitEm(ey,0,0):With l7:.cAptION=SDB.lOCALIze("Manage Presets..."):.HINT="Manage RegExp presets":.IcOninDex=21:.usesCRipt=scrIPT.SCrIpTpaTH:.ONClIckfUNC="nx":End With:Set l7=sDb.UI.AddmEnUiTem(ey,0,0):With l7:.CaPTiON=sDb.LOCaLIZe("Options..."):.HINt=sdb.LOCALIZE(ch)&" options":.iConINdEX=27:.USEScRIpT=sCriPT.scriPTpatH:.onCLICkfunC="p4":End With:sdb.UI.aDDMENuItEMsep ey,0,0:Set l7=Sdb.UI.aDDMENUITeM(ey,0,0):With l7:.cAptION="":.usescRipt=SCRipT.ScRIptpATh:.OncLickfunC="an":.ViSiBLe=False:End With:Set SDb.OBjEctS("mnuRegExpLastExec"&gi)=l7:en="mnuRegExpGroup"&gi:Sdb.OBjeCts(en).aDD oj,SdB.ui.AdDMeNUiTEMSuB(ey,0,0):SDb.obJEcTS(en).Item(oj).CaPtiON=oj:sdB.obJeCTs(en).Item(oj).vISiBlE=False:SdB.ui.AddMEnuiTEmSep ey,0,0:End Sub:Sub r8():n.tExt=i4:r6.text=hi:i0.tEXT=ij:If Len(o2)>0 And IsNumeric(o2)Then mg.itEMIndEx=o2+1:g2.INtErf.document.bODy.INnErhTmL=o2:Else mg.iTEmiNdeX=0:If Len(o2)>0 Then g2.inTerf.document.bOdY.iNneRHTml="<img src="""& o2&""">":Else g2.INTErf.document.bOdY.InneRHTml="":End If:End If:gx.chEckEd=j2:mt.texT=a0:kw.CheckED=fh:nu.ChECkeD=ka:jz.TEXt=d0:gb.CHeCKEd=jv:qg.cHecKED=pn:a8.cHeCKED=oi:jf.ITeMiNdeX=qo:lb:hp:End Sub:Sub nl(a):If a.checked Then f8.caPtIoN="&Find Prev.":Else f8.CAPtion="&Find Next":End If:If Len(a0)=0 Or oSongData Is Nothing Or oSongList.Count=0 Or lSongIndex=oSongList.Count And Not a.CHeCKed Or lSongIndex=1 And a.ChEckED Then f8.cOmmOn.EnabLed=False:Else f8.CommON.ENABleD=True:End If:cg=False:End Sub:Sub h4(a):fh=a.chEcKed:it:oq:End Sub:Sub qb():mo.cOMMON.enAbLED=(y>-1):End Sub:Function a6():Dim f,ky,er,db,fm:If sDb.iNIFILe.boOlvaLUe("System","Skinned")Then f=SdB.iNiFILe.StRIngValuE("Appearance","PlayerSkinNameNew3"):If Len(f)Then ky=False:er=sDB.AppLicAtioNpAth&"Skins\":db=Left(sdb.DatabASE.PaTH,InStrRev(sDB.daTaBaSe.pAtH,"\"))&"Skins\":If Right(f,1)="\"Then f=Left(f,Len(f)-1):Set fm=CreateObject("Scripting.FileSystemObject"):If fm.FOLDerexIsTS(er&f)Or fm.fOLDErEXiSTS(db&f)Then ky=True:End If:Else If SDb.tOOLS.FileSystem.fIleExIsTS(er&f)Or Sdb.toolS.FileSystem.FileExiStS(db&f)Then If LCase(Right(f,4))=".msz"Then f=Left(f,Len(f)-4):End If:ky=True:End If:End If:If ky Then f=Left(sCRipt.scRIpTPath,InStrRev(scriPt.SCrIptpATh,"\"))&"SkinStyle\"&f&".css":If Not sdB.ToOlS.FileSystem.fIlEEXisTS(f)Then f="":End If:Else f="":End If:End If:End If:a6=f:End Function:Sub pu(a):kh=a.itEmInDEx:End Sub:Dim bc:For bc=1 To IIf(SDB.veRSIonhi<3,3,5):d7(bc)=sDb.inifILe.StrINgVAlUE("CustomFields","Fld"&bc&"Name"):Next:Sub o5(dk):o3.COMmOn.eNaBLED=dk:f8.COMmON.eNaBlED=dk:If IsObject(ny)Then ny.cOmmoN.ENAbLEd=dk:qq.COmMOn.eNablEd=dk:id dk:End If:End Sub:Sub ae(q,au):sdb.iniFILe.StRINgVAluE("RegExpPresets","Preset"&q)=au:End Sub:Function r2(g):Dim hx,d,i7,k0,im:d=k6(d0,jv):im=d:If jv Then d=ep(cm(mx),d):If d=eb Then r2=eb:Exit Function:End If:End If:hx=k6(a0,fh):If fh Then k0=hx:Else If Not ka And Not pn Then If oi Then i7=0:Else i7=1:End If:r2=Replace(g,hx,d,1,-1,i7):Exit Function:Else ef.Pattern="(\W)":ef.Global=True:k0=ef.Replace(hx,"\$1"):If ka Then k0="\b"&k0&"\b":End If:End If:End If:ef.Pattern=k0:If oi Then ef.IgnoreCase=False:Else ef.IgnoreCase=True:End If:ef.Global=True:On Error Resume Next:If pn Then d=Replace(d,Chr(34),Chr(1)):d=ef.Replace(g,Chr(1)&" & "&d&" & "&Chr(1)):If Err=0 Then If CStr(d)<>CStr(g)Then d=Replace(d,Chr(34),Chr(34)&Chr(34)):d=""""&Replace(d,Chr(1),Chr(34))&"""":d=Replace(d,vbNewLine,""" & vbNewLine & """):r2=Eval(d):Else r2=g:d=Eval(im):End If:End If:Else If Not fh And ka Then r2=Replace(ef.Replace(g,Chr(3)),Chr(3),d):Else r2=ef.Replace(g,d):End If:End If:If Err=-2147418113 Then r2=q7:Else If Err<>0 Then r2=eb:End If:End If:End Function:Function pj(ox):If Left(ox,1)=Chr(34)And Right(ox,1)=Chr(34)Then pj=Mid(ox,2,Len(ox)-2):Else pj=ox:End If:End Function:Sub dr():iq="":dx=-1:cl="":nb="":pq="":pa="":p1=False:ns="":gd=1:bi=False:o6=False:k8="":lq=1:cp=False:pb=False:lt=False:End Sub:Sub ei(q):Dim gs,oc,g5,h,s,ab:oc=sDB.oBjEcTS("PrstStrColl").Item(q):gs=SdB.objECTs("PrstStrColl").Item(q-1):If Not o8 Then mr q,oc,gs:If Not sDB.obJeCTs("RegExpDialog")Is Nothing Then On Error Resume Next:If sdB.VeRsIoNbuIlD<1205 Then:Else With n:g5=.itemTexT(q-1):.ItEMTExt(q-1)=.itemTeXt(q-2):.iteMTEXt(q-2)=g5:If y=q-1 Or y=q-2 Then If y=q-1 Then y=y-1:Else y=y+1:End If:.iTEMINDeX=y:dx=y:k=True:mo.Value=-y:k=False:li:End If:End With:End If:On Error GoTo 0:End If:Else Set h=sDb.toOlS.iNIFilEbYpAtH(ok):If h Is Nothing Then Exit Sub:End If:h.sTRInGvALuE("RegExpPresets","Preset"&q-1)=oc:h.StRiNGvaLuE("RegExpPresets","Preset"&q)=gs:End If:sdB.OBJECTS("PrstStrColl").Item(q-1)=oc:SDb.oBjEcTs("PrstStrColl").Item(q)=gs:With c5.INTeRF.document:Set s=.ALL.item("tdPreset"&q-1):If Not s Is Nothing Then s.INnERHtml=ls(oc):End If:Set s=.alL.item("tdPreset"&q):If Not s Is Nothing Then s.InnErHtML=ls(gs):End If:Set s=.alL.item("chk"&q):If Not s Is Nothing Then s.CHeckED=sdb.OBjectS("PrstChkColl").Item(q-1):End If:Set s=.alL.item("chk"&q-1):ab=sDB.objecTs("PrstChkColl").Item(q):If Not s Is Nothing Then s.cHecKed=ab:End If:Sdb.oBjEcTS("PrstChkColl").Item(q)=SDb.OBjecTs("PrstChkColl").Item(q-1):sdB.oBJecTs("PrstChkColl").Item(q-1)=ab:End With:End Sub:Sub al(a):Dim b0:If a0<>a.TExt Then dt=a0:End If:If dt<>a.TexT Then If lr(dt,False)Then b0=a.ItEMIndEx:hn mt,dt,0:If b0<a.ITeMcoUnt-1 Then a.iTeMINDEX=b0+1:Else a.iTeMInDeX=0:End If:End If:End If:End Sub:Function oh(hd,r4):Dim t,f5,g,sAfter,ou,b7,at:bReplacing=True:If oSongData.Id=-1 Then b7="ID IN (SELECT Songs.ID FROM Medias INNER JOIN Songs ON Medias.IDMedia = Songs.IDMedia WHERE ":If SDb.VERsioNHI<3 Then b7="AND "&b7&"Chr(Medias.DriveLetter + 65) & UCase":Else b7=b7&"CASE WHEN Medias.DriveLetter IS NOT NULL THEN SubStr('ABCDEFGHIJKLMNOPQRSTUVWXYZ', Medias.DriveLetter + 1, 1) ELSE '' END || Upper"End If:b7=b7&"(Songs.SongPath) = '"&Replace(UCase(oSongData.PATh),"'","''")&"')":Set ou=sDB.DataBAse.qUERySoNgS(b7):If Not ou.EOF Then oSongData.iD=ou.Item.Id:End If:Set ou=Nothing:End If:t=c4.keYs:If t(qo)=ex Then f5=";"&Replace(mp,"""","")&";":For at=0 To c4.Count-1:If InStr(f5,";"&t(at)&";")And t(at)<>ex Then g=cm(at):sAfter=r2(g):oh=jy(hd,r4,t(at),g,sAfter):End If:Next:Else g=cm(qo):sAfter=r2(g):oh=jy(hd,r4,t(qo),g,sAfter):End If:bReplacing=False:End Function:Sub g8(j1):Dim fw,cv,e0,g,sAfter,c9,at,r0:If ap Then Exit Sub:End If:On Error Resume Next:If SDb.vErSIOnbUIld<1205 Then If Not r Is Nothing And Not SdB.ObjectS("RegExpDialog")Is r Then SCript.UNREgIsTErAlLEVENTs:script.reGiStEREvENT sdb,"OnOptionsChange","le":Exit Sub:End If:End If:On Error GoTo 0:Set fw=oSongData:For at=pm To az:Set e0=oSongList.Item(at-1):For r0=0 To j1.Count-1:Set cv=j1.Item(r0):If e0.Id=cv.Id Then Set oSongData=e0.gETcOPy:g=cm(qo):sAfter=r2(g):Set oSongData=e0:cy at,g,sAfter:If at=m9 Then c9=True:End If:Exit For:End If:Next:Next:Set oSongData=fw:If c9 Then c9=nt:nt=True:oq:nt=c9:End If:End Sub:Sub k7():If Not p8 And Not l5 Then il:If b=1 Then b2.COmmON.enaBLeD=False:End If:End If:End Sub:Sub gg(qv,b6):io o3:End Sub:Function MapChrCase(ji,jq):Dim u:If Len(ji)>0 Then If VarType(jq)=vbInteger Then u=ChrW(jq):Else u=jq:End If:If oi Then MapChrCase=u:Else If UCase(Left(ji,1))=Left(ji,1)Then MapChrCase=UCase(Left(u,1))&LCase(Mid(u,2)):Else MapChrCase=LCase(u):End If:End If:End If:End Function:Sub k5(hu):If cr Then Exit Sub:End If:cr=True:Select Case hs.INtErVAL:Case o1,nf:hs.INTerVAL=n6:End Select:If g1 Or p8 Then If g1 Then l5=True:End If:If nm Then il:Else dy:End If:End If:cr=False:End Sub:Function mf(o,h7,i9):mf=o:If Len(i9)Then mf=Replace(mf,"<"&i9&">","<From Field>",1,-1,1):End If:If Len(h7)Then mf=Replace(mf,"<"& h7&">","<Into Field>",1,-1,1):End If:End Function:Function kx(jo):Dim c,o,d5,jg,k1,cb,r1,hw,om,h8,a,ps,jf,ej,lk,md,h6,t,lc,a4,kd,a2,c7,kp,ed,w,x,m,z,e,q,kr,qx,a9,p,ot,ld,r7,of,cf,a1,ib,hb,aa,aq,d3,pd,u,at,r0:kx=0:If SDb.seLeCTEdsOnGList.Count=0 Then sdB.MeSsagEbOx"The preset cannot be applied since"&vbCr&"none file is selected.",mTWARNing,Array(MBoK):Exit Function:Else Set oSongList=SDB.sEleCTedSOnglisT:End If:kd=sDb.iNIFIle.boOlVALue("RegExpOptions","ShowPresetAdjustDialog"):q=0:Set w=New RegExp:w.IgnoreCase=True:w.Pattern="^Preset(\d+) ?=.*Name: ?""((?:""""|[^""])*)""":Set m=SDb.INIFiLe.kEyS("RegExpPresets"):For z=0 To m.Count-1:e=m.Item(z):If w.Test(e)Then Set x=w.Execute(e):q=Int(x.Item(0).SubMatches.Item(0)):If q>0 Then c=Mid(e,InStr(e,"=")+1):o=Replace(x.Item(0).SubMatches.Item(1),Chr(34)&Chr(34),Chr(34)):jg=l(c,"FindInto"):k1=l(c,"ReplaceFrom"):If Not kd Then u=ih(o,jg,k1):Else u=o:End If:If u=jo Then Exit For:End If:End If:End If:Next:If z>=m.Count Or q=0 Then SdB.MEsSAGeBox"The preset """&jo&""""&vbCr&"cannot be applied because it doesn't exist in INI file.",MtWarnIng,Array(MBOk):Exit Function:End If:If Not SDB.OBJEctS("RegExpDialog")Is Nothing Then If q=y+1 Then kp=ci:If fp Then Exit Function:End If:If kp Then c=q8(q):jg=l(c,"FindInto"):k1=l(c,"ReplaceFrom"):End If:Else kr=i4:qx=y:p=bq:a9=hi:ot=ij:ld=o2:r7=j2:of=a0:cf=qo:a1=fh:ib=ka:hb=d0:aa=mx:aq=jv:d3=pn:pd=oi:End If:End If:kp=False:md=(InStr(1,o,"<Into Field>",1)>0):h6=(InStr(1,o,"<From Field>",1)>0):cb=l(c,"FindWhat"):r1=l(c,"ReplaceWith"):w.Pattern="<(NUMBER|STRING)(?: +CAPTION ?= ?""((?:""""|[^""])*)""| +VALUE ?= ?""((?:""""|[^""])*)""| +MINVALUE ?= ?""((?:""""|[^""])+)""| +MAXVALUE ?= ?""((?:""""|[^""])+)"")*>":w.Global=True:Set x=w.Execute(cb&r1):If kd And(md Or h6 Or x.Count>0)Then d5=l(c,"Description"):Set fs=Sdb.uI.NeWfOrM:With fs:.BOrdErsTyLE=qz:With .COMmoN:hw=.widTh-.cLiEnTwIDTh:om=.HEiGhT-.ClIeNThEIGhT:at=48+om+IIf(md,30,0)+IIf(h6,30,0)+30*x.Count+IIf(Len(d5),30,0):.SeTrECt 100,100,467+hw,at:.MINwidTH=365+hw:.MiNhEIGht=at:.mAxheiGHT=at:End With:.FoRMPoSItIoN=pv:.CapTIOn=IIf(Right(o,3)="...",Left(o,Len(o)-3),o)&" ("&oSongList.Count&" track"&IIf(oSongList.Count>1,"s","")&")":End With:If h6 Then Set a=Sdb.ui.NeWLAbEl(fs):With a:.CAPtioN="Source field:":.CommoN.SEtRECt 10,13,95,17:End With:Set ps=sDB.UI.neWdROpDOWN(fs):With ps:.stylE=f2:With .COmMOn:.SEtReCT 110,10,347,19:.aNchorS=1+2+4:End With:End With:scriPt.reGistErEVEnt ps,"OnSelect","pu":h8=30:End If:If md Then Set a=sdb.Ui.NEwlAbel(fs):With a:.CAPtIOn="Destination field:":.cOMMOn.sEtrECT 10,13+h8,95,17:End With:Set jf=sdB.ui.NEWdropdOWN(fs):With jf:.sTylE=f2:With .comMOn:.sETrEcT 110,10+h8,347,19:.aNCHoRS=1+2+4:End With:End With:SCRIpT.REGistEreVenT jf,"OnSelect","kf":h8=h8+30:End If:Set lp=CreateObject("Scripting.Dictionary"):Set c7=CreateObject("Scripting.Dictionary"):For at=0 To x.Count-1:Set a=SDb.UI.nEwLabeL(fs):With a:.cAptiOn=Replace(x.Item(at).SubMatches.Item(1),"""""","""")&":":.COmMOn.seTREct 10,13+h8,95,17:End With:If UCase(x.Item(at).SubMatches.Item(0))="NUMBER"Then Set a=Sdb.ui.NEwsPINedit(fs):With a:With .COMMOn:.sETRECT 110,10+h8,60,19:.controLNAmE="ctr"&at:End With:u=x.Item(at).SubMatches.Item(3):If Len(u)=0 Or Not IsNumeric(u)Then u=-1000:End If:.MiNvaluE=u:u=x.Item(at).SubMatches.Item(4):If Len(u)=0 Or Not IsNumeric(u)Then u=1000:End If:.MAXVAlue=u:u=x.Item(at).SubMatches.Item(2):If Len(u)=0 Or Not IsNumeric(u)Then u=0:End If:.Value=u:On Error Resume Next:If SDb.vERsIONBUILd<1289 Then:Else sCripT.ReGIsterEvEnt .comMon,"OnKeyUp","f0":End If:On Error GoTo 0:End With:SCRipT.RegistEREVENt a,"OnChange","gu":Else Set a=sdB.uI.NewEdit(fs):With a:With .CoMmon:.SETrECt 110,10+h8,347,19:.conTroLnamE="ctr"&at:.anchORs=1+2+4:End With:u=Replace(x.Item(at).SubMatches.Item(2),"""""",""""):.TExT=u:End With:scRiPT.rEgisTeRevEnt a,"OnChange","qu":End If:lp.aDd"ctr"&at,u:c7.aDd"ctr"&at,u:h8=h8+30:Next:If Len(d5)Then Set a=sdB.Ui.NEwlAbeL(fs):With a:.cApTiON="Description: "&d5:With .cOMMon:.SEtreCt 10,18+h8,447,17:.AnChORS=1+2+4:End With:End With:h8=h8+30:End If:Set a=Sdb.uI.nEwCheckbOX(fs):With a:.CaPtIon="Don't show this dialog anymore":With .commOn:.Setrect 10,18+h8,200,20:.ancHors=1+8:End With:ScriPt.REGIsTEREvENT .comMOn,"OnClick","bb":End With:Set ej=SDb.uI.newBuTtOn(fs):With ej:.CAptiON=SdB.LOcaliZE("&OK"):With .cOMmoN:.sETreCt 305,15+h8,73,25:.ancHorS=4+8:End With:.Default=True:.moDalResulT=1:End With:Set lk=sDB.UI.NEWBUTtOn(fs):With lk:.caPtiOn=SdB.LoCALiZE("&Cancel"):With .commON:.SETrECT 385,15+h8,73,25:.anChOrs=4+8:End With:.caNCeL=True:.MOdaLResULt=2:End With:lc=-1:a4=-1:t=c4.KeYS:For at=0 To c4.Count-1:u=t(at):If h6 Then ps.addiTem bh(u):If k1=u Then lc=at:End If:End If:If md Then jf.adDIteM bh(u):If jg=u Then a4=at:End If:End If:Next:If lc=-1 Then lc=1:End If:If h6 Then ps.iteMINdeX=lc:End If:If a4=-1 Then a4=1:End If:If md Then jf.iTemINdEX=a4:End If:kh=lc:js=a4:fs.sAVEposItIonnaME="RegExp Replace Preset":If fs.showmOdal=2 Then Set fs=Nothing:Exit Function:End If:Set fs=Nothing:If lm Then SDb.inIFiLE.bOOlvalue("RegExpOptions","ShowPresetAdjustDialog")=False:End If:On Error Resume Next:If sdB.veRSIoNbuiLD<1205 Then If Not sDb.OBjectS("RegExpDialog")Is Nothing Then n8 Nothing:End If:End If:On Error GoTo 0:i4=o:ra c:For at=0 To lp.Count-1:If lp.Item("ctr"&at)<>c7.Item("ctr"&at)Then kp=True:Exit For:End If:Next:If kp Or h6 And kh<>lc Or md And js<>a4 Then If h6 Then mx=kh:End If:If md Then qo=js:End If:If kp Then w.Pattern="(<(?:NUMBER|STRING)\b.*? +VALUE ?= ?"")((?:""""|[^""])*)("".*?>)":u=w.Replace(a0,"$1"&Chr(1)&"$3"):ed=Split(u,Chr(1)):at=0:Do While at<UBound(ed):ed(at)=ed(at)&Replace(lp.Item("ctr"&at),"""",""""""):at=at+1:Loop:a0=Join(ed,""):u=w.Replace(d0,"$1"&Chr(1)&"$3"):ed=Split(u,Chr(1)):r0=0:Do While r0<UBound(ed):ed(r0)=ed(r0)&Replace(lp.Item("ctr"&at),"""",""""""):at=at+1:r0=r0+1:Loop:d0=Join(ed,""):End If:pc q:If Not sdb.objeCtS("RegExpDialog")Is Nothing Then If q=y+1 Then l6 q:End If:End If:End If:Set lp=Nothing:Set c7=Nothing:Else If SdB.inIfILe.bOOlValUe("RegExpOptions","ConfirmPresetExecute")Then If sdb.MESsaGebOx("Are you sure that you want to apply the  preset:"&vbCr&jo&vbCr&"to "&oSongList.Count&" selected track"&IIf(oSongList.Count=1,"","s")&"?",mTCONFiRMAtiOn,Array(mByeS,MbnO))<>Mryes Then Exit Function:End If:End If:i4=o:ra c:On Error Resume Next:If sDB.veRsiOnbUilD<1205 Then If Not SDb.oBjeCtS("RegExpDialog")Is Nothing Then n8 Nothing:End If:End If:On Error GoTo 0:End If:On Error Resume Next:If sDB.VERSiONBuiLD<1218 Then:Else Call pt(sdb.INIfiLE):End If:On Error GoTo 0:hg False:If Not Sdb.ObJECTS("RegExpDialog")Is Nothing Then If q<>y+1 Then i4=kr:y=qx:bq=p:hi=a9:ij=ot:o2=ld:j2=r7:a0=of:qo=cf:fh=a1:ka=ib:d0=hb:mx=aa:jv=aq:pn=d3:oi=pd:h3:End If:End If:kx=q:End Function:Sub dj():With q3:Select Case bl:Case 0:.CAPtiON="K&eep matched":Case 1:.cAPtIon="K&eep unmatch.":Case 2:.CaPtION="K&eep replace":Case 3:.CAptION="S&el. matched":Case 4:.CAptiOn="S&el. unmatch.":Case 5:.cApTIon="S&el. replace":End Select:End With:End Sub:Function pt(h):Dim t,f5,kk,at:f5=h.STRIngvalUE("Options","FTSearchFields"):If mp<>f5 Then mp=f5:f5=";"&Replace(f5,"""","")&";":t=c4.kEYS:For at=0 To c4.Count-1:If InStr(f5,";"&t(at)&";")And t(at)<>ex Then kk=kk&c4.Item(t(at))&" & "";"" & oSongData.":End If:Next:If Len(kk)Then kk=Left(kk,Len(kk)-19):Else kk="Title":End If:c4.Item(ex)=kk:pt=True:Else pt=False:End If:End Function:Sub hg(p2):Dim ir,r4,hd,c1,g,t,nn,jo,gq,mc,os,gv:ln False:If Not sDB.oBjecTs("RegExpDialog")Is Nothing Then c3 False:If p2 Then jo=qq.cAptIoN:qq.CaPtIoN="&Cancel":qq.cOmMoN.eNaBled=True:Else lk.coMMOn.enaBLED=True:End If:End If:r4=sdb.INIfiLE.boOlVAlUE("RegExpOptions","DeleteEmptiedFolders"):hd=sdb.iNIfIlE.bOOlvAlue("Options","StoreID3AfterEdit"):nn=False:If sdb.VERsioNhI<4 Then gq="track":Else gq="file":End If:mc=oSongList.Count:Set os=sDb.ProGrESS:os.mAxvaluE=mc-1:os.Value=0:gv=2+Round(Timer*10):For lSongIndex=1 To mc:If p2 Then ir=SdB.objECTs("CheckedTracks").Item(lSongIndex):Else ir=True:End If:If ir Then Set oSongData=oSongList.Item(lSongIndex-1):Do While Not oh(hd,r4):If nn Then Exit Do:End If:t=c4.KeYS:On Error Resume Next:g=cm(qo):c1="There is a problem on replacing """&t(iInTOiNdEx)&""" field for the "&gq&" #"&lSongIndex&":"&vbCr&oSongData.pAtH&vbCr&vbCr&"Original: "&g&vbCr&vbCr&"Result: ":c1=c1&r2(g):On Error GoTo 0:Select Case sdb.MESsAgEbOX(c1,mTerROR,Array(mBabORT,MbretRy,MBIgNore,MbIgNOReToAll)):Case MRrETRy:Case MRiGnOrE:Exit Do:Case mrIGNoREtoaLl:nn=True:Exit Do:Case Else Exit For:End Select:Loop:End If:If Abs(gv-Round(Timer*10))>2 Then SDb.pRocESSmesSAGEs:If os.teRmINate Or p2 And Not ft Then Exit For:End If:os.Value=lSongIndex-1:os.tExt=SDB.loCalIzE("Replacing data for #"&lSongIndex&" of "&mc&" "&gq&"s..."):gv=Round(Timer*10):End If:Next:If c8.Count Then c8.rEMoVeALl:End If:If Not SdB.OBjeCtS("RegExpDialog")Is Nothing Then c3 True:io o3:oq:qb:it:lb:If p2 Then If lr(a0,False)Then hn mt,mt.TeXt,0:End If:If lr(d0,True)Then hn jz,jz.teXT,0:End If:qq.cAPtION=jo:End If:End If:ln True:End Sub:Sub nw(a):i4=a.TeXt:h3:End Sub:Sub ql(h,ee):Dim m,z,e,q,c,p,o,qx,lz:If o8 Then Set m=h.KEyS("RegExpPresets"):h.DeleteSEcTIOn"RegExpPresets":Else Set m=SdB.iNiFIle.keyS("RegExpPresets"):sdb.INIFILE.dELeteSeCTion"RegExpPresets":End If:e7 m,ee:q=0:If o8 Then For z=1 To m.Count:If Not SDB.oBJECTS("PrstChkColl").Item(z)Or ee Then q=q+1:h.StrINgVaLUE("RegExpPresets","Preset"&q)=m.Item(z-1):End If:Next:Else qx=0:lz=False:If Not sdB.objECts("RegExpDialog")Is Nothing Then On Error Resume Next:If SDb.veRsiOnbuiLD<1205 Then:Else lz=True:End If:On Error GoTo 0:End If:If ee Then For z=1 To m.Count:e=m.Item(z-1):c=Mid(e,InStr(e,"=")+1):p=l(c,"Menu"):o=l(c,"Name"):pw p,o:Next:End If:For z=1 To m.Count:e=m.Item(z-1):c=Mid(e,InStr(e,"=")+1):p=l(c,"Menu"):o=l(c,"Name"):If Not SdB.ObjEcTs("PrstChkColl").Item(z)Or ee Then q=q+1:ae q,c:If ee Then ja c,p:End If:If lz Then If q<=n.itemcouNT Then If n.iteMTExt(q-1)<>o Then n.itemtExT(q-1)=o:End If:Else n.ADDItEM o:End If:If i4=o Then If bq=p Then qx=q:End If:End If:End If:Else pw p,o:End If:Next:ho:If lz Then Do While q<n.itemcouNt:n.DelETeITem n.iteMCOUnt-1:Loop:If qx Then y=qx-1:Else If n.iTEMCouNt Then y=0:Else y=-1:End If:End If:n.ITEmindEx=y:If y>-1 Then mo.mINVAluE=1-n.ItEmCoUnT:End If:If qx Then dx=y:qb:h3:k=True:mo.Value=-y:k=False:li:Else dv n:End If:End If:End If:End Sub:Sub OptionsDialog():Dim i2,ej,lk,hw,om:Set i2=SDB.Ui.nEWform:With i2:.boRdERsTylE=gj:With .coMmon:hw=.wIDTh-.clIeNtWIDth:om=.height-.CLiEnTHEigHT:.setreCT 100,100,467+hw,400+om:End With:.forMposItion=pv:.CAptiOn=ch&" "&sdb.LoCALiZE("Options"):End With:iz i2:Set ej=SdB.ui.nEWBuTTON(i2):With ej:.COmMon.SeTreCT 307,368,73,25:.captioN=sDB.lOcALiZe("&OK"):If nz()>=204 Then .Default=True:End If:.MoDAlRESult=1:End With:Set lk=sDb.UI.NeWBUtToN(i2):With lk:.CoMMON.SetreCT 387,368,73,25:.CAPtiON=sdb.loCaLIzE("&Cancel"):If nz()>=204 Then .CaNCEL=True:End If:.mOdaLrEsulT=2:End With:i2.sAvepositIONName=i2.caPTiOn:If i2.SHoWmoDAl=1 Then b3 i2:On Error Resume Next:sDb.iNifIlE.fluSH:On Error GoTo 0:End If:End Sub:Function nz():nz=100*sDB.vErSIoNhI+SDB.verSiONLO:End Function:Sub hp():iq=i4:dx=y:nb=hi:cl=bq:pq=ij:pa=o2:p1=j2:ns=a0:gd=qo:bi=fh:o6=ka:k8=d0:lq=mx:cp=jv:pb=pn:lt=oi:End Sub:Function jy(hd,r4,h7,g,sAfter):Dim qt,fm,j3,hy,qr,fe,iw,dz:If sAfter<>eb And Not oSongData Is Nothing Then Select Case h7:Case"Path","Folder":If Mid(sAfter,2,2)<>":\"And Left(sAfter,2)<>"\\"Then jy=False:Exit Function:End If:j3=oSongData.pAth:End Select:If CStr(sAfter)<>CStr(g)Then On Error Resume Next:If ht.EXisTs(h7)Then iw=ht.Item(h7):Execute(iw):Else qt=c4.Item(h7):Select Case VarType(Eval("oSongData."&qt)):Case vbLong,vbDouble,vbCurrency,vbBoolean:iw=sAfter:Case Else iw=""""&Replace(sAfter,Chr(34),"""""")&"""":iw=Replace(iw,vbNewLine,""" & vbNewLine & """):End Select:Execute("oSongData."&qt&" = "&iw):End If:If Err=0 Then Select Case h7:Case"Path","Folder":Set fm=CreateObject("Scripting.FileSystemObject"):qr=fm.GETpArEntFOldErNAme(j3):j3=qr:fe=fm.gETpArEnTfOLderNamE(oSongData.pAth):hy=fe:If CStr(fe)<>CStr(qr)And UCase(fe)=UCase(qr)And fm.foLDErEXiStS(qr)Then Do:If fm.gETBASeNAme(qr)<>fm.GETBaSeNaME(fe)Then fm.MovefOlDEr qr,fe:End If:qr=fm.getpaRentfOLdernAmE(qr):fe=fm.gETpARentFOLderNAMe(fe):Loop Until InStr(qr,"\")<=1:End If:gc"Moved from: "&g&" to: "&sAfter:Case Else gc"Replaced "& h7&" from: """&g&""" to: """&sAfter&""" in: "&oSongData.paTh:End Select:Else gc"Error on replacing "& h7&" from: """&g&""" to: """&sAfter&""" in: "&oSongData.PATh&" - "&Err.Description:jy=False:Exit Function:End If:If Err=0 Then ap=True:If oSongData.ID>-1 Then oSongData.uPDaTedb:oSongData.updateaLBuM:oSongData.UpDATEARTIsT:End If:If(h7="Path"Or h7="Folder")Then If r4 And fm.FolDERExIsts(j3)And UCase(hy)<>UCase(j3)Then dz=Len(fm.GETDriVenAme(j3))+1:qr=j3:On Error Resume Next:Do While Len(qr)>dz:With fm.GEtFoldeR(qr):If .sUBfoldErs.Count=0 And .fILeS.Count=0 Then fm.dEleTefolder qr:If Err=0 Then:Else If m8 Then Exit Do:Else If sdb.MesSaGeBox("Error when deleting folder:"&vbCr&qr&vbCr&vbCr&Err.Description,mtERror,Array(MBOK,MbokTOAlL))=mroktoaLl Then m8=True:Exit Do:End If:End If:End If:Else Exit Do:End If:End With:qr=fm.geTpArEnTfOldErNAMe(qr):Loop:End If:Else If h7="Timestamp"Then Dim qd,jx:On Error Resume Next:Set fm=CreateObject("Scripting.FileSystemObject"):If fm.fILeeXISts(oSongData.pAth)Then qr=fm.GetpARenTFoLdERnamE(oSongData.PATh):If Right(qr,1)<>"\"Then qr=qr&"\":End If:j3=fm.geTFILe(oSongData.paTh).NAme:Set qd=CreateObject("Shell.Application"):Set jx=qd.NamesPAce(qr):jx.ItEMs.Item(j3).MoDIfYDaTE=CDate(sAfter):If oSongData.id=-1 Then sDB.mAinTRacKSWiNDOw.finIsHAdDiNg:End If:End If:On Error GoTo 0:Else If(hd Or oSongData.iD=-1)Then Select Case h7:Case"Filename","Extension","Length","Bitrate","File Size","Timestamp","Added","Played #","Last Played","Sample Rate","Channels","VBR","Bookmark","Playback %","Start Time","Stop Time","Skipped #","Type":Case Else oSongData.WritEtagS:End Select:If oSongData.id=-1 Then SDB.mainTracKsWiNdoW.fiNIsHadDiNg:End If:End If:End If:End If:ap=False:Else jy=False:Exit Function:End If:End If:jy=True:End If:End Function:Sub c3(dk):n.comMon.enaBlEd=dk:If Not oy Then mo.Common.eNabLeD=dk:c0.COMmON.eNablED=dk:qk.cOmmon.EnaBleD=dk:End If:ma.comMOn.enabled=dk:r6.coMmOn.enaBlEd=dk:i0.cOmmon.enABlEd=dk:mg.COmmOn.enablED=dk:g2.cOmmoN.EnABLEd=dk:gx.cOmMON.ENaBled=dk:mt.comMOn.EnaBLeD=dk:jf.comMOn.eNAbLeD=dk:kw.ComMON.EnaBLeD=dk:m5.ComMON.enABled=dk:nu.cOMmON.eNAblED=dk:jz.commOn.ENABLeD=dk:h2.COMMon.EnabLED=dk:ps.cOMMON.enABLed=dk:gb.commoN.eNAbLeD=dk:gn.CoMmOn.EnAblEd=dk:qg.COMmOn.enaBLeD=dk:a8.cOmMoN.EnAbleD=dk:ks.CommOn.EnABleD=dk:jb.Common.ENAbLed=dk:cc.COmMoN.ENaBlED=dk:fz.COmMon.EnaBled=dk:g9.comMon.enAbleD=dk:o5 dk:lk.cOMMOn.ENAblED=dk:End Sub:Sub ra(c):Dim t,jg,k1,at,u:bq=l(c,"Menu"):hi=l(c,"Description"):ij=l(c,"Shortcut"):u=l(c,"Toolbar"):If u="1"Or LCase(u)="true"Then j2=True:Else j2=False:End If:o2=l(c,"Icon"):If Len(o2)>0 And Not IsNumeric(o2)Then If SDB.ToOLS.FileSystem.FIlEeXiStS(sdb.aPpLICAtiOnPAth& o2)Then o2=SDb.AppLiCAtIonPath& o2:End If:End If:a0=l(c,"FindWhat"):jg=l(c,"FindInto"):k1=l(c,"ReplaceFrom"):qo=-1:mx=-1:t=c4.keyS:For at=0 To UBound(t):u=t(at):If u=jg Then qo=at:End If:If u=k1 Then mx=at:End If:u=bh(u):If u<>t(at)Then If u=jg Then qo=at:End If:If u=k1 Then mx=at:End If:End If:If qo>-1 And mx>-1 Then Exit For:End If:Next:If qo=-1 Then qo=1:End If:If mx=-1 Then mx=1:End If:u=l(c,"FindRegExp"):If u="1"Or LCase(u)="true"Then fh=True:Else fh=False:End If:u=l(c,"WholeWord"):If u="1"Or LCase(u)="true"Then ka=True:Else ka=False:End If:d0=l(c,"ReplaceWith"):u=l(c,"ReplaceRegExp"):If u="1"Or LCase(u)="true"Then jv=True:Else jv=False:End If:u=l(c,"ReplaceVBScr"):If u="1"Or LCase(u)="true"Then pn=True:Else pn=False:End If:u=l(c,"MatchCase"):If u="1"Or LCase(u)="true"Then oi=True:Else oi=False:End If:End Sub:Function ep(g,k0):ef.IgnoreCase=Not oi:ef.Pattern=k0:On Error Resume Next:Set hk=ef.Execute(g):If Err Then ep=eb:Else On Error GoTo 0:If hk.Count Then ep=hk.Item(0).Value:End If:End If:End Function:Sub bv():If fp Then Exit Sub:End If:i4="":bq="":hi="":ij="":j2=False:o2="":a0="":fh=False:ka=False:d0="":jv=False:pn=False:oi=False:If o3.Value>1 Then o3.Value=1:End If:If ks.chEcKed Then ks.checKEd=False:End If:y=-1:k=True:r8:k=False:oq:qb:k=True:mo.Value=-y:k=False:li:End Sub:Function MapArray(cx):Dim at:For at=0 To UBound(cx)Step 2:MapArray=MapArray&MapChr(cx(at),cx(at+1)):Next:End Function:Function LetVar(qj,nh):Call SetVar(qj,nh):LetVar="":End Function:Sub li():ak.capTiON="Preset "&y+1&"/"&n.iTEMCount&":":End Sub:Sub ge(qv,ek):If qv=32 And Not p8 Or qv=85 And ek=4 Then l5=True:If Not p8 Then nm=True:hs.IntERvAl=nf:hs.EnabLEd=True:il:p8=True:End If:End If:End Sub:Dim lp,lm,kh,js,fs:Dim c8:Set c8=CreateObject("Scripting.Dictionary"):Dim kt():ReDim kt(0):Dim ip:Set ip=CreateObject("Scripting.Dictionary"):Dim n4,pp,c5,b2,bk,hs,r9,np,nv,qm,dw,j8,jk,i6,ob,b,o8,ok,l9,eg,kc:Dim g1,i1,jw,nm,p8,l5,bt:Dim r,ak,n,mo,c0,ma,qk,r6,i0,mg,g2,gx,mt,jf,kw,m5,nu,m3,jz,h2,ps,gb,gn,qg,hf,a8,ks,ax,jb,nk,cc,fz,o3,g9,f8,ny,qq,pe,q3,lk,oSongList,oSongData,lSongIndex,m9,pm,az,nt,v,k,fa,bn,l0,cr,ac,cg,hh,ec,f3,cs,ms,fq,bl,j9,ft,oy,i4,y,hi,bq,ij,o2,j2,a0,qo,fh,d0,mx,jv,pn,oi,ka,dt,qa,iq,dx,nb,cl,pq,pa,p1,ns,gd,bi,k8,lq,cp,pb,lt,o6:Dim bg,ku,dd,og,g0,g7:Dim ap:Dim bReplacing:Dim eo:eo=Left(scrIpT.SCripTpaTh,InStrRev(sCRiPt.SCRiPtpATh,".")-1)&"-Extra.vbs":If sDb.toolS.FileSystem.fIleexisTs(eo)Then ScRiPt.inCludE eo:End If:Sub bm():Dim os,qd,b5,af,e0,kj,g,sAfter,rb,n2,jo,gq,at,r0:If Not ft Then ft=True:On Error Resume Next:n2=SDb.PLayeR.playLIstSELectEd(0):If Err Then n2=False:Else n2=True:End If:On Error GoTo 0:If IsObject(q3)Then If sdB.iNifilE.bOOlValUe("RegExpOptions","ModelessWindow")And Not n2 Then n8 Nothing:Else c3 False:jo=q3.CApTIOn:q3.CAPtiON="&Cancel":q3.cOmmON.EnableD=True:End If:End If:Set os=Sdb.pROGresS:Set qd=CreateObject("WScript.Shell"):If j9 Then Set b5=Sdb.pLAyEr.cURReNTsONGLIsT:Else Set b5=sdb.aLlViSIbLEsoNGlIst:End If:If SDB.vErSIOnHi<4 Then gq="track":Else gq="file":End If:If Not n2 Or(bl<3)Then os.tEXT=SDb.localIZE("Removing "&gq&"s from "&gq&"list..."):If j9 Then Sdb.PLayer.PLaYliSTClEAR:Else If n2 Then For at=0 To b5.Count-1:SDb.mAiNtrACkswINDOW.SeLECTEd(at)=True:Next:Else qd.SEndKeYS"^a":sDB.PRocEsSMessAgEs:End If:SDB.mAINtRacksWiNdoW.reMOvesELecTEdTRACks:End If:End If:lSongIndex=1:Set e0=oSongList.Item(0):Set oSongData=e0.getcOPy:Select Case bl:Case 3,4,5:Set kj=sDb.neWsONgliST:End Select:os.maxVALUE=b5.Count:os.Value=0:r0=CLng(Timer*20):For at=0 To b5.Count-1:Set af=b5.Item(at):If n2 And(bl>2)Then If j9 Then SDB.playeR.PLaYLIstSelECTeD(at)=False:Else SdB.maiNtrAcKsWINdow.SelEcteD(at)=False:End If:End If:If oSongData.id=af.id And oSongData.id>0 Or oSongData.PaTH=af.pAth And oSongData.id<=0 Then g=cm(qo):Select Case bl:Case 0,1,3,4:rb=bp(g):If rb And(bl=0 Or bl=3)Or Not rb And(bl=1 Or bl=4)Then If n2 And(bl>2)Then If j9 Then sdb.PLAYEr.PlayliSTSelected(at)=True:Else Sdb.maINtRACkSwiNdOw.SeLEctEd(at)=True:End If:Else If j9 Then sDb.PlAyER.pLAYlIstAddTRAck oSongData:Else SdB.mAIntracKswindOW.adDTRACk oSongData:End If:End If:Else If(bl=3 Or bl=4)And Not n2 Then kj.ADd oSongData:End If:End If:Case 2,5:sAfter=r2(g):Set oSongData=e0.geTCopY:If CStr(sAfter)<>CStr(g)Then If n2 And(bl>2)Then If j9 Then sdB.plaYEr.PlAYlIsTsELEcTED(at)=True:Else SdB.maINTRACksWInDOw.sElECTed(at)=True:End If:Else If j9 Then SDb.PLAyEr.PLAyliSTAddTRacK oSongData:Else SDB.MAiNtRaCKsWindOW.AddtRaCK oSongData:End If:End If:Else If bl=5 And Not n2 Then kj.ADd oSongData:End If:End If:End Select:If lSongIndex<oSongList.Count Then Set e0=oSongList.Item(lSongIndex):Set oSongData=e0.gETcopy:lSongIndex=lSongIndex+1:Else If bl<3 Or n2 Then Exit For:End If:End If:Else If bl>2 And Not n2 Then kj.aDD af:End If:End If:If CLng(Timer*20)>r0 Then SdB.proCEsSMessAgES:If os.TErMiNate Or Not ft Then o3.Value=at+1:Exit For:End If:os.Value=at:os.TExt=Sdb.LOCalIZe("Searching for string in #"&at&" of "&oSongList.Count&" "&gq&"s..."):r0=CLng(Timer*20):End If:Next:If Not n2 Or(bl<3)Then If Not j9 Then Sdb.maiNTracKswiNDOw.FiNisHADdIng:End If:Select Case bl:Case 3,4,5:If n2 Then If j9 Then For at=0 To sDb.plAYeR.curRENtsOnGliST.Count-1:SdB.pLayEr.PlaYListSelecTed(at)=True:Next:Else For at=0 To SdB.alLViSIBlesOngLIsT.Count-1:SDb.MaInTRaCkswinDow.SELeCTED(at)=True:Next:End If:Else qd.sENDKEYs"^a":sdb.PROCEssmEssagES:End If:If kj.Count>0 Then os.maxVAlue=kj.Count-1:os.Value=0:r0=CLng(Timer*20):For at=0 To kj.Count-1:If j9 Then sdB.pLayEr.PlaylISTAdDTrAcK kj.Item(at):Else sdb.MaiNTraCkswINDOw.ADDtrACK kj.Item(at):End If:If CLng(Timer*20)>r0 Then SDb.PRocEssmessaGEs:If os.tErminAtE Or Not ft Then Exit For:End If:os.Value=at:os.TEXT=sDb.LOCalIZe("Adding "&at&" of "&kj.Count&" "&gq&"s..."):r0=CLng(Timer*20):End If:Next:If Not j9 Then sdB.MaInTraCKSWINDOw.fInIshaDDInG:End If:If SdB.VERsIONhI>=3 Then If kj.Count=b5.Count Then If sDB.seLEcTEdsoNglisT.Count=1 Then If Not n2 Then qd.sENDKEYS"{HOME}^ ":End If:End If:End If:End If:End If:End Select:End If:SDb.iniFIlE.IntVALUe("RegExpOptions","SelectKeepMode")=bl:If IsObject(q3)Then c3 True:If Not oy Then qb:End If:it:lb:lj:q3.caPtION=jo:End If:End If:ft=False:If Not Sdb.oBJEcts("RegExpDialog")Is Nothing Then aw:End If:End Sub:Function SQLQuery(b7):Dim e5,k4,o0:k4=GetLocale:SetLocale"en-us":If Not c8.eXistS(b7)Then Set e5=sDb.DATaBaSE.OpEnSQL(b7):If Err=0 Then If Not e5.eOf Then o0=e5.VaLuEByInDex(0):If IsNumeric(o0)Then o0=CDbl(o0):End If:Else o0=Null:End If:SQLQuery=o0:c8.AdD b7,o0:End If:Set e5=Nothing:Else SQLQuery=c8.Item(b7):End If:SetLocale k4:End Function:Sub no(hr,au):Dim u:u=au:If Left(u,1)=Chr(34)And Right(u,1)=Chr(34)And nz<302 Or Left(u,1)=" "Or Right(u,1)=" "Then u=Chr(34)&u&Chr(34):End If:sDb.inIfiLE.StRiNGVaLuE("RegExpReplace",hr)=u:End Sub:Sub pw(n9,o):Dim p:p=oj:py p,o,"Toolbar":py p,o,"MainMenu":py p,o,"Tracklist":py p,o,"NowPlaying":If sDB.verSIOnhI>=3 Then py p,o,"TracklistNP":End If:End Sub:Sub j5():Dim jt:If nt=False Then nt=True:nk.CAPtIon="!":jt="<html><head><style type='text/css'>body {margin: 5px}</style></head><body><b>Regular expressions quick reference</b><table>    <tr bgcolor=""f2eab7"">        <td><code>.</code></td>        <td>Any character except newline.</td>    </tr>    <tr>        <td><code>\</code></td>        <td>Escapes the character immediately following it.</td>    </tr>    <tr bgcolor=""f2eab7"">        <td><code>\.</code></td>        <td>A period (and so on for <code>\*</code>, <code>\|</code>, <code>\\</code>, etc.)</td>    </tr>    <tr>        <td><code>^</code></td>        <td>The start of the string.</td>    </tr>":jt=jt&"    <tr bgcolor=""f2eab7"">        <td><code>$</code></td>        <td>The end of the string.</td>    </tr>    <tr>        <td><code>\d</code>,<code>\w</code>,<code>\s</code></td>        <td>A digit, word character <code>[A-Za-z0-9_]</code>, or whitespace.</td>    </tr>    <tr bgcolor=""f2eab7"">        <td><code>\D</code>,<code>\W</code>,<code>\S</code></td>        <td>Anything except a digit, word character, or whitespace.</td>    </tr>    <tr>        <td><code>[abc]</code></td>        <td>Character a, b, or c.</td>    </tr>":jt=jt&"    <tr bgcolor=""f2eab7"">        <td><code>[a-z]</code></td>        <td>a through z.</td>    </tr>    <tr>        <td><code>[^abc]</code></td>        <td>Any character except a, b or c.</td>    </tr>    <tr bgcolor=""f2eab7"">        <td><code>a|b</code></td>        <td>Either a or b.</td>    </tr>    <tr>        <td><code>?</code></td>        <td>Zero or one of the preceding element.</td>    </tr>":jt=jt&"    <tr bgcolor=""f2eab7"">        <td><code>*</code></td>        <td>Zero or more of the preceding element.</td>    </tr>    <tr>        <td><code>+</code></td>        <td>One or more of the preceding element.</td>    </tr>    <tr bgcolor=""f2eab7"">        <td><code>{<em>n</em>}</code></td>        <td>Exactly <em>n</em> of the preceding element.</td>    </tr>    <tr>        <td><code>{<em>n</em>,}</code></td>        <td><em>n</em> or more of the preceding element.</td>    </tr>":jt=jt&"    <tr bgcolor=""f2eab7"">        <td><code>{<em>m</em>,<em>n</em>}</code></td>        <td>Between <em>m</em> and <em>n</em> of the preceding element.</td>    </tr>    <tr>        <td><code>??</code>,<code>*?</code>,<code>+?</code>,<br /><code>{<em>n</em>}?</code>, etc.</td>        <td>Same as above, but as few times as possible.</td>    </tr>    <tr bgcolor=""f2eab7"">        <td><code>(</code><em>expr</em><code>)</code></td>        <td>Capture <em>expr</em> for use with <code>$1</code>, etc.</td>    </tr>    <tr>        <td><code>(?:</code><em>expr</em><code>)</code></td>        <td>Non-capturing group.</td>    </tr>":jt=jt&"    <tr bgcolor=""f2eab7"">        <td><code>(?=</code><em>expr</em><code>)</code></td>        <td>Followed by <em>expr</em>.</td>    </tr>    <tr>        <td><code>(?!</code><em>expr</em><code>)</code></td>        <td>Not followed by <em>expr</em>.</td>    </tr>    <tr bgcolor=""f2eab7"">        <td><code>\b</code></td>        <td>A word boundary.</td>    </tr>    <tr>        <td><code>\B</code></td>        <td>A non-(word boundary).</td>    </tr>":jt=jt&"    <tr bgcolor=""f2eab7"">        <td><code>\xFF</code></td>        <td>Any hexadecimal ASCII value.</td>    </tr>    <tr>        <td><code>\uFFFF</code></td>        <td>Any hexadecimal Unicode value.</td>    </tr>    <tr bgcolor=""f2eab7"">        <td><code>\n</code></td>        <td>The line feed (\x0A).</td>    </tr>    <tr>        <td><code>\r</code></td>        <td>The carriage return (\x0D).</td>    </tr>    <tr bgcolor=""f2eab7"">        <td><code>\1</code>, etc.</code></td>        <td>The text from the nn-th group.</td>    </tr></table>":jt=jt&"<br /><b>Replacement tokens</b><table>    <tr bgcolor='Pink'>        <td><code>$$</code></td>        <td>The literal character '$'.</td>    </tr>    <tr>        <td><code>$&</code></td>        <td>The entire matched string.</td>    </tr>    <tr bgcolor='Pink'>        <td><code>$`</code></td>        <td>The substring preceding the matched substring.</td>    </tr>    <tr>        <td><code>$'</code></td>        <td>The substring following the matched substring.</td>    </tr>":jt=jt&"    <tr bgcolor='Pink'>        <td><code>$1</code>, etc. &nbsp</td>        <td>The nn-th captured submatch.</td>    </tr>    <tr>        <td><code>$+</code></td>        <td>The last matched substring.</td>    </tr>    <tr bgcolor='Pink'>        <td><code>$_</code></td>        <td>The entire input string.</td>    </tr></table>":jt=jt&"<br /><b>Custom VBScript functions</b><table>    <tr bgcolor='PaleGreen'>        <td><code>IIf(expr, truepart, falsepart)</code></td>        <td>Returns one of two parts, depending of an expression. Preset example: ""Copy the release Date to the Original date..."".</td>    </tr>    <tr>        <td><code>IfNull(expr1, expr2)</code></td>        <td>Returns a copy of the first non-NULL argument. Preset example: ""Assign the average album's rating to the Custom 3 field"".</td>    </tr>    <tr bgcolor='PaleGreen'>        <td><code>RegExp(string, pattern, index)</code></td>        <td>Returns the text matched to the string. Preset example: ""Assign the disc number to the Track number..."".</td>    </tr>    <tr>        <td><code>RegExpEx(string, pattern, index, subindex)</code></td>        <td>Similar to previous, but could be specified the number of captured group. Preset example: ""Assign (... remix/version/edit ...)..."".</td>    </tr>":jt=jt&"    <tr bgcolor='PaleGreen'>        <td><code>RegSub(string, pattern, replace)</code></td>        <td>Performs substitution based on pattern matching. Preset example: ""Copy the Artist name to the Custom 3 field..."".</td>    </tr>    <tr>        <td><code>MapArray(arrayofchars)</code></td>        <td>Converts an array of string pairs where the first string should be a ""$"" token with the number of the captured group and the second one is its replacement. Preset example: ""Fix common words..."".</td>    </tr>    <tr bgcolor='PaleGreen'>        <td><code>MapArrayCase(arrayofchars)</code></td>        <td>Similar to MapArray, but the replaced string would be capitalized if the first character of the original string is in upper case. Preset example: ""Remove diacritical marks..."".</td>    </tr>    <tr>        <td><code>MapArrayEx(source, arrayofstrings)</code></td>        <td>Source should be ""$&""; arrayofstrings should contain directly specified pairs with the original string and its replacement. Preset example: ""Convert Serbian Latin..."".</td>    </tr>":jt=jt&"    <tr bgcolor='PaleGreen'>        <td><code>SQLQuery(expr)</code></td>        <td>Returns a value of the first column/record of a SQL query. Preset example: ""Assign the average Bitrate to the last folder"".</td>    </tr>    <tr>        <td><code>Min(expr1, expr2); Max(expr1, expr2)</code></td>        <td>Returns minimal or maximal value of two values.</td>    </tr>    <tr bgcolor='PaleGreen'>        <td><code>DateTimeISO(datetime)</code></td>        <td>Returns date/time in ISO 8601 format (yyyy-mm-dd hh:mm:ss), useful for sorting of the string field containing date/time values.</td>    </tr>    <tr>        <td><code>SetVar(varName, varValue)</code></td>        <td>Sets varValue to the temporary variable with varName (could be numeric or string), and returns the same value.</td>    </tr>    </tr>    <tr bgcolor='PaleGreen'>        <td><code>GetVar(varName)</code></td>        <td>Returns value from the temporary variable with varName, could be used in the same expression as corresponding SetVar.</td>    </tr></table>":jt=jt&"<br /><b>Custom VBScript variables</b><table>    <tr bgcolor='PaleGreen'>        <td><code>lSongIndex</code></td>        <td>The ordinal number of the current track.</td>    </tr>    <tr>        <td><code>oSongList.Count</code></td>        <td>The total number of selected/visible tracks.</td>    </tr>    <tr bgcolor='PaleGreen'>        <td><code>oSongData.TrackOrderStr</code></td>        <td>The track number of the current track.</td>    </tr>    <tr>        <td><code>oSongData.Title</code></td>        <td>The title of the current track.</td>    </tr>    <tr bgcolor='PaleGreen'>        <td><code>oSongData.ArtistName</code></td>        <td>The artist name of the current track.</td>    </tr></table>":jt=jt&"<br />Similarly to previous 3 examples, you could use oSongData variable with almost any property supported by ISDBSongData - AlbumName, AlbumArtistName, Author,... <br />You don't need to type this variables - it is enought to click on the button << between Replace with and From dropdown lists. The full list of those properties with their description is at <a href='http://www.mediamonkey.com/wiki/index.php/SDBSongData' target='_blank'>MediaMonkey's Web site</a>.":jt=jt&"</body></html>":jb.sethtmldOcuMENT jt:Else nt=False:nk.cAPtiOn="?":If Len(v)Then jb.seThTMLdOCuMeNT v:Else oq:End If:End If:End Sub:Function bh(ol):Dim at:at=p3(ol):If at>0 Then bh=d7(at):Else bh=ol:End If:End Function:Sub ai():Dim e6,qn,kp,at:Set qn=jb.INTErF.Document.aCtIVeELeMENt:If Not qn Is Nothing Then If Len(qn.GeTaTTRIbUtE("Name"))>0 Then If qn.name="chk0"Then hh=qn.chECKeD:Set e6=CreateObject("Scripting.Dictionary"):For at=1 To oSongList.Count:e6.aDD at,hh:Next:Set SdB.ObJeCtS("CheckedTracks")=e6:For at=pm To az:Set qn=jb.INtERF.Document.All.Item("chk"&at):If Not qn Is Nothing Then qn.chECKeD=hh:End If:Next:at=m9:If hh Then cs=oSongList.Count:Else cs=0:End If:kp=True:Else If Left(qn.NAME,3)="chk"Then at=CLng(Mid(qn.naMe,4)):If sdB.OBjecTS("CheckedTracks").Item(at)And Not qn.ChECKed Then cs=cs-1:Else If Not SDb.OBjECts("CheckedTracks").Item(at)And qn.cheCKeD Then cs=cs+1:End If:End If:sdb.OBJEcts("CheckedTracks").Item(at)=qn.chECkeD:kp=True:End If:End If:If kp Then If IsObject(ny)Then If at=m9 Then If Not qn.CHeckED Then ny.COmmOn.ENAbLEd=False:Else ny.COMMON.enaBLED=ec:End If:End If:If cs=0 Then qq.cOmMoN.ENabled=False:Else qq.COmMON.ENABLeD=f3:End If:End If:v=jb.inTerf.Document.GEteLeMENtsBytAGNAMe("html").Item(0).oUTErhtMl:End If:Else If Left(qn.id,8)="tdNumber"Then o3.Value=CLng(Mid(qn.ID,9)):End If:End If:End If:End Sub:Function RegExpEx(l3,k0,m0,l1):Dim w,x:Set w=New RegExp:w.Global=True:w.IgnoreCase=Not oi:w.Pattern=k0:Set x=w.Execute(l3):If x.Count>m0 Then If x.Item(m0).SubMatches.Count>l1 Then RegExpEx=x.Item(m0).SubMatches.Item(l1):End If:End If:End Function:Function MapArrayEx(ol,cx):Dim at,r0,ji,jq,w,ga:Set w=New RegExp:w.Global=True:w.IgnoreCase=False:MapArrayEx=ol:For at=0 To UBound(cx)Step 2:If VarType(cx(at))=vbInteger Then w.Pattern="\u"&Right("000"& Hex(cx(at)),4):ji="\u"&Right("000"& Hex(AscW(UCase(ChrW(cx(at))))),4):Else w.Pattern=cx(at):ga=Split(cx(at),"|"):For r0=0 To UBound(ga):ga(r0)=UCase(Left(ga(r0),1))&LCase(Mid(ga(r0),2)):Next:ji=Join(ga,"|"):End If:If VarType(cx(at+1))=vbInteger Then jq=ChrW(cx(at+1)):Else jq=cx(at+1):End If:MapArrayEx=w.Replace(MapArrayEx,jq):If Not oi Then w.Pattern=ji:jq=UCase(Left(jq,1))&LCase(Mid(jq,2)):MapArrayEx=w.Replace(MapArrayEx,jq):End If:Next:End Function:Sub kz(q):Dim c,s:a7:b8 q:c=q8(q):If sDb.ObjECTS("PrstStrColl").Item(q)<>c Then SDB.OBJEcts("PrstStrColl").Item(q)=c:Set s=c5.InTErF.document.ALl.item("tdPreset"&q):If Not s Is Nothing Then s.Innerhtml=ls(c):kc.EnAblED=True:End If:End If:End Sub:Sub fg(a):ka=a.CHeCked:oq:End Sub:Function ls(c):Dim e4:e4=pf(c):ef.Pattern="(Name *?: *&quot;)((?:&quot;&quot;|.)*?)(?=&quot;(?!&quot;))+":ef.Global=False:e4=ef.Replace(e4,"$1<span class='itemname'>$2</span>"):ef.Pattern="(Menu *?: *&quot;)((?:&quot;&quot;|.)*?)(?=&quot;(?!&quot;))+":ls=ef.Replace(e4,"$1<b>$2</b>"):End Function:Sub pc(q):Dim t,h7,i9,lv,pz,o:t=c4.keYS:h7=t(qo):i9=t(mx):o=mf(i4,h7,i9):lv=bh(h7):If lv=h7 Then lv="":End If:pz=bh(i9):If pz=i9 Then pz="":End If:o=mf(o,lv,pz):ae q,"Menu: "&dg(bq)&", Name: "&dg(o)&", Description: "&dg(hi)&", Shortcut: "&dg(ij)&", Icon: "&dg(IIf(Left(o2,Len(sDb.apPlIcatioNpaTh))=sdB.APPLicATioNpaTH,Mid(o2,Len(sdB.AppLICatIONpAtH)+1),o2))&", Toolbar: "&IIf(j2,"1","0")&", FindWhat: "&dg(a0)&", FindInto: "&dg(h7)&", FindRegExp: "&IIf(fh,"1","0")&", WholeWord: "&IIf(ka,"1","0")&", ReplaceWith: "&dg(d0)&", ReplaceFrom: "&dg(i9)&", ReplaceRegExp: "&IIf(jv,"1","0")&", ReplaceVBScr: "&IIf(pn,"1","0")&", MatchCase: "&IIf(oi,"1","0"):End Sub:Sub mm(qv,ek):If qv=32 And Not p8 Or qv=79 And ek=4 Then l5=True:If Not p8 Then nm=False:hs.InterVal=nf:hs.eNABlED=True:dy:p8=True:End If:End If:End Sub:Sub bx(hu):Dim hx,d,du,g,sAfter,fi,m6,n3,ii,iu,s,f1,op,e0,i7:If Not cr Then Exit Sub:End If:cr=False:hu.eNABled=False:If oSongList.Count>0 Then If m9>oSongList.Count Then m9=oSongList.Count:End If:Set e0=oSongList.Item(m9-1):On Error Resume Next:Set oSongData=e0.GeTCopy:If Err Then sAfter=Err.Description:If eu Then i7=SDb.pLaYeR.cuRrENtsOngLISt.Count:Else i7=sdB.aLlVisibLEsonglisT.Count:End If:Sdb.mESsAGEBox"This is an unexpected error, please report it to the author"&vbCr&"of the RegExp F&&R add-on with the following details."&vbCr&sAfter&vbCr&vbCr&"Visible="&i7&vbCr&"Count="&oSongList.Count&vbCr&"Index="&m9&vbCr&"Value="& o3.Value,mTErROr,Array(MBok):Exit Sub:End If:On Error GoTo 0:g=cm(qo):sAfter=r2(g):Set oSongData=e0.GETCopy:n3=sAfter:If sAfter=eb Or IsNull(sAfter)Then ii="hlrplcmtch":Else If CStr(sAfter)=CStr(g)Then ii="hlmatch":Else ii="hlreplace":End If:End If:hx=hv(g,mt.TExT,"",ii,0):If gb.ChecKEd Then du=cm(mx):If InStr(hx,"<span class='")=0 Or Len(mt.TEXT)=0 Or hx=eb Then d="hlrplcmtch":Else d=ii:End If:d=hv(du,jz.tExT,"",d,1):If d=eb Then d="<div class='errexpr'>"&eb&"</div>":n3=d:Else If sAfter=eb Then n3="<div class='errexpr'>"&eb&"</div>":Else du=ep(du,k6(jz.TEXT,True)):n3=hv(g,mt.TeXT,du,ii,2):End If:End If:Else du=jz.TexT:Select Case sAfter:Case eb:n3="<div class='errexpr'>"&sAfter&"</div>":Case q7:n3="<div class='errcrtc'>"&sAfter&"</div>":Case Else n3=hv(g,mt.TExT,du,ii,2):End Select:If(sAfter=eb Or sAfter=q7)And qg.chEcKed=True Then d=n3:Else ef.Pattern="<span class='"&ii&"'>(.*?)</span>":On Error Resume Next:Set hk=ef.Execute(n3):If Err<>0 Then d="":Else If hk.Count>0 Then ef.Pattern="(.*?)(<span class='"&ii&"'>(?:.*?)(?:</span>)|$)":d=RTrim(ef.Replace(n3,"$2 ")):Else If qg.chECked Then d=Eval(k6(du,False)):If Err<>0 Then d=eb:n3="<div class='errexpr'>"&eb&"</div>":Else d="<span class='hlrplcmtch'>"&pf(d)&"</span>":End If:Else d="<span class='hlrplcmtch'>"&pf(jz.TeXt)&"</span>":End If:End If:End If:On Error GoTo 0:End If:End If:Set oSongData=e0:If cr Then Exit Sub:End If:If hx=eb Then hx="<div class='errexpr'>"&eb&"</div>":End If:m3.IntErf.document.BODy.inNErHTml=hx:hf.InTErF.document.BoDy.iNneRHTMl=d:ax.intERf.document.body.iNNeRhtmL=n3:Else m3.intERf.document.bodY.inNErHtml="":hf.INtErf.document.BOdy.iNNErhTml="":ax.InTERF.document.boDy.inNerHTML="":End If:If nt Or Not ac Then v="":Else If jf.ITEmtexT(qo)="Path"Then fi=46:m6=True:Else fi=23:m6=False:End If:If Len(f)Then v="<html><head>"&dl&"<style type='text/css'>":Else v="<html><head><style type='text/css'>table {font-size: 11px; font-family: Tahoma, Arial, sans-serif;} thead {color: black; background-color: silver;} tr.even {color: black; background-color: white;} tr.odd {color: black; background-color: Gainsboro;} .hlnumber {color: black; background-color: Silver;} .hlreplace {color: "&by&"; background-color: "&b1&";} .errexpr {color: red;} .errcrtc {color: white; background-color: red;} .solving {color: blue;} ":End If:v=v&"body.tbl {margin: 0; overflow: auto;} td {padding: 0px 3px 0px 3px}":v=v&" div.tableContainer {overflow: auto; width: offsetParent.offsetWidth; height: offsetParent.offsetHeight;} thead tr {position:relative; top: expression(offsetParent.scrollTop);}":v=v&"</style></head>":v=v&"<script language='VBScript'><!-- "&vbNewLine&"Sub NumOver(lIndex)"&vbNewLine&"  Document.getElementById(""tdNumber"" & lIndex).className = ""hlnumber"""&vbNewLine&"End Sub"&vbNewLine&"Sub NumOut(lIndex)"&vbNewLine&"  Document.getElementById(""tdNumber"" & lIndex).className = """""&vbNewLine&"End Sub"&vbNewLine&" --></script>":v=v&"<body class='tbl'><div class='tableContainer'><table cellspacing='0'><thead><tr><td width='4%' class='head'><input type='checkbox' name='chk0' ":If hh Then v=v&"checked ":End If:If sDb.Inifile.bOoLvaLUe("Appearance","ShowToolTips")Then v=v&"title='Select or deselect all ":If SDB.VersIONhi>=4 Then v=v&"files' ":Else v=v&"tracks' ":End If:End If:v=v&"/></td><td width='4%' class='head'>#</td><td width='"&fi&"%' class='head' id='tdBefore'>Old "&jf.iTemtExt(qo)&"</td><td width='"&fi&"%' class='head' id='tdAfter'>New "&jf.ITEmtEXt(qo)&"</td>":If Not m6 Then v=v&"<td width='46%' class='head'>Path</td>":End If:v=v&"</tr></thead><tbody>":With jb.INTerF.document:If Not .aLl.item("trRow"&lSongIndex)Is Nothing Then f1=.BODy.scROllTOp:End If:End With:If oSongList.Count>0 Then iu=am(pm,az,m6,sAfter,False):If Len(iu)=0 Then Set oSongData=oSongList.Item(lSongIndex-1):Exit Sub:End If:jb.sEtHtMlDocUMenT v&iu&"</tbody></table></div></body></html>":iu=am(pm,az,m6,sAfter,True):If Len(iu)=0 Then Set oSongData=oSongList.Item(lSongIndex-1):Exit Sub:End If:Else iu="":End If:v=v&iu&"</tbody></table></div></body></html>":jb.SEThTmldOcUMent v:Set oSongData=oSongList.Item(lSongIndex-1):If oSongList.Count>0 And Not cr Then With jb.intErf.document:Set s=.all.item("trRow"&lSongIndex):If Not s Is Nothing Then .boDy.SCroLlTop=f1:On Error Resume Next:If s.OFFsetTOp+s.OFfsETHEighT>.BOdy.scRoLLtOp+.BOdy.oFFsEtHEiGHT Then s.ScroLLintOviEW False:Else op=.aLL.tAGS("thead").item(0).OffSETHEIghT:If s.oFfseTtop-op<.BOdy.scrolltop Then s.scroLLINtOvIEw True:.bODy.scROLLTOP=s.OFfSEttoP-op:End If:End If:On Error GoTo 0:End If:End With:End If:ac=False:End If:If sAfter=q7 Or Len(a0)=0 Or oSongData Is Nothing Or oSongList.Count=0 Then f8.cOMMOn.EnablED=False:If IsObject(ny)Then ny.COmMon.enAbLEd=False:qq.cOMmon.EnAbled=False:q3.cOMMoN.EnableD=False:pe.CoMMOn.EnaBlED=False:ec=False:f3=False:End If:Else If lSongIndex=oSongList.Count And Not ks.CHeCKed Or lSongIndex=1 And ks.cHECKED Or cg Then f8.CommOn.eNaBlEd=False:Else f8.CommON.enablED=True:End If:cg=False:If IsObject(ny)Then If sAfter=eb Then ny.CoMMon.eNablED=False:ec=False:Else If Not sDB.objECTs("CheckedTracks").Item(lSongIndex)Then ny.cOmmON.EnaBleD=False:ec=True:Else ny.coMMON.ENabLed=True:ec=True:End If:End If:If cs=0 Then qq.COMmon.ENabLeD=False:Else qq.COMMon.enabLED=True:End If:id True:f3=True:End If:End If:SDB.ProcESsMESSAgES:If Not sdb.objECTs("RegExpDialog")Is Nothing And Not sDb.oBJeCTs("tbrRegExpReplaceDialog").ChEcKeD Then sDB.objeCts("tbrRegExpReplaceDialog").CHeCkEd=True:End If:End Sub:Function GetVar(qj):If VarType(qj)=vbInteger Then If UBound(kt)>=qj Then GetVar=kt(qj):Else GetVar="":End If:Else If ip.eXIStS(qj)Then GetVar=ip.Item(qj):Else GetVar="":End If:End If:End Function:Sub pg(a):ok=a.TexT:If Not k Then a3:fv:r9.ComMon.ENAblEd=(ob>0 And(o8 Imp Not l9)):qm.CoMMOn.ENablED=False:dw.COmmoN.ENABled=(ob>0):End If:End Sub:Sub py(p,o,gi):Dim en,qf,fc,t,z:en="mnuRegExpGroup"&gi:qf="mnuRegExpPreset"&gi:fc=p&"\"&o:If sDb.ObjEcts(qf).ExisTs(fc)Then With sdb.Objects(qf).Item(fc):.captIOn="":.HINT="":.ShOrTCut="":.vISIblE=False:End With:Set sdb.ObjEcts(qf).Item(fc)=Nothing:sdB.objecTs(qf).REMOVe fc:End If:If sDB.OBJecTs(en).ExiStS(p)Then t=SdB.ObJEctS(qf).kEYs:For z=0 To UBound(t):If Left(t(z),Len(p)+1)=p&"\"Then Exit Sub:End If:Next:sdB.OBjECTs(en).Item(p).ViSIbLE=False:If p<>oj Then Set SDb.obJeCTS(en).Item(p)=Nothing:Sdb.objECtS(en).rEMoVE p:End If:End If:End Sub:Sub k9(na,f,lu):Dim jp,at:Set jp=na.intErf.document:at=0:Do While at<=jp.styleSheEtS.lEngTH-1:If f=jp.STyLeshEEts(at).HRef Then jp.sTylEsheEtS(at).HREf=lu:Exit Do:End If:at=at+1:Loop:End Sub:Sub d4(a):qo=a.iTeMinDex:If IsObject(ma)Then oq:End If:End Sub:Sub le():If sDb.VERSiOnHi<4 Then If sDB.OBJEcts("RFROptionsTimer")Is Nothing Then Set Sdb.oBjeCTS("RFROptionsTimer")=Sdb.crEAtEtiMer(200):ScrIpT.rEGisterEvENt sdB.OBJECtS("RFROptionsTimer"),"OnTimer","em":End If:Sdb.objEcTS("RFROptionsTimer").enABLeD=True:Else em Nothing:End If:End Sub:Function MapArrayCase(cx):Dim at:For at=0 To UBound(cx)Step 2:MapArrayCase=MapArrayCase&MapChrCase(cx(at),cx(at+1)):Next:End Function:Sub d9(a):pn=a.cHECkED:If pn And gb.ChEcKed Then gb.cHEcked=False:Else lb:oq:End If:End Sub:Function q8(q):q8=sDb.iNiFiLE.STriNGvaLuE("RegExpPresets","Preset"&q):End Function:Sub eq(a):hi=a.TEXT:h3:End Sub:Sub ic():With sDb.COmMonDialoG:.DeFAUlteXt="ini":.Filter="RegExp Ini file (*.ini)|*.ini|All files (*.*)|*.*":If l9 Then .FLags=b9:End If:On Error Resume Next:If Len(ok)=0 Then .inItdIr=Left(SCrIpt.SCrIptpAtH,InStrRev(sCrIpt.SCRIptPAtH,"\")):Else .InItdiR=Left(ok,InStrRev(ok,"\")):.FIlenaME=Mid(ok,InStrRev(ok,"\")+1):End If:On Error GoTo 0:.TItlE="Select file for import of RegExp presets":.sHOWoPEN:If .OK Then l9=CBool(.fLaGs And b9):If ok<>.fIlEname Then n4.teXt=.FILeNAMe:Else pg n4:End If:End If:End With:End Sub:Sub p4(l7):OptionsDialog:End Sub:Function l(c,qi):ef.Pattern="((?:[^"",]|(?:""(?:[^""])*?""))+)":If Not IsNumeric(qi)Then ef.Pattern=qi&" *?: *?"&ef.Pattern:End If:ef.Global=True:On Error Resume Next:Set hk=ef.Execute(c):If Err=0 Then On Error GoTo 0:If hk.Count>0 Then If Not IsNumeric(qi)Then If hk.Item(0).SubMatches.Count>0 Then l=pj(Trim(hk.Item(0).SubMatches.Item(0))):l=Replace(l,Chr(34)&Chr(34),Chr(34)):End If:Else l=Trim(hk.Item(qi).Value):End If:End If:End If:End Function:Sub ml():Dim t:t=c4.keyS:Select Case t(mx):Case"Comment","Lyrics":jz.TexT="^(?:.|\r\n)*":Case Else jz.tExT="^.*":End Select:End Sub:Sub gw():Dim t:t=c4.KEYS:Select Case t(qo):Case"Comment","Lyrics":mt.teXT="^(?:.|\r\n)*":Case Else mt.TexT="^.*":End Select:End Sub:Sub dv(a):Dim o9:If y<>a.iteMiNdeX Then i4=iq:End If:If fp Then a.iTEMIndex=y:Exit Sub:End If:If o3.Value>1 Then o3.Value=1:End If:If ks.cHEckeD Then ks.cHECkeD=False:End If:o9=k:k=True:y=a.ITEMINDeX:l6 y+1:If y=-1 Then dr:End If:If Not o9 Then k=False:oq:k=True:End If:qb:h3:k=True:mo.Value=-y:k=o9:li:End Sub:Sub km():Dim h,co,m,z,e,c,p,gq,lz:Set h=SDB.ToOLs.INifIlebypAtH(ok):If Not h Is Nothing Then co=CLng(ha(h,False,False)):If co Then lz=False:If Not Sdb.Objects("RegExpDialog")Is Nothing Then On Error Resume Next:If sdB.vErSionbUiLd<1205 Then:Else lz=True:End If:On Error GoTo 0:End If:Set m=SDB.INIfILE.kEYS("RegExpPresets"):For z=m.Count-co To m.Count-1:e=m.Item(z):c=Mid(e,InStr(e,"=")+1):p=l(c,"Menu"):ja c,p:If lz Then n.aDDiTEm l(c,"Name"):End If:Next:ho:If lz Then mo.MiNvalUe=1-n.itEmCouNT:If y=-1 Then k=True:dv n:k=False:Else li:End If:End If:gq="Imported "&co&" preset"&IIf(co>1,"s",""):Else gq="None preset is imported":End If:sdB.MeSsAGebox gq&" from the specified file.",mTinfOrmAtiON,Array(mBOk):End If:End Sub:eo=sdb.AppLICationpATh&"Scripts\Auto\EventLogger.vbs":If SdB.tOOLs.FileSystem.fiLEEXisTS(eo)Then SCript.INCLUDe eo:Else eo=Left(SDB.dATabAsE.PatH,InStrRev(SDb.DATabasE.PATh,"\"))&"Scripts\Auto\EventLogger.vbs":If sdB.tOoLS.FileSystem.fiLEexiSTS(eo)Then scripT.InclUdE eo:Else eo="":End If:End If:Sub et(c,o,bs):Dim ld:o=l(c,"Name"):If Not kd Then o=ih(o,l(c,"FindInto"),l(c,"ReplaceFrom")):End If:ld=l(c,"Icon"):If Len(ld)=0 Then bs=-1:Else If IsNumeric(ld)Then bs=Int(ld):Else If sdb.TOOls.FileSystem.fILEeXisTS(sDb.apPlICatIoNpaTh&ld)Then ld=sDb.APPlICAtiONPATH&ld:If Not IsObject(d8)Then Set d8=CreateObject("Scripting.Dictionary"):End If:If Not d8.EXISTs(ld)Then d8.aDd ld,SDB.ReGISTERiCoN(ld,0):End If:bs=CInt(d8.Item(ld)):Else If SDb.tOolS.FileSystem.filEexIsTS(ld)Then If Not IsObject(d8)Then Set d8=CreateObject("Scripting.Dictionary"):End If:If Not d8.eXIsTs(ld)Then d8.AdD ld,SDB.REGiStERIcoN(ld,0):End If:bs=CInt(d8.Item(ld)):Else bs=-1:End If:End If:End If:End If:End Sub:Sub i5(a):a.cOMmOn.PareNT.COmMoN.cHildContrOl("SynchronizedTracks").COMmon.ENABLED=a.CHeCKED:End Sub:Sub em(hu):Dim m1,qt,h,w,x,m,z,e,q,c,o,jg,k1,n5,s,r5,t,lu,at:If Not hu Is Nothing Then hu.enAbLEd=False:Set hu=Nothing:End If:Set h=SDb.INiFIle:kd=h.bOOLvaLUE("RegExpOptions","ShowPresetAdjustDialog"):If Not kd Then Set w=New RegExp:w.IgnoreCase=True:w.Pattern="^Preset(\d+) ?=.*Name: ?""((?:""""|[^""])*)""":Set m=h.KEYs("RegExpPresets"):End If:For m1=1 To IIf(SdB.VersIonHI<3,3,5):qt=h.stRINGvaLuE("CustomFields","Fld"&m1&"Name"):If d7(m1)<>qt Then n5=d7(m1):d7(m1)=qt:If Not kd Then For z=0 To m.Count-1:e=m.Item(z):If w.Test(e)Then Set x=w.Execute(e):q=Int(x.Item(0).SubMatches.Item(0)):If q>0 Then o=Replace(x.Item(0).SubMatches.Item(1),Chr(34)&Chr(34),Chr(34)):c=LTrim(Mid(e,InStr(e,"=")+1)):jg=l(c,"FindInto"):k1=l(c,"ReplaceFrom"):If(InStr(1,o,"<From Field>",1)>0 And p3(jg)=m1 Or InStr(1,o,"<Into Field>",1)>0 And p3(k1)=m1)Then ja c,l(c,"Menu"):r5=True:End If:End If:End If:Next:End If:If Not SDb.obJeCTs("RegExpDialog")Is Nothing Then For at=0 To jf.ITemCounT-1:If jf.iTemtext(at)=n5 Then jf.itEMtext(at)=qt:If qo=at Then Set s=jb.INTERF.document.aLl.item("tdBefore"):If Not s Is Nothing Then s.iNNerhtml="Old "&pf(qt):End If:Set s=jb.inTeRF.document.ALl.item("tdAfter"):If Not s Is Nothing Then s.InnErHtML="New "&pf(qt):End If:End If:Exit For:End If:Next:For at=0 To ps.ITeMCount-1:If ps.ItemtEXt(at)=n5 Then ps.ItEmtEXT(at)=qt:Exit For:End If:Next:End If:End If:Next:If r5 Then ho:End If:If pt(h)Then If Not SDb.obJECts("RegExpDialog")Is Nothing Then t=c4.keyS:If t(qo)=ex Or jv And t(mx)=ex Then oq:End If:End If:End If:If Not sdB.OBjECTS("RegExpDialog")Is Nothing Then lu=a6:If f<>lu Then k9 g2,f,lu:k9 m3,f,lu:k9 hf,f,lu:k9 ax,f,lu:k9 jb,f,lu:f=lu:dl="<link href='"&f&"' rel='stylesheet' type='text/css'>":End If:End If:End Sub:Sub lj():cc.commOn.EnABleD=(lSongIndex>1):fz.cOMmon.EnAbLEd=(lSongIndex<oSongList.Count):End Sub:Function ha(h,j4,qe):Dim ew,ie,e,ao,ad,gt,b0,gy,c,o,ly,jo,gq,k2,c2,at:ha=0:If j4 Then Set ew=h.KeYS("RegExpPresets"):Set ie=SdB.inIfIlE.KeYs("RegExpPresets"):Else Set ew=sdb.InifiLE.KeYs("RegExpPresets"):Set ie=h.kEyS("RegExpPresets"):End If:gt=0:Set ao=CreateObject("Scripting.Dictionary"):For at=0 To ew.Count-1:e=ew.Item(at):c=Mid(e,InStr(e,"=")+1):If Len(c)>0 And Left(e,8)<>"Preset0="Then o=l(c,"Name"):If Not ao.eXIsts(o)Then ao.Add o,c:gt=gt+1:End If:End If:Next:b0=1:gy=0:Set ad=CreateObject("Scripting.Dictionary"):For at=0 To ie.Count-1:e=ie.Item(at):c=Mid(e,InStr(e,"=")+1):If Len(e)>0 And Left(e,8)<>"Preset0="Then If qe Then ly=True:Else If b0=b Or b=0 And sdB.oBJEctS("PrstChkColl").Item(b0)Then ly=True:Else ly=False:End If:End If:If ly Then o=l(c,"Name"):If Not ao.Exists(o)Then ad.ADd CStr(gy),c:gy=gy+1:End If:End If:b0=b0+1:End If:Next:If ad.Count>0 Then If qe Then If gt>0 Then gq="You already have installed "&gt&" RegExp preset"&IIf(gt>1,"s","")&"."&vbCr&vbCr:Else gq="":End If:If sDB.MESSaGEbox(gq&"Would you like to add the "&ad.Count&" new sample preset"&IIf(ad.Count>1,"s","")&" from the install package?",MTcOnfIRMATIoN,Array(MByES,MBNO))=mRNo Then Exit Function:End If:End If:For at=ew.Count-1 To 0 Step-1:e=ew.Item(at):c=Mid(e,InStr(e,"=")+1):If Len(c)=0 Or Left(e,8)="Preset0="Then ew.dELETe at:End If:Next:For at=0 To ad.Count-1:ew.aDD"Preset"&at&"="&ad.Item(CStr(at)):Next:ha=ad.Count:ad.REMoVeALL:End If:b0=1:For at=0 To ie.Count-1:e=ie.Item(at):c=Mid(e,InStr(e,"=")+1):If Len(c)>0 And Left(e,8)<>"Preset0="Then If qe Then ly=True:Else If b0=b Or b=0 And SDb.OBJEctS("PrstChkColl").Item(b0)Then ly=True:Else ly=False:End If:End If:If ly Then o=l(c,"Name"):If Not ad.eXIstS(o)Then ad.AdD o,c:End If:End If:b0=b0+1:End If:Next:gt=0:ao.RemoVeAlL:For at=0 To ew.Count-1:e=ew.Item(at):c=Mid(e,InStr(e,"=")+1):If Len(c)>0 And Left(e,8)<>"Preset0="Then o=l(c,"Name"):If ad.eXiStS(o)Then If c<>ad.Item(o)Then ao.AdD CStr(at),o:If gt=9 Then c2=c2&"and "&Left(e,InStr(e,"=")-1)&", ":Else If gt>9 Then c2=c2&Mid(e,7,InStr(e,"=")-7)&", ":Else c2=c2&Left(e,InStr(e,"="))&o&vbCrLf:End If:End If:gt=gt+1:End If:End If:End If:Next:If ao.Count>0 Then jo="MediaMonkey.ini file":If qe Then gq="install package":Else If j4 Then gq=jo:jo="specified file":Else gq="specified file":End If:End If:If ao.Count>1 Then k2="s":End If:Select Case Sdb.MEssAGEbOX("The "&jo&" has "&ao.Count&" preset"&k2&" with different content"&vbCr&"from the preset"&k2&" with the same name in the "&gq&":"&vbCr&vbCr&Left(c2,Len(c2)-2)&vbCr&vbCr&"Do you want to update "&IIf(ao.Count>1,"those","that")&" preset"&k2&"?",MTConFIrMation,Array(MbyeS,MBno)):Case mrYes:For at=0 To ew.Count-1:If ao.exIsTs(CStr(at))Then o=ao.Item(CStr(at)):If ad.exIStS(o)Then ew.Item(at)="Preset"&at&"="&ad.Item(o):End If:End If:Next:If ha=0 Then For at=ew.Count-1 To 0 Step-1:e=ew.Item(at):c=Mid(e,InStr(e,"=")+1):If Len(c)=0 Or Left(e,8)="Preset0="Then ew.DELETE at:End If:Next:End If:ha=ha+ao.Count:End Select:End If:If ha>0 Then If j4 Then h.deletesecTIOn"RegExpPresets":Else Sdb.iNIfile.DELETEsEctIOn"RegExpPresets":End If:For at=0 To ew.Count-1:e=ew.Item(at):c=Mid(e,InStr(e,"=")+1):If j4 Then h.STRiNgVaLuE("RegExpPresets","Preset"&at+1)=c:Else ae at+1,c:End If:Next:End If:End Function:Sub kf(a):js=a.iTEmINdEx:End Sub:Sub mr(q,oc,gs):Dim pk,kl,ph,gh,q1,lw,fu,pr,fy,l4,w,x,m,z,e,qx,c,p,ki,di,ne,t:ae q-1,oc:ae q,gs:pk=l(gs,"Menu"):If Len(pk)=0 Then pk=oj:End If:kl=l(oc,"Menu"):If Len(kl)=0 Then kl=oj:End If:ph=l(gs,"Name"):gh=l(oc,"Name"):If kl=pk Then j7 kl,gh,pk,ph,False:ja oc,kl:ja gs,pk:ne=l(gs,"Toolbar"):If ne="1"Or LCase(ne)="true"Then ne=l(oc,"Toolbar"):If ne="1"Or LCase(ne)="true"Then ho:End If:End If:Else If pk<>oj And kl<>oj Then q1=po(q-1,kl):lw=po(q,pk):If q1=1 And lw=1 Then j7 kl,gh,pk,ph,False:ja oc,kl:ja gs,pk:ne=l(gs,"Toolbar"):If ne="1"Or LCase(ne)="true"Then ne=l(oc,"Toolbar"):If ne="1"Or LCase(ne)="true"Then ho:End If:End If:Set fu=CreateObject("Scripting.Dictionary"):Set pr=CreateObject("Scripting.Dictionary"):Set w=New RegExp:w.IgnoreCase=True:w.Pattern="^Preset(\d+) ?=.*Name: ?""((?:""""|[^""])*)""":Set m=sdb.InifiLe.KeyS("RegExpPresets"):For z=0 To m.Count-1:e=m.Item(z):If w.Test(e)Then Set x=w.Execute(e):qx=Int(x.Item(0).SubMatches.Item(0)):If qx>0 Then c=Mid(e,InStr(e,"=")+1):p=l(c,"Menu"):If p=kl Then If Not pr.eXists(qx)Then pr.Add qx,c:End If:Else If p=pk Then If Not fu.exISTS(qx)Then fu.AdD qx,c:End If:End If:End if:End If:End If:Next:l4=pr.KEYs:fy=fu.kEYs:For z=1 To Max(UBound(fy),UBound(l4)):If z<=UBound(fy)Then ki=fu.Item(fy(z)):ph=l(ki,"Name"):End If:If z<=UBound(l4)Then di=pr.Item(l4(z)):gh=l(di,"Name"):End If:If z<=UBound(l4)And z<=UBound(fy)Then j7 kl,gh,pk,ph,True:ja di,kl:ja ki,pk:Else If z>UBound(l4)Then ja"",kl:j7 kl,"",pk,ph,True:pw kl,"":ja ki,pk:Else ja"",pk:j7 kl,gh,pk,"",True:pw pk,"":ja di,kl:End If:End If:Next:de kl,pk,"Toolbar":de kl,pk,"MainMenu":de kl,pk,"Tracklist":de kl,pk,"NowPlaying":If SDB.verSIoNhI>=3 Then de kl,pk,"TracklistNP":End If:If Not SDb.objectS("RegExpDialog")Is Nothing Then On Error Resume Next:If sDB.VeRSIOnbUiLD<1205 Then:Else t=SdB.oBJEcTS("mnuRegExpGroupToolbar").KEys:Do While CBoMeNu.iTEMcoUNT>UBound(t):CBOMEnU.DELeTEITeM cBOmEnu.iTemCOUNt-1:Loop:For z=1 To UBound(t):If z<=CBoMenu.iTeMCOUnt Then cBomEnu.iTEmtExT(z-1)=t(z):Else CbOmENu.AdDITem t(z):End If:If bq=t(z)Then CbOMEnu.IteMInDex=z-1:End If:Next:End If:On Error GoTo 0:End If:End If:End If:End If:End Sub:Function Choose(mi,cx):Choose=cx(mi):End Function:Sub ar(a):j2=a.CheCKEd:h3:End Sub:Function DateISO(e9):DateISO=Year(e9)&"-"&Right("0"&Month(e9),2)&"-"&Right("0"&Day(e9),2):End Function:Sub es(hu):Dim qy,ag,bz,je,fd,at:hu.eNAbled=False:qy=j9:ft=True:j9=eu:If ft Then ft=False:Else ft=True:g0=True:End If:o3.MinVAlUe=1:If j9 Then ag=sdb.PlAyER.CURREntsONGLISt.Count:Set bz=sdb.PlayER.cUrReNtSoNgLIst:Else ag=SDb.ALlVIsibLEsoNglISt.Count:Set bz=sdb.aLlvISIbleSongLiSt:End If:If ku<>Sdb.maiNtRaCKswInDow.CurRenTaddINgId Or qy<>j9 Or bn Or dd<>ag Then bn=Not bn:q0 g9:Else For at=0 To ag-1:Set fd=oSongList.Item(at):Set je=bz.Item(at):If fd.iD<>je.Id Then Exit For:End If:Next:If at<ag Then bn=Not bn:q0 g9:End If:End If:ku=Sdb.mAiNtRacKSwINDow.CuRRENTADdINGID:If qy=j9 Then dd=ag:Else dd=-1:End If:On Error Resume Next:If sDB.VErSionBuilD<1214 Then:Else If Not bn Then If j9 Then o3.Value=sdb.pLAyer.PlAYlIstFocUseD+1:Else o3.Value=sdb.MAiNTrACkSwiNDoW.FoCUsEd+1:End If:End If:End If:On Error GoTo 0:End Sub:Sub p6(a):ij=a.TeXT:h3:End Sub:Sub ah():If Not ft Then ft=True:bReplacing=True:hg True:On Error Resume Next:On Error GoTo 0:End If:ft=False:End Sub:Sub pl(r3,nj):Const hc="mnuRegExpLastExec":SdB.oBjectS("tbrRegExpExecuted").ViSiBLe=r3 And nj:SdB.OBJeCTs(hc&"Toolbar").VisIbLE=r3 And Not nj:SdB.oBjEctS(hc&"MainMenu").VIsIBlE=r3:sdB.oBJEctS(hc&"Tracklist").VisIbLe=r3:sDb.ObjecTs(hc&"NowPlaying").vISIBLE=r3:If sDB.veRSionHi>=3 Then SdB.obJECts(hc&"TracklistNP").vISIble=r3:End If:End Sub:Sub dy():Dim s:If b>i6-1 Then Exit Sub:End If:If o8 And l9 Then Exit Sub:End If:ei b+1:With c5.inteRf.document:Set s=.AlL.item("trRow"&b):If Not s Is Nothing Then s.clasSNaMe="even":End If:b=b+1:Set s=.aLl.item("trRow"&b):If Not s Is Nothing Then s.CLassNamE="select":If s.offSEtTop+s.offseTheIght>.bODY.scRoLLtOp+.BodY.OFfSetHeIgHt Then s.ScRollIntoVIEw False:End If:End If:End With:If b=2 Then b2.comMoN.eNABLEd=True:End If:End Sub:Sub oq():If k Then Exit Sub:End If:h3:If Not nt Then ac=True:End If:cr=True:l0.EnabLED=False:l0.EnablED=True:End Sub:Sub bw(a):dt=a0:a0=a.tEXT:oq:End Sub:Sub n8(a):If Not sDB.OBjeCTs("RegExpDialog")Is Nothing Then mw False:On Error Resume Next:If sDB.VErSiONbUiLD<1205 Then i4=.CHilDcOnTRol("oCboPreset").TEXt:hi=.cHiLdCONTrOL("oEdtDescript").tExt:ij=.cHIldconTroL("oEdtShortcut").TExT:j2=.childControl("oChkToolbar").CHECKeD:o2=.CHildCOntROL("oCboIcon").ITEmiNdEx-1:If o2<0 Then o2="":End If:a0=.chiLDcONTRol("oCboFindWhat").Text:qo=.cHILDCOntROl("oCboFindInto").ITeMIndeX:If qo=-1 Then qo=1:End If:fh=.ChiLDcoNTROL("oChkFindRE").CHecKED:ka=.cHildCOntrOL("oChkWholeWord").CheCKeD:d0=.CHiLDCONtroL("oCboRplcWith").teXT:mx=.CHILDcontROL("oCboRplcFrom").ITEmINdex:If mx=-1 Then mx=1:End If:jv=.chILdcONtrol("oChkRplcRE").cHeCkeD:pn=.CHIlDconTroL("oChkRplcVB").ChECkeD:oi=.cHildCONtROL("oChkMatchCase").CheCKeD:End If:On Error GoTo 0:pc 0:End If:sCripT.UnregiStEREVENTS SDB.obJEcTS("RegExpDialog"):On Error Resume Next:If sdB.vErsioNbuILD<1205 Then If SDb.VeRsioNhI=3 Then sCripT.unRegIStERalleveNTS:End If:Else sCriPT.UNreGIstERhAnDlEr"lg":SCrIpT.UnReGisTErhANdLeR"ai":End If:On Error GoTo 0:SDb.ObJeCTS("RegExpDialog").COMMON.vISiBLE=False:Set sDB.ObJeCtS("RegExpDialog")=Nothing:End Sub:Sub b8(q):Dim t,m7,c6,hw,om,f6,ow,e6,c,o,mk,n2,e3,h,at,u:Set h=sdB.InIfile:ms=h.BOOlVaLUE("RegExpOptions","ConfirmPresetUpdate"):kd=h.boOLvaLUE("RegExpOptions","ShowPresetAdjustDialog"):fq=h.INTvALuE("RegExpOptions","MaxTableRowNumber"):If q=0 Then j9=eu:Else j9=False:End If:Set oSongList=SdB.seLEcTEDsonGlist:bn=True:lSongIndex=1:m9=1:pm=1:az=pm+fq-1:If az>oSongList.Count Then az=oSongList.Count:End If:Set oSongData=oSongList.Item(lSongIndex-1):Set e6=CreateObject("Scripting.Dictionary"):For at=1 To oSongList.Count:e6.adD at,True:Next:Set sDb.oBjectS("CheckedTracks")=e6:hh=True:cs=oSongList.Count:Set r=sDB.ui.nEwFOrM:With r:.BORderStyLe=qz:With .cOmMoN:hw=.wIDTh-.ClIEnTwidtH:om=.HeigHt-.CLIENTHEiGht:.sEtReCT 100,100,705+hw,445+om:.MInwidth=600+hw:.minHEiGhT=315+om:End With:.FORmpoSItION=pv:If q=0 Then .CaptIon=ch&" / Preset Settings":Else If q>0 Then .CaPtIOn="Edit RegExp Preset":Else .CAptiOn="Add RegExp Preset":End If:End If:End With:If Len(n1)Then fa=n1:Else Select Case hw:Case 8:fa="e0dfe3":Case 16:fa="fff3ef":Case Else fa="Gainsboro":End Select:End If:f=a6:dl="<link href='"&f&"' rel='stylesheet' type='text/css'>":If Len(f)Then mk="<html><head>"&dl&"<style type='text/css'>":Else mk="<html><head><style type='text/css'>body.info {background-color: "&fa&";":If hw<>8 Then mk=mk&" border: 1px solid Silver;":Else mk=mk&ng:End If:mk=mk&" font: 12px 'Courier New' serif;} .hlreplace {color: "&by&"; background-color: "&b1&";} .hlmatch {color: "&by&"; background-color:"&q9&";} .hlrplcmtch {color: black; background-color: white;} .errexpr {color: red;} .errcrtc {color: white; background-color: red;} ":End If:mk=mk&"body {margin: 1px 2px; overflow: auto;}</style></head><body class='info'></body></html>":Set ak=sdB.UI.nEWLABeL(r):With ak:.CAPtIoN="Preset:":.commoN.SETrECt 10,14,70,17:End With:If q=0 Then oy=False:Set n=sDB.Ui.neWdRopdOwn(r):With n.cOmmOn:.AncHOrs=1+2+4:.sEtRECT 87,10,420,19:.COnTROLnAmE="oCboPreset":End With:ScRipt.reGIsterevENt n,"OnSelect","dv":ScriPT.RegIstereVenT n,"OnChange","nw":Set m7=sdB.UI.neWlaBEL(r):With m7:With .cOmMON:.Anchors=2+4:.SetREcT 518,14,30,17:End With:.cAptIOn="Move:":End With:Set mo=SDb.uI.NewSPiNEDiT(r):With mo:With .COmmoN:.ANCHOrs=2+4:.SEtrecT 553,10,21,19:.cUrsoRtypE=-2:End With:.mAXValUE=0:End With:SCriPT.REgiStEReVEnT mo,"OnChange","mz":Set c0=sDB.uI.NEwBUTton(r):With c0:With .COmMoN:.ANcHORS=2+4:.SETreCt 577,9,35,22:End With:.CaptION="New":End With:sCRipt.REGISTerEVeNT c0,"OnClick","bv":Set ma=sdB.ui.neWbUTTOn(r):With ma:With .cOmmON:.ANCHORs=2+4:.SetREct 613,9,46,22:End With:.cAptiOn="Save":End With:ScRIPT.rEgiStErEVeNt ma,"OnClick","p7":Set qk=sdB.ui.nEWbUttOn(r):With qk:With .ComMoN:.ANcHorS=2+4:.SEtrecT 660,9,35,22:End With:.CapTiOn="Del":End With:scRIPT.rEGisTerevEnT qk,"OnClick","mh":Else oy=True:Set n=SDb.ui.newedit(r):With n.CoMMON:.AnchORs=1+2+4:.SETRecT 87,10,606,19:End With:sCRIPt.ReGIsTerEVEnt n,"OnChange","nw":End If:Set m7=sdB.uI.NEWlabEl(r):With m7:.cOmMoN.SeTREcT 10,44,70,17:.cAPTioN="Description:":End With:Set r6=sDb.UI.newEdIT(r):With r6.coMmOn:.AnCHorS=1+2+4:.sEtREct 87,40,283,19:.COntrolNAMe="oEdtDescript":End With:sCRIpT.REGiStErevent r6,"OnChange","eq":Set m7=SdB.Ui.newlabEl(r):With m7:With .COMmOn:.AncHoRs=2+4:.SetreCt 383,44,45,17:End With:.CAptioN="Shortcut:":End With:Set i0=sdB.Ui.nEWEDit(r):With i0.Common:.ancHORS=2+4:.SETrECT 433,40,74,19:.cOnTrolnaME="oEdtShortcut":End With:script.REgiStereVENt i0,"OnChange","p6":Set gx=sdb.Ui.NeWcHeCKbox(r):With gx:With .cOMMOn:.aNchors=2+4:.SeTREct 518,42,95,17:.CoNTroLName="oChkToolbar":End With:.CaPTioN="Toolbar button":ScRipT.rEGisteReVent .COmMoN,"OnClick","ar":End With:Set m7=Sdb.uI.nEWLABeL(r):With m7:With .cOmmOn:.aNchoRs=2+4:.SeTRecT 626,44,25,17:End With:.CAptiOn="Icon:":End With:Set mg=sDb.Ui.nEWDRopDOwn(r):With mg:.STyLE=f2:With .coMmon:.AnChOrs=2+4:.SEtRect 656,40,37,19:.CoNtrolnAmE="oCboIcon":End With:End With:scRipT.reGIsterEvEnt mg,"OnSelect","gf":If Len(f)Then u="<html><head>"&dl&"<style type='text/css'>body {":Else u="<html><head><style type='text/css'>body.icon { font: 11px 'tahoma' 'sans-serif';":If hw<>6 Then u=u&" border: 1px solid;":Else u=u&ng:End If:End If:u=u&" margin: 2px; overflow: hidden; cursor: pointer;}</style></head><body class='icon'></body></html>":Set g2=SDb.Ui.nEwACTIVex(r,"Shell.Explorer"):With g2:With .coMmOn:.ANChOrs=2+4:.SetrECt 656,40,21,21:End With:SCriPt.regIStErEVenT .inTeRF.document,"OnClick","lg":.SetHTmLDOcUMent u:End With:Set c6=SDb.UI.NEwpaNEl(r):With c6.cOMmON:.aNCHoRs=1+2+4:.SEtrect 10,70,683,2:End With:Set m7=Sdb.Ui.NewLABEL(r):With m7:.comMON.SETrEct 10,84,70,17:.cAPTIon="Find what:":End With:Set mt=sDB.UI.newDropDOwn(r):With mt.ComMON:.ANcHORS=1+2+4:.setRECT 87,80,420,19:.CoNTrOlNAmE="oCboFindWhat":End With:SCRIPt.reGiSterEVent mt,"OnChange","bw":sCripT.rEgiStEREVenT mt,"OnSelect","al":Set m7=sdB.uI.nEwLabEL(r):With m7:With .ComMon:.ANchorS=2+4:.SeTReCt 518,84,28,17:End With:.captION="Into:":End With:Set jf=sdB.ui.NeWdRoPdOwn(r):With jf:.StYLE=f2:With .COmmOn:.aNCHORs=2+4:.sEtREct 554,80,139,19:.coNTrOLNaME="oCboFindInto":End With:End With:SCRiPt.reGISterevEnT jf,"OnSelect","d4":Set m7=SdB.uI.NEWlABEl(r):With m7:.cOmmon.setRECt 10,111,50,17:.CaPtiON="Original:":End With:Set m3=sdB.UI.nEWACtIveX(r,"Shell.Explorer"):With m3:With .COMmON:.AnChors=1+2+4:.sETrEcT 87,109,420,38:End With:.SEthTMlDoCuMEnt mk:End With:Set kw=sdb.ui.NewcHecKbOx(r):With kw:With .COmmon:.AnChors=2+4:.seTRECT 518,109,125,17:.cONtROLNAMe="oChkFindRE":End With:.CapTION="Regular expression 1":scriPT.reGIStEReVEnt .comMoN,"OnClick","h4":End With:Set m5=sdB.uI.NeWbuttoN(r):With m5:With .ComMON:.anchOrS=2+4:.SetrEcT 659,108,35,22:End With:.capTiON="Full":End With:scrIpt.REGISTEREVEnT m5,"OnClick","gw":Set nu=SdB.UI.NeWCheckBox(r):With nu:With .coMmOn:.aNcHORs=2+4:.SETrEcT 518,132,130,17:.coNTROlnAMe="oChkWholeWord":End With:.cAPtioN="Find whole words only":scrIpT.rEGisTEreVENt .COmMOn,"OnClick","fg":End With:Set m7=SDB.ui.neWLABEl(r):With m7:.commoN.SEtrEct 10,160,70,17:.CAPtIon="Replace with:":End With:Set jz=sdb.ui.newDropDOwn(r):With jz.coMMON:.aNCHORs=1+2+4:.sETreCT 87,156,420,19:.cOntROLName="oCboRplcWith":End With:SCRiPt.rEGisTereVent jz,"OnChange","h0":ScriPT.REGIsTEREVeNT jz,"OnSelect","cj":Set m7=SDb.UI.nEwlaBEl(r):With m7:.CaptiON="From:":With .cOMmon:.AncHOrs=2+4:.sETREcT 518,160,28,17:End With:End With:Set h2=sdb.ui.nEwBUTTON(r):With h2:With .COMMON:.anChorS=2+4:.setREct 517,155,28,22:End With:.CapTioN="<<":End With:sCRIPT.REgISTEreVeNT h2,"OnClick","jd":Set ps=sDB.Ui.NEwdrOPdoWN(r):With ps:.sTyLE=f2:With .coMMON:.anCHORs=2+4:.SETreCT 554,156,139,19:.ContROlnAMe="oCboRplcFrom":End With:End With:ScRiPT.reGiSterEVent ps,"OnSelect","q6":Set m7=SdB.Ui.NEWLabeL(r):With m7:.coMmOn.SetrEct 10,187,70,17:.CaPTIon="Replacement:":End With:Set hf=SDb.UI.newACTiVEx(r,"Shell.Explorer"):With hf:With .COMmOn:.aNChORs=1+2+4:.sEtrecT 87,185,420,38:End With:.sethtmldoCUMeNt mk:End With:Set gb=sDb.uI.NewCHeCKbOX(r):With gb:With .comMoN:.ANcHORs=2+4:.SeTrECT 518,185,125,17:.CONTrOlnaME="oChkRplcRE":End With:.CAptIon="Regular expression 2":SCRipT.ReGIsTerEVEnT .COmMON,"OnClick","ko":End With:Set gn=sdb.UI.NEWBUTton(r):With gn:With .cOmMON:.ANchOrs=2+4:.setREcT 659,184,35,22:End With:.capTioN="Full":End With:SCRIPT.REgistERevEnt gn,"OnClick","ml":Set qg=sdb.Ui.nEWcHECKBOx(r):With qg:With .comMon:.ANChORs=2+4:.sEtreCT 518,208,125,17:.COnTrOLnAmE="oChkRplcVB":End With:.capTiOn="VBScript expression":sCriPt.rEGistEReVeNt .coMMon,"OnClick","d9":End With:Set m7=SDb.uI.NEwLAbEl(r):With m7:.CommON.SeTREct 10,235,50,17:.cAPtiON="Result:":End With:Set ax=SdB.ui.NEwActivex(r,"Shell.Explorer"):With ax:With .ComMoN:.AncHorS=1+2+4:.SeTreCt 87,233,420,38:End With:.setHtMldOCuMent mk:End With:Set a8=Sdb.uI.NEWchEcKBoX(r):With a8:With .ComMON:.aNChorS=2+4:.SetrecT 518,232,80,17:.CONtRoLnaMe="oChkMatchCase":End With:.caPtioN="Match case":SCrIpt.REGIsterEvENt .CoMmON,"OnClick","cz":End With:Set ks=sDb.UI.NewcHEcKBoX(r):With ks:With .cOmMon:.ANCHOrS=2+4:.SEtreCT 518,255,150,17:End With:.CApTion="Backward search direction":SCrIpt.REGisTeReVEnT .cOmMoN,"OnClick","nl":End With:If Len(f)Then u="<html><head>"&dl:Else u="<html><head><style type='text/css'>body.tbl {margin: 2px;}</style>":End If:u=u&"</head><body class='tbl'></body></html>":Set jb=SdB.uI.NEwACtIvEX(r,"Shell.Explorer"):With jb:With .cOMmon:.ANcHoRs=1+2+4+8:.SETrect 10,280,684,122:End With:.SEThtmlDocumeNT u:scRipT.rEGIsterEVeNT .iNTeRf.Document,"OnClick","ai":End With:nt=True:Set nk=sdB.UI.nEWButtoN(r):With nk:With .cOmMon:.ANChORS=1+8:.sETREct 10,413,22,23:End With:.CaptiOn="?":End With:SCrIPt.rEGiSTEReVeNT nk,"OnClick","j5":Set cc=sDB.UI.newBUtTON(r):With cc:With .CoMmOn:.ANCHOrS=1+8:.SEtREct 40,413,22,23:.EnabLeD=False:End With:.caPTiON="|<":End With:scriPT.reGiSteREvent cc,"OnClick","e2":Set fz=sdb.Ui.NeWButtOn(r):With fz:With .coMmon:.AnChORS=1+8:.SETrect 70,413,22,23:If oSongList.Count<2 Then .enAblED=False:End If:End With:.cAPTiON=">|":End With:SCRiPt.REGIsTeReVENt fz,"OnClick","iv":Set o3=Sdb.ui.NEwSPiNeDIt(r):With o3:With .COmmOn:.AnchoRS=1+8:.setReCt 100,414,53,19:End With:.mINvALuE=1:.mAxvalUe=oSongList.Count:ScRipT.REgiStERevEnT .cOmmon,"OnKeyUp","gg":End With:scrIpt.RegISTeRevEnt o3,"OnChange","io":Set m7=sDB.UI.NEWLaBeL(r):With m7:With .cOmmoN:.aNChoRS=1+8:.SeTreCT 157,417,10,17:End With:.CapTIOn="/":End With:Set c6=SDB.UI.nEwPaNel(r):With c6.COmMon:.aNChorS=1+8:.SEtrecT 163,413,75,23:End With:Set g9=sDB.Ui.neWlabel(c6):With g9:With .coMMon:.Setrect 6,5,62,17:.cursORType=-21:End With:.aUToSiZe=False:ScrIPt.RegiSTereVEnT .cOmMOn,"OnClick","q0":End With:q2:Set f8=SDB.uI.nEwBUtTon(r):f8.CaptioN="&Find Next":ScRIpT.REgiSTerEVeNt f8,"OnClick","qw":e3=Not h.bOOlVALue("RegExpOptions","ModelessWindow")Or(q>0):If q=0 Then With f8:If nz()>=204 Then .Default=True:End If:With .COMMon:.AncHoRS=4+8:.SeTREcT 270,413,73,23:End With:End With:Set ny=sdb.Ui.NewbUttOn(r):With ny:With .comMOn:.aNchors=4+8:.setReCt 351,413,73,23:End With:.CapTIoN="&Replace":End With:scRIpT.regisTerevenT ny,"OnClick","px":Set qq=Sdb.uI.NEWbuttON(r):With qq:With .CoMmoN:.ancHOrS=4+8:.SetREcT 432,413,73,23:End With:.capTioN="Replace &All":End With:scrIpT.rEGiSTerEvenT qq,"OnClick","ah":Set pe=sDb.uI.NewdROpDoWn(r):With pe:.STylE=f2:With .CoMMoN:.anChoRS=4+8:.SetRECT 513,414,100,19:End With:.aDDITEm"Keep matched":.aDdITEm"Keep unmatched":.addiTEM"Keep to replace":On Error Resume Next:n2=SdB.PLaYER.PLaYlISTSelECTEd(0):If Err Then n2=False:Else n2=True:End If:On Error GoTo 0:If nz()>=300 And Not j9 Or n2 Then .ADDITeM"Select matched":.Additem"Select unmatched":.ADdItEM"Select to replace":End If:at=h.InTVAluE("RegExpOptions","SelectKeepMode"):If IsNumeric(at)Then If CLng(at)<.ITEmCoUNT Then bl=at:End If:End If:.ITeMiNDEx=bl:End With:scriPt.registerEvEnt pe,"OnSelect","jn":Set q3=Sdb.ui.neWbuTtoN(r):With q3:With .CoMMOn:.ANChORs=4+8:.sEtRecT 513,413,85,23:End With:.mOdAlReSulT=1:End With:dj:If Not e3 Then ScrIpT.REGIstErevenT q3,"OnClick","bm":End If:Else With f8.ComMOn:.anCHoRS=1+8:.sETreCt 246,413,73,23:End With:Set ma=sdb.UI.neWBUtTOn(r):With ma:With .CoMMoN:.AncHorS=4+8:.seTRECT 540,413,73,23:End With:.capTION="&OK":If nz()>=204 Then .Default=True:End If:.mOdAlrEsuLt=1:End With:End If:Set lk=sdB.Ui.NewButtON(r):With lk:With .COmMOn:.ancHOrs=4+8:.SEtrecT 621,413,73,23:End With:If q=0 Then .CAPtIon="&Close":Else .CaptiON="&Cancel":End If:If nz()>=204 Then .cANcEL=True:End If:.ModaLRESUlT=2:If Not e3 Then sCRIPT.REGisTErEVEnT .COmMOn,"OnClick","dh":End If:End With:bReplacing=False:On Error Resume Next:If SDB.veRSiOnBuiLD<1218 Then:Else If Not e3 Then SCrIPT.ReGisteReVent sDb,"OnOptionsChange","le":End If:Call pt(h):End If:On Error GoTo 0:k=True:Set l0=SdB.crEAteTImeR(200):scripT.ReGisTEREVeNt l0,"OnTimer","bx":If oSongList.Count>0 Then o3.Value=1:Else o3.Value=0:End If:f9:t=c4.keyS:For at=0 To c4.Count-1:u=bh(t(at)):jf.AdDITEm u:ps.AddITeM u:Next:mg.ADdITEm"":For at=0 To 75:mg.addIteM at:Next:If q=0 Then y=-1:at=1:c=q8(0):If Len(c)Then l6 0:End If:Do:u=q8(at):If Len(u)Then ra u:o=l(u,"Name"):If iq=o And Not ci Then y=at-1:End If:If Len(o)Then n.ADDITeM o:at=at+1:Else Exit Do:End If:Else Exit Do:End If:Loop:n.ItEMiNdex=y:If y>-1 Then mo.mINVAluE=1-n.iTemCount:dv n:Else ra c:dr:qb:li:End If:Else y=q-1:l6 q:End If:For at=dn To 1 Step-1:u=hm("FindWhat"&at):If Len(u)Then mt.AdDiteM u:If u=mt.TeXt Then mt.iTEminDex=f6:End If:f6=f6+1:End If:u=hm("RplcWhere"&at):If Len(u)Then jz.ADdITEM u:If u=jz.Text Then jz.itemiNdex=ow:End If:ow=ow+1:End If:Next:it:lb:nt=False:k=False:ap=False:oq:ft=False:Set og=Sdb.mAinTrEe.currenTNOde:r.sAvEPoSitiONNAmE=ch:If e3 Then If r.SHOWMoDaL=1 Then If q>0 Then p7:Else bm:End If:End If:pc 0:SCRipT.UNrEgistEreVeNTS r:If q=0 Then On Error Resume Next:scripT.UNregISterALlevENtS:If SDB.VeRsionBUILD<1218 Then:Else scRIpt.REGIsteREVeNT sdb,"OnOptionsChange","le":End If:On Error GoTo 0:End If:If c8.Count Then c8.remoVEall:End If:Else sDb.OBjECTS("RegExpDialog")=r:If h.bOolVaLUE("RegExpOptions","SynchronizedTracks")Then jm:End If:scripT.reGiStEreVeNt sDB,"OnTrackProperties","g8":ScRIPT.RegiStEREVeNT r,"OnClose","n8":mw True:r.stayoNtoP=True:r.COMMon.visIble=True:End If:End Sub:Function lr(a0,ir):Dim fx,cu,ju,at,u:If ir Then fx="RplcWhere":Else fx="FindWhat":End If:cu=0:For at=1 To dn:u=hm(fx&at):If u=a0 Then lr=False:Exit Function:Else If Len(u)=0 And Not ju Then cu=at:ju=True:End If:End If:Next:If cu=0 Then For at=1 To dn-1:u=hm(fx&at+1):no fx&at,u:Next:cu=dn:End If:no fx&cu,a0:lr=True:End Function:Sub ca(mj,ek,mn,el):If mj=0 Then i1=0:jw=0:g1=False:If hs.EnAbled Then hs.enABLeD=False:End If:If b=1 And nm Then b2.COMmon.eNaBlEd=False:Else If b=i6 And Not nm Then bk.commON.enaBled=False:End If:End If:End If:End Sub:Function bp(g):Dim nr,i7,hx:hx=k6(a0,fh):If fh Then nr=Len(ep(g,hx)):Else If ka Then nr=Len(ep(g,"\b"&hx&"\b")):Else If oi Then i7=0:Else i7=1:End If:nr=InStr(1,g,hx,i7):End If:End If:If nr=0 Then bp=False:Else bp=True:End If:End Function:Sub bd(a):o8=False:n4.COmMoN.eNAblEd=False:pp.cOmmoN.EnAblED=False:a3:If Not k Then fv:r9.COmmON.EnAblEd=(ob>0 And(o8 Imp Not l9)):qm.CoMmOn.EnaBlED=(ob>0):End If:dw.coMmON.eNAbLEd=False:End Sub:Function Min(gp,j0):If CLng(gp)<CLng(j0)Then Min=gp:Else Min=j0:End If:End Function:Function mv(kq):Dim t:t=c4.kEyS:mv=c4.Item(t(kq)):If Not ht.exists(t(kq))Then mv="oSongData."&mv:End If:End Function:Sub ja(c,n9):Dim o,bs,d5,lf,p:If Len(c)Then et c,o,bs:d5=l(c,"Description"):lf=l(c,"Shortcut"):Else o="":bs=-1:d5="":lf="":End If:p=oj:df p,o,d5,bs,lf,"Toolbar":df p,o,d5,bs,lf,"MainMenu":df p,o,d5,bs,lf,"Tracklist":df p,o,d5,bs,lf,"NowPlaying":If SDb.VErSIOnHi>=3 Then df p,o,d5,bs,lf,"TracklistNP":End If:End Sub:Sub hj(l7):Dim ab:If Not sdb.ObjEctS("RegExpDialog")Is Nothing Then ab=SdB.OBjECTS("tbrRegExpReplaceDialog").cHeCked:n8 Nothing:If ab Then Exit Sub:End If:End If:b8 0:End Sub:Function MapChr(ji,jq):If Len(ji)>0 Then If VarType(jq)=vbInteger Then MapChr=ChrW(jq):Else MapChr=jq:End If:End If:End Function:Sub jd():Dim dp:If Not oSongData Is Nothing Then dp=mv(mx):On Error Resume Next:With jz:.TexT=Left(.texT,.sELstaRt)&dp&Mid(.TeXt,.selsTART+.SeLLengtH+1):If Err Then If Len(.tExt)>0 And Right(.teXT,1)<>" "Then dp=" "&dp:End If:.TeXt=.TEXt&dp:End If:End With:End If:End Sub:Function SetVar(qj,nh):If VarType(qj)=vbInteger Then If UBound(kt)<qj Then ReDim Preserve kt(qj):End If:kt(qj)=nh:Else If ip.eXisTs(qj)Then ip.Item(qj)=nh:Else ip.ADD qj,nh:End If:End If:SetVar=nh:End Function:Sub cq(q):SDb.iniFile.DeLETeKey"RegExpPresets","Preset"&q:End Sub:Sub gc(ox):If Len(eo)Then viEwEVent"RegExp",ox:End If:End Sub:Sub l6(q):Dim c:c=q8(q):i4=l(c,"Name"):ra c:r8:If c8.Count Then c8.reMoVEALl:End If:End Sub:Sub bf(hu):hu.EnaBLed=False:SdB.curSortYPe=-11:sdb.PROcessmESsAgEs:fv:sDB.CursORtype=0:SDb.pROCEsSmeSsaGES:End Sub:Sub de(kl,pk,gi):Dim dq:With SDB.objeCtS("mnuRegExpGroup"&gi):dq=.Item(pk).CAptiOn:.Item(pk).CapTION=.Item(kl).cApTIOn:.Item(kl).capTioN=dq:dq="ZD"&Now:.kEy(pk)=dq:.key(kl)=pk:.kEy(dq)=kl:End With:End Sub:Sub g4(a):a.coMmon.PaRent.cOmMoN.ChIlDContROl("LastPresetOnStartup").ComMON.ENABlED=a.CHECKED:End Sub:Function cm(kq):Dim t,dp:If Not oSongData Is Nothing Then t=c4.keYs:dp=c4.Item(t(kq)):If Not ht.eXisTS(t(kq))Then dp="oSongData."&dp:End If:cm=Eval(dp):End If:End Function:Sub pi(qx,n9,o,lz):Dim w,x,m,z,e,q,c,ev:If qx=Sdb.iniFilE.inTvaLUe("RegExpOptions","LastExecutedPreset")Then pl False,False:End If:pw n9,o:ev=0:Set w=New RegExp:w.IgnoreCase=True:w.Pattern="^Preset(\d+) ?=.*Name: ?""((?:""""|[^""])*)""":Set m=SDb.INIFIle.keYS("RegExpPresets"):For z=0 To m.Count-1:e=m.Item(z):If w.Test(e)Then Set x=w.Execute(e):q=Int(x.Item(0).SubMatches.Item(0)):If q>qx Then c=LTrim(Mid(e,InStr(e,"=")+1)):ae q-1,c:End If:If ev<q Then ev=q:End If:End If:Next:If ev Then cq ev:End If:ho:If lz Then n.dElETEiTEm qx-1:mo.miNvalUe=1-n.iteMcOunt:If y=qx-1 Then If y>=n.ITEMcounT Then y=n.iTEmcOunT-1:End If:n.ItemindEX=y:dv n:Else If y>qx-1 Then y=y-1:End If:n.iTeMINDex=y:dx=y:qb:h3:k=True:mo.Value=-y:k=False:li:End If:End If:End Sub:Sub mw(ab):sDb.ObjecTs("tbrRegExpReplaceDialog").chECKED=ab:Sdb.ObJEctS("mnuRegExpFindRplcToolbar").CHeckEd=ab:sDb.oBJEcTs("mnuRegExpFindRplcMainMenu").cHEcKed=ab:SdB.ObjEctS("mnuRegExpFindRplcTracklist").cheCkED=ab:sDB.objECtS("mnuRegExpFindRplcNowPlaying").chECked=ab:If Sdb.VErSIonHI>=3 Then sDb.oBjects("mnuRegExpFindRplcTracklistNP").chECKeD=ab:End If:End Sub:Function dg(ox):dg=Chr(34)&Replace(ox,Chr(34),Chr(34)&Chr(34))&Chr(34):End Function:Sub p7():Const hc="mnuRegExpPreset":Dim q,c,o,oz,a2,t,lx,ea,cw,w,x,m,z,e,qx,lo,p,bu,jj,ik,oo,at,u:q=-1:If ci Then If iq<>i4 Then at=1:Do:c=q8(at):If Len(c)Then o=l(c,"Name"):If Len(o)Then If i4=o Then If ms Then If Sdb.messAgEbOX("There already exists preset #"&at&" with the same name:"&vbCr&o&vbCr&vbCr&"Do you want to update the existing preset?",MtwaRnInG,Array(mBYes,MBno))<>MRYES Then Exit Sub:End If:End If:q=at:Exit Do:End If:at=at+1:Else Exit Do:End If:Else Exit Do:End If:Loop:If Not oy Then If q=-1 Then n.aDDITEm i4:q=n.iTEMCouNT:mo.mInValUE=1-n.itEmcOunt:k=True:mo.Value=1-q:k=False:End If:y=q-1:n.IteMindeX=y:qb:li:Else If q=-1 Then q=y+1:End If:End If:Else If ms Then If Sdb.MEsSaGEbOx("Are you sure that you want to update the preset:"&vbCr&i4&"?",MtCONFirMaTioN,Array(mByEs,mbnO))<>MRyes Then Exit Sub:End If:End If:q=y+1:End If:Else If iq<>i4 Then q=y+1:If Not oy Then n.itEMTexT(y)=i4:End If:If Len(bq)Then p=bq:Else p=oj:End If:lx=p&"\"&iq:ea=p&"\"&i4:o=Replace(i4,"&","&&"):With SdB.oBJeCtS(hc&"Toolbar"):.key(lx)=ea:.Item(ea).CAPTIOn=o:End With:With sdb.OBjeCtS(hc&"MainMenu"):.Key(lx)=ea:.Item(ea).CApTIon=o:End With:With sdB.obJECtS(hc&"Tracklist"):.keY(lx)=ea:.Item(ea).CAPtIon=o:End With:With SDb.OBJECTs(hc&"NowPlaying"):.KEy(lx)=ea:.Item(ea).cApTioN=o:End With:If SdB.vERSIoNhi>=3 Then With SDb.OBjEctS(hc&"TracklistNP"):.KEY(lx)=ea:.Item(ea).caption=o:End With:End If:oo=SDB.iniFILe.iNTVAluE("RegExpOptions","TrimToolbarCaption"):o=Left(i4,oo):If Len(i4)>CLng(oo)Then o=o&".":End If:o=Replace(o,"&","&&"):ik=1:Do While Not sDb.oBJEcTs("tbbRegExpButton"&ik)Is Nothing:If Sdb.oBjECtS("tbbRegExpButton"&ik).HinT=iq Then sdb.oBJECTS("tbbRegExpButton"&ik).hINt=i4:sdb.ObJectS("tbbRegExpButton"&ik).CaPtIOn=o:Exit Do:End If:ik=ik+1:Loop:Else Exit Sub:End If:End If:pc q:c=q8(q):If j2<>p1 Then ho:End If:a2=sdB.InifiLe.InTvalue("RegExpOptions","LastExecutedPreset"):If a2=0 Then a2=1:End If:If q=a2 Then kg c:End If:kd=sDB.iNiFIlE.BoOLVaLUE("RegExpOptions","ShowPresetAdjustDialog"):ja c,bq:hp:If Not oy Then h3:End If:End Sub:Sub i8():ku=0:If sDB.VERSIOnbuILd>=1251 Then aw:End If:End Sub:Sub cy(oe,g,sAfter):Dim s:Set s=jb.interf.document.All.item("tdBefore"&oe):If Not s Is Nothing Then s.InNerhTMl=pf(g):Set s=jb.intERf.document.ALl.item("tdAfter"&oe):s.BgCoLor="":If sAfter=eb Then s.INnerHTML="<div class='errexpr'>"&sAfter&"</div>":Else If sAfter=q7 Then s.innerHtmL="<div class='errcrtc'>"&sAfter&"</div>":Else If CStr(sAfter)<>CStr(g)Then s.ClaSsname="hlreplace":Else s.ClaSsnamE="":End If:s.InneRhtmL=pf(sAfter):End If:End If:End If:End Sub:Function am(pm,az,m6,sAfter,bj):Dim g,n3,iu,e0:n3=sAfter:For lSongIndex=pm To az:Set e0=oSongList.Item(lSongIndex-1):Set oSongData=e0.geTcOpY:iu=iu&"<tr id='trRow"&lSongIndex&"'":If(lSongIndex/2)=(lSongIndex\2)Then iu=iu&" class='odd'":Else iu=iu&" class='even'":End If:iu=iu&"><td><input type='checkbox' name='chk"&lSongIndex&"' ":If SDB.objects("CheckedTracks").Item(lSongIndex)Then iu=iu&"checked ":End If:g=cm(qo):iu=iu&"/><td id='tdNumber"&lSongIndex&"' OnMouseOver='NumOver("&lSongIndex&")' OnMouseOut='NumOut("&lSongIndex&")'>"&lSongIndex&"</td><td id='tdBefore"&lSongIndex&"'>"&pf(g)&"</td><td id='tdAfter"&lSongIndex&"'":If bj Then If n3<>q7 Then If m9<>lSongIndex Then n3=r2(g):Else n3=sAfter:End If:End If:If n3=eb Or IsNull(n3)Then iu=iu&"><div class='errexpr'>"&n3&"</div></td>":Else If n3=q7 Then iu=iu&"><div class='errcrtc'>"&n3&"</div></td>":Else If CStr(n3)<>CStr(g)Then iu=iu&" class='hlreplace'":End If:iu=iu&">"&pf(n3)&"</td>":End If:End If:Else iu=iu&" class='solving'>"&kb&"</td>":End If:If Not m6 Then iu=iu&"<td>"&pf(oSongData.PaTH)&"</td>":End If:iu=iu&"</tr>":SDB.prOCeSSmESsaGes:If cr=True Then iu="":Exit For:End If:Next:lSongIndex=m9:am=iu:End Function:Function fp():fp=False:If Not k Then If ci Then Select Case Sdb.mESSaGeBoX("You have modified the preset #"&y+1&IIf(y=-1,".",":"&vbCr&iq)&vbCr&vbCr&"Do you want to save it?",MTwARNInG,Array(MBYes,Mbno,mBCAncEL)):Case mRyES:p7:Case mRnO:Case Else fp=True:End Select:End If:End If:End Function:Sub ll():Dim h,c,q,lz,at:If o8 And l9 Then Exit Sub:End If:If b>0 Then at=1:Else at=ob:End If:If SDB.MessAgeboX("Are you sure you that want to delete "&at&" selected"&vbCr&"RegExp preset"&IIf(at<>1,"s","")&" from "&IIf(Not o8,"MediaMonkey.ini","specified")&" file?",mtcoNFIrmaTion,Array(mbYEs,MBNo))=mrNO Then Exit Sub:End If:If o8 Then Set h=SDB.tooLS.InifILebypAth(ok):If h Is Nothing Then Exit Sub:End If:End If:If b>0 Then q=b:If o8 Then Do:c=h.sTRIngVALUe("RegExpPresets","Preset"&q+1):If Len(c)Then h.StRiNGVALuE("RegExpPresets","Preset"&q)=c:Else Exit Do:End If:q=q+1:Loop:h.DeLeTeKey"RegExpPresets","Preset"&q:Else c=q8(q):lz=False:If Not Sdb.OBjecTs("RegExpDialog")Is Nothing Then On Error Resume Next:If SDB.vERsIONbuilD<1205 Then:Else lz=True:End If:On Error GoTo 0:End If:pi q,l(c,"Menu"),l(c,"Name"),lz:End If:Else ql h,False:End If:fv:End Sub:Sub nd(l7):Dim a2:a2=kx(Replace(l7.caption,"&&","&")):If a2>0 Then sdb.iNifile.intVAlue("RegExpOptions","LastExecutedPreset")=a2:pl True,SDb.INIFIle.BOOlVaLUE("RegExpOptions","ShowLastPresetButton"):kg q8(a2):End If:End Sub:Sub jh():Dim gk,h,ni,gq:With sDB.coMMoNdIAlOg:.DeFaulTexT="ini":.Filter="RegExp Ini file (*.ini)|*.ini|All files (*.*)|*.*":.FlaGs=CDLofnHiDeREaDonlY:.iNitDIR=Left(scripT.scrIpTpATH,InStrRev(ScRiPT.ScRIPTPAtH,"\")):.TiTLE="Specify file for export of RegExp presets":.showsaVe:If .OK Then gk=.filEName:Else Exit Sub:End If:End With:Set h=sDb.tOoLS.INIfilebyPATH(gk):If Not h Is Nothing Then ni=CLng(ha(h,True,False)):If ni Then gq="Exported "&ni&" preset"&IIf(ni>1,"s",""):Else gq="None preset is exported":End If:sDb.meSsAgEbox gq&" to the specified file.",mTinFORMAtIon,Array(MBOK):End If:End Sub:Sub e2():Dim la:la=m9-fq:If la>0 Then o3.Value=la:Else o3.Value=1:End If:End Sub:Function ih(o,h7,i9):Dim jg,k1:jg=bh(h7):k1=bh(i9):ih=Replace(o,"<From Field>","<"&k1&">",1,-1,1):ih=Replace(ih,"<Into Field>","<"&jg&">",1,-1,1):If Right(ih,3)="..."Then ih=Left(ih,Len(ih)-3):End If:End Function:Sub d2(qv,ek):If p8 Then p8=False:If hs.ENablED Then hs.ENABLED=False:End If:If b=1 And nm Then b2.CoMMoN.ENaBlED=False:Else If b=i6 And Not nm Then bk.coMmON.enaBLed=False:End If:End If:End If:End Sub:Sub iz(go):Dim a,da,h:Set a=sDB.uI.neWLaBEl(go):With a:.aliGNMENT=1:With .COmmon:.aNchorS=2+4:.SeTreCt go.commON.CliEntwIdTh-100,0,100,20:On Error Resume Next:.FONTcolor=&hfF0000:.fONTunDerLInE=True:On Error GoTo 0:.cuRSOrtYpE=-21:.Hint=p5:End With:.AUTosize=True:.CApTION="v"&kn&" ":ScRIpt.ReGistEreveNT .CoMmoN,"OnClick","n0":End With:Set h=SDB.iNIfILE:Set a=sdb.uI.nEWCHeckbox(go):With a:.comMON.seTreCT 10,10,430,20:.CoMmOn.CoNTROLName="ConfirmPresetUpdate":.captIoN="Confirm update/delete of the preset selected in the Find && Replace dialog box":.ChEckEd=h.boOLvAluE("RegExpOptions","ConfirmPresetUpdate"):End With:Set a=SDb.ui.NEWCHeCkbOx(go):With a:.coMMOn.SeTRect 10,35,400,20:.COMMon.coNtroLNAMe="ConfirmPresetExecute":.cApTiOn="Confirm execution of the preset selected in the menu or toolbar":.cHECkEd=h.BOolvAlUE("RegExpOptions","ConfirmPresetExecute"):End With:Set a=sDb.Ui.NewchEckbOX(go):With a:.coMMON.SETrEct 10,60,400,20:.cOmMOn.cONtRoLNAME="ShowPresetAdjustDialog":.Caption="Show dialog box for adjusting of the preset selected in the menu or toolbar":.cHeCKeD=h.BoOLVALUe("RegExpOptions","ShowPresetAdjustDialog"):End With:Set a=sdb.UI.nEWcHeckboX(go):With a:.cOMMon.setreCt 10,85,430,20:.commoN.cOnTROLnamE="DeleteEmptiedFolders":.CapTion="Delete emptied folders when moving files as a result of the Path modification":.ChEckeD=h.booLvALUe("RegExpOptions","DeleteEmptiedFolders"):End With:Set a=sDb.Ui.NewlaBEL(go):With a:.cOmmon.setReCT 10,113,200,17:.cAPTioN="Maximal number of table rows in the Find && Replace dialog box:":End With:Set a=sdB.uI.nEwsPINEDIt(go):With a:.comMON.SETREct 340,110,50,19:.mInVALue=1:.maXvALuE=100:.Common.coNTRolnAme="MaxTableRowNumber":.Value=h.iNTvALuE("RegExpOptions","MaxTableRowNumber"):End With:Set a=SdB.UI.NeWlaBEl(go):With a:.commON.sEtreCt 10,138,200,17:.CAPtioN="Trim toolbar button's caption (maximal number of characters):":End With:Set a=sdb.ui.nEWSPINeDIT(go):With a:.COmMOn.SEtRECt 340,135,50,19:.mINvAlUe=1:.mAxVALue=100:.ComMoN.coNtROlnAME="TrimToolbarCaption":.Value=h.inTVALue("RegExpOptions","TrimToolbarCaption"):End With:Set a=SDB.Ui.newcHeckbOX(go):With a:.cOMMOn.sEtreCt 10,160,400,20:.coMMON.ConTrOlnaME="ShowFindReplaceButton":.cAPTiON="Show the toolbar button for the Find && Replace dialog box":.cHeCkED=h.bOOlvALue("RegExpOptions","ShowFindReplaceButton"):End With:Set a=SDb.uI.NewChECkBOx(go):With a:.commoN.SetRECt 10,185,400,20:.coMmOn.CONTROLnAmE="ShowPresetsButton":.CapTIOn="Show the toolbar button for the Presets dropdown list":.cHeCKeD=h.BooLvaLue("RegExpOptions","ShowPresetsButton"):End With:Set da=sdB.UI.newchEcKBOX(go):With da:.cOMMoN.setrEct 10,210,380,20:.coMMon.cONtRoLnAmE="ShowLastPresetButton":.cApTIOn="Show the toolbar button for the last executed preset from the menu list":.ChecKEd=h.booLvAlUE("RegExpOptions","ShowLastPresetButton"):SCrIpt.ReGiSTeREveNt .cOmmoN,"OnClick","g4":End With:Set a=SDb.uI.nEWchEckBOx(go):With a:.cOMMOn.setrECT 30,235,360,20:.cOMmON.coNtrOlname="LastPresetOnStartup":.cAptiOn="Keep the toolbar button for the last executed preset after restart":.CHEcKEd=h.BooLvAlUE("RegExpOptions","LastPresetOnStartup"):End With:g4 da:Set a=sdb.UI.NeWChECKBoX(go):With a:.cOMMoN.sEtReCt 10,260,420,20:.cOMmon.cONtROlnAMe="ShowToolbarButtons":.CAptIoN="Show toolbar buttons for presets with enabled button in Find && Replace dialog box":.CHEcKED=h.BOolvAluE("RegExpOptions","ShowToolbarButtons"):End With:Set da=sDb.uI.nEWCHeckbox(go):With da:.CommON.seTRecT 10,285,420,20:.coMmon.coNTrOlNAme="ModelessWindow":.CApTIoN="Modeless Find && Replace dialog box (allowed access to other parts of the program)":.CHEcKed=h.boOLValUe("RegExpOptions","ModelessWindow"):sCriPt.RegISteRevEnT .commOn,"OnClick","i5":End With:Set a=sDb.uI.NewChEcKboX(go):With a:.COmmON.SEtrEcT 30,310,400,20:.COmMoN.ContROLnAme="SynchronizedTracks":.cApTioN="Display of tracks in Find && Replace dialog box synchronized with main window":.ChECkeD=h.booLvAlUE("RegExpOptions","SynchronizedTracks"):End With:i5 da:End Sub:Sub nx(l7):Dim oa,ct,hq,a,nc,hw,om,gr,h:If Not SDb.obJects("RegExpDialog")Is Nothing Then On Error Resume Next:If SDb.vERsiOnBUIlD<1205 Then n8 Nothing:End If:On Error GoTo 0:End If:Set h=SDB.iNIfiLe:Set oa=SDB.ui.nEWFOrM:With oa:.BordErStYle=qz:With .cOMMON:hw=.WIDTh-.CliENtWIdTH:om=.HeigHT-.ClieNThEIGHT:.sETRECt 100,100,485+hw,265+om:.mINwidTh=450:.minhEIgHT=160:End With:.foRmpoSItIon=pv:.CAptIoN="Manage RegExp Presets":End With:Set a=sdb.ui.nEwLabEl(oa):With a:.cOMmoN.SetReCT 10,12,40,17:.CaptIoN="Presets from:":End With:Set ct=sDB.Ui.NEwRADIObUTTOn(oa):With ct:.CaPtIon="MediaMonkey.ini":.cOmMoN.SeTReCT 82,10,100,17:sCrIPT.RegiStereVENt .commOn,"OnClick","bd":End With:Set hq=Sdb.ui.nEwRaDIoBuTTon(oa):With hq:.caPtIoN=sdb.locAlIZE("File:"):.CoMMoN.seTREcT 195,10,40,17:scRIpt.ReGISterEvEnt .COMMon,"OnClick","lh":End With:Set n4=SDB.Ui.NEwedIT(oa):With n4.COmmOn:.SEtrECt 240,8,213,19:.anCHors=1+2+4:End With:ScrIpt.REGIsterEveNT n4,"OnChange","pg":Set pp=SdB.UI.NewbUTtON(oa):With pp:.CaptIon="...":With .COmMOn:.setrecT 453,8,21,21:.ANChOrS=2+4:End With:End With:ScRiPT.REgIsTereVent pp,"OnClick","ic":gr=False:On Error Resume Next:gr=(sDb.vERSIOnbuIld>=1220):On Error GoTo 0:Set c5=Sdb.Ui.nEWacTiVEX(oa,"Shell.Explorer"):With c5:With .CoMmoN:.setrEct 10,38,465,190:.ANcHORS=1+2+4+8:End With:SCrIpT.rEgisTerEveNT .inTeRf.document,"OnClick","mb":End With:Set b2=sDB.uI.newbUTToN(oa):With b2:.caPTIoN=sdB.LOcalize("&Up"):With .COMMon:.sETrEct 10,234,35,24:.AnCHOrs=1+8:.ENABLeD=False:End With:If gr Then scRipt.rEgisteREVeNt .cOmMoN,"OnMouseDown","qs":scripT.REGIStereveNt .cOmMOn,"OnMouseUp","ca":sCrIpt.ReGistErEveNT .COmmoN,"OnMouseMove","f7":ScRipt.rEGISTerEveNT .CommOn,"OnKeyDown","ge":sCRiPt.RegIsterevent .cOMMON,"OnKeyUp","d2":End If:End With:SCRIpT.ReGiSteReveNt b2,"OnClick","k7":Set bk=SDB.Ui.NEwbutTON(oa):With bk:.caPTiOn=Sdb.LocalIzE("D&own"):With .COmmon:.sETReCT 52,234,35,24:.AnchorS=1+8:.eNABLED=False:End With:If gr Then SCRIPt.rEgIStErEvenT .CoMMOn,"OnMouseDown","h5":SCrIPT.reGIsteREVENT .cOmmoN,"OnMouseUp","ca":SCRiPT.ReGisteReVEnt .COMMon,"OnMouseMove","f7":sCriPt.reGisTERevent .cOmmOn,"OnKeyDown","mm":SCrIpT.ReGiStEREVenT .COMMon,"OnKeyUp","d2":End If:End With:SCRIpT.ReGisTErEvent bk,"OnClick","ig":Set r9=sDb.Ui.newbUTToN(oa):With r9:.cAPTiOn="&Del":With .CoMMON:.SEtrecT 94,234,35,24:.ANchORs=1+8:.EnAbLED=False:End With:End With:ScrIpT.RegistEreVENt r9,"OnClick","ll":Set np=SDb.Ui.newLAbEL(oa):With np:With .ComMon:.SETRECt 140,239,40,17:.anchOrs=1+8:End With:.AUTosIZe=False:.AliGnmENt=2:End With:eg=h.BoOlvAluE("RegExpOptions","TableWordWrap"):Set nv=sdB.Ui.NeWCheCKboX(oa):With nv:.CaPTiOn=sdb.localiZE("Word wrap"):With .COmMoN:.SEtRecT 190,237,80,17:.AnChorS=1+8:End With:.chEcked=eg:scRipT.RegisTeReVENt .cOmmon,"OnClick","fl":End With:Set qm=sDB.uI.NEWBUtton(oa):With qm:.CApTiON=Sdb.lOCALIZE("&Export..."):With .cOMmOn:.sEtREcT 242,234,73,24:.AnCHors=4+8:End With:End With:scRiPT.ReGISTerevEnT qm,"OnClick","jh":Set dw=sDB.uI.NeWBuTtON(oa):With dw:.CapTion=sDB.LoCaLIZE("&Import"):With .COMmon:.sEtRecT 322,234,73,24:.AnChoRs=4+8:End With:End With:ScRipT.REgiSTeREvENt dw,"OnClick","km":Set nc=SDb.uI.neWBUTTON(oa):With nc:With .cOMmOn:.SETRecT 402,234,73,24:.aNchORS=4+8:End With:If nz()>=204 Then .cANcel=True:End If:.MoDAlrESult=2:.CAptioN=sDB.localIZE("&Close"):End With:f=a6:dl="<link href='"&f&"' rel='stylesheet' type='text/css'>":o8=False:kd=h.bOOLVaLue("RegExpOptions","ShowPresetAdjustDialog"):l9=h.boOlVaLUe("RegExpOptions","ImportReadOnly"):k=True:n4.TExT=h.StrInGvAlUE("RegExpOptions","ImportFileName"):ct.chEckEd=True:k=False:Set kc=sdb.creATetimeR(10):kc.enABLEd=True:SCRIPt.REgiSTeREVEnT kc,"OnTimer","bf":If gr Then Set hs=sDb.creAtetiMER(o1):hs.enAblEd=False:scRiPt.REGiSTeREVenT hs,"OnTimer","k5":End If:With oa:.saVepOsitIonNaME=.cAPTion:.SHoWMODAl:End With:With h:.StrinGvaLuE("RegExpOptions","ImportFileName")=ok:.BOOlvALUe("RegExpOptions","ImportReadOnly")=l9:.bOoLVAlue("RegExpOptions","TableWordWrap")=eg:End With:Set kc=Nothing:On Error Resume Next:If sdB.veRSiOnbuIlD<1205 Then On Error GoTo 0:If SDb.ObjecTS("RegExpDialog")Is Nothing Or SDb.verSiOnhI=3 Then sCrIPT.unReGisterAlLevENTs:End If:Else On Error GoTo 0:SCRipT.UNrEGiSTerHAnDler"mb":End If:End Sub:Sub lh(a):o8=True:n4.cOMmOn.eNABlED=True:pp.cOMMoN.eNabLed=True:pg n4:End Sub:Sub fl(a):Dim g6,s,op,at:eg=a.cHECKed:With c5.INTerf.document:op=.aLl.taGS("thead").item(0).OffSEtheIGHT:Set g6=.ElEMeNtfROMPOinT(.alL.item("tdNumber0").ofFsETLEfT+3,op+3):For at=1 To i6:Set s=.All.item("tdPreset"&at):If Not s Is Nothing Then If eg Then s.styLE.wHiTesPACE="normal":Else s.STyLE.WhItESpAcE="nowrap":End If:End If:Next:If Not g6 Is Nothing Then g6.SCrOLlINtOview True:.bOdy.SCroLltOP=.BODY.ScrolLtOP-op:End If:End With:End Sub:Sub aw():Dim fb:If Not ft Then On Error Resume Next:If sdb.vErSiOnBuIld<1205 Then If Not r Is Nothing And Not SdB.ObJECts("RegExpDialog")Is r Then ScRIPt.uNREgIsTERALlEvEnTS:If nz>=301 Then sCrIPt.RegIStErEVENT SDB,"OnOptionsChange","le":End If:Exit Sub:Else If Not SdB.inIFIlE.boOLvALUe("RegExpOptions","SynchronizedTracks")Then Exit Sub:End If:End If:End If:On Error GoTo 0:If IsEmpty(og)Then Set og=Nothing:End If:If Not SdB.MaInTRee.CURreNtNOde Is Nothing And Not og Is Nothing Then Set fb=SDB.MAiNtrEe.CurRenTnodE:If bn And SDB.SEleCtedsoNgLISt.Count=0 Or ku=sDb.mAintRAcKSwindOw.cUrRenTaDDIngiD And(og.CAPtIon<>fb.cApTIon Or og.cUstomDATA<>fb.CUstomdaTA Or og.CUSTOmnOdeID<>fb.cUStoMnoDEId Or og.CuSTomDAtaId<>fb.cUSTOMDatAId)Then Set oSongList=SdB.NEWSOngLISt:o3.miNVALue=0:ac=True:io o3:q2:f9:Else g7.EnAbled=True:End If:Set og=fb:End If:Else If g0 Then ft=False:g0=False:End If:End If:End Sub:Function hm(hr):hm=SdB.inIFILe.StRingVAlue("RegExpReplace",hr):End Function:Sub jl(l7):Call kx(l7.Hint):End Sub:Sub kg(c):Const hc="mnuRegExpLastExec":Dim o,d5,bs,jo,oo:et c,o,bs:d5=l(c,"Description"):oo=sDB.INIFILE.iNtvAluE("RegExpOptions","TrimToolbarCaption"):jo=Left(o,oo):If Len(o)>CLng(oo)Then jo=jo&".":End If:With SdB.objeCtS("tbrRegExpExecuted"):.CAptIon=Replace(jo,"&","&&"):.HINt=o:.IcoNiNDeX=bs:End With:o=Replace(o,"&","&&"):With SDb.OBjECTS(hc&"Toolbar"):.CaptIon=o:.HInt=d5:.IcoNiNdex=bs:End With:With sdb.obJEctS(hc&"MainMenu"):.cAPtION=o:.hInT=d5:.IcoNiNDeX=bs:End With:With sdB.oBjecTs(hc&"Tracklist"):.CaPTIOn=o:.HInT=d5:.iConiNDEx=bs:End With:With SDb.ObJEcts(hc&"NowPlaying"):.caPtion=o:.hINt=d5:.icOninDex=bs:End With:If sdB.VersionHI>=3 Then With sdb.oBJECTS(hc&"TracklistNP"):.CaPtion=o:.hiNt=d5:.iCONINdeX=bs:End With:End If:End Sub:Sub gf(a):If a.ItemiNDEx>0 Then o2=a.iTEMIndeX-1:Else o2="":End If:g2.INTERf.document.bodY.iNNERhTmL=o2:h3:End Sub:Function hv(g,fr,du,ii,h1):Dim hx,im,i7,k0,d:hx=k6(fr,IIf(h1=1,jv,fh)):im=k6(du,False):If fh Or h1=1 Then k0=hx:Else If(oi Or h1=2)And Not ka And Not pn Then Select Case h1:Case 0,1:k0=hx:Case 2:k0=im:End Select:If oi Then i7=0:Else i7=1:End If:d=Replace(g,hx,Chr(1)&k0&Chr(2),1,-1,i7):d=pf(d):d=Replace(d,Chr(1),"<span class='"&ii&"'>"):d=Replace(d,Chr(2),"</span>"):hv=d:Exit Function:Else ef.Pattern="(\W)":ef.Global=True:k0=ef.Replace(hx,"\$1"):If ka Then k0="\b"&k0&"\b":End If:End If:End If:ef.Pattern=k0:If oi Then ef.IgnoreCase=False:Else ef.IgnoreCase=True:End If:If h1=1 Then ef.Global=False:Else ef.Global=True:End If:On Error Resume Next:Select Case h1:Case 0,1:d=ef.Replace(g,Chr(1)&"$&"&Chr(2)):Case 2:If Len(hx)=0 Then d=g:Else If pn Then d=Replace(im,Chr(34),Chr(1)):d=ef.Replace(g,Chr(1)&" & Chr(1) & "&d&" & Chr(2) & "&Chr(1)):If Err=0 Then If CStr(d)<>CStr(g)Then d=Replace(d,Chr(34),Chr(34)&Chr(34)):d=""""&Replace(d,Chr(1),Chr(34))&"""":d=Replace(d,vbNewLine,""" & vbNewLine & """):d=Eval(d):Else k0=Eval(im):End If:End If:Else If Not fh And ka Then d=Replace(ef.Replace(g,Chr(1)&Chr(3)&Chr(2)),Chr(3),im):Else d=ef.Replace(g,Chr(1)&im&Chr(2)):End If:End If:End If:End Select:If Err=-2147418113 Then hv=q7:Else If Err Then hv=eb:Else d=pf(d):d=Replace(d,Chr(1),"<span class='"&ii&"'>"):hv=Replace(d,Chr(2),"</span>"):End If:End If:End Function:Sub qs(mj,ek,mn,el):If mj=0 Then i1=b2.COMmoN.WidtH:jw=b2.cOmMon.heIgHT:nm=True:g1=True:l5=False:hs.INTeRVaL=o1:hs.ENaBlEd=True:End If:End Sub:Function k6(d,ce):Dim du,ed,at,r0:ef.Pattern="<(?:NUMBER|STRING)\b.*? +VALUE ?= ?""((?:""""|[^""])*)"".*?>":ef.Global=True:ef.IgnoreCase=True:du=ef.Replace(d,Chr(1)&"$1"&Chr(2)):ed=Split(du,Chr(1)):ef.Pattern="(\W)":For at=1 To UBound(ed):r0=InStr(ed(at),Chr(2)):If r0 Then du=Replace(Left(ed(at),r0-1),"""""",""""):If ce Then du=ef.Replace(du,"\$1"):End If:ed(at)=du&Mid(ed(at),r0+1):End If:Next:k6=Join(ed,""):If pn Then If InStr(1,k6,"<From Field>",1)Then k6=Replace(k6,"<From Field>",mv(mx),1,-1,1):End If:If InStr(1,k6,"<Into Field>",1)Then k6=Replace(k6,"<Into Field>",mv(qo),1,-1,1):End If:End If:End Function:Sub mq():ku=0:If sdB.versIonBUiLd>=1251 Then aw:End If:End Sub